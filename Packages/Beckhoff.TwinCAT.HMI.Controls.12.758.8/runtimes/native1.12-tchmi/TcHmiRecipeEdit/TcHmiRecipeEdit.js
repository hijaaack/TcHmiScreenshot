var TcHmi,__classPrivateFieldGet=this&&this.__classPrivateFieldGet||function(receiver,state,kind,f){if("a"===kind&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof state?receiver!==state||!f:!state.has(receiver))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===kind?f:"a"===kind?f.call(receiver):f?f.value:state.get(receiver)};!function(TcHmi){!function(Controls){!function(Beckhoff){var _a,_TcHmiRecipeEdit_tchmiFQN;class TcHmiRecipeEdit extends TcHmi.Controls.System.TcHmiControl{constructor(element,pcElement,attrs){super(element,pcElement,attrs),this.__unwatchRecipeManagementDomain=null,this.__unwatchRecipeList=null,this.__watchRecipeListResult=null,this.__onRecipeListReceivedManager=new Controls.Helpers.CallbackManager,this.__clipboard=null,this.__symbolAccessSubscriptionId=null,this.__symbolAccess={"{0}.Config":TcHmi.Server.ACCESS.NONE,Rename:TcHmi.Server.ACCESS.NONE,"{0}.ActivateRecipe":TcHmi.Server.ACCESS.NONE,"{0}.ReadFromTarget":TcHmi.Server.ACCESS.NONE,"{0}.UpdateRecipe":TcHmi.Server.ACCESS.NONE},this.__namePrompt=null,this.__createRecipePrompt=null,this.__confirmDeletionPrompt=null,this.__activatePrompt=null,this.__teachErrorPopup=null,this.__confirmClosePrompt=null,this.__childControls=[],this.__destroyersToCallOnDestroy=[],this.__localizationReader=void 0,this.__destroyLocalizationWatch=null,this.__onNewFolderPressed=()=>{this.getIsEnabled()&&TcHmi.Access.checkAccess(this,"operate")&&this.__createFolder()},this.__onNewRecipePressed=()=>{this.getIsEnabled()&&TcHmi.Access.checkAccess(this,"operate")&&this.__createRecipe()},this.__onRenamePressed=()=>{this.getIsEnabled()&&TcHmi.Access.checkAccess(this,"operate")&&this.__rename()},this.__onCopyPressed=()=>{this.getIsEnabled()&&TcHmi.Access.checkAccess(this,"operate")&&this.__fillClipboard("copy")},this.__onCutPressed=()=>{this.getIsEnabled()&&TcHmi.Access.checkAccess(this,"operate")&&this.__fillClipboard("cut")},this.__onPastePressed=()=>{this.getIsEnabled()&&TcHmi.Access.checkAccess(this,"operate")&&this.__paste()},this.__onDeletePressed=()=>{this.getIsEnabled()&&TcHmi.Access.checkAccess(this,"operate")&&this.__delete()},this.__onSelectionChanged=selectedItems=>{TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"SelectedItems"}),TcHmi.EventProvider.raise(this.__id+".onSelectionChanged"),this.getIsEnabled()&&TcHmi.Access.checkAccess(this,"operate")&&this.__updateBrowsingButtons(selectedItems)},this.__onBeforePathChange=(newCurrentItem,newPath,cancelable)=>this.getIsEnabled()&&TcHmi.Access.checkAccess(this,"operate")?this.__checkUnsavedChanges():Promise.resolve(!0),this.__onPathChanged=(currentItem,path)=>{var _b;this.setPath(null!==(_b=null==path?void 0:path.join("::"))&&void 0!==_b?_b:null),this.getIsEnabled()&&TcHmi.Access.checkAccess(this,"operate")&&this.__openOrCloseEditor(null==currentItem?void 0:currentItem.payload,path)},this.__onDragAndDropped=(dragged,droppedOnto)=>{this.getIsEnabled()&&TcHmi.Access.checkAccess(this,"operate")&&this.__moveItem(dragged,droppedOnto)},this.__onActivatePressed=()=>{this.getIsEnabled()&&TcHmi.Access.checkAccess(this,"operate")&&this.__activate()},this.__onTeachPressed=()=>{this.getIsEnabled()&&TcHmi.Access.checkAccess(this,"operate")&&this.__teach()},this.__onSavePressed=()=>{this.getIsEnabled()&&TcHmi.Access.checkAccess(this,"operate")&&this.__save()},this.__onClosePressed=()=>{this.getIsEnabled()&&TcHmi.Access.checkAccess(this,"operate")&&this.__closeEditor()},this.__onRecipeEditorChanged=editor=>{this.getIsEnabled()&&TcHmi.Access.checkAccess(this,"operate")&&this.__updateEditingButtons(editor.isValid())},this.__onRecipeListWatch=data=>{var _b,_c,_d;return data.error?(TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.errorEx(`[Source=Control, Module=${this.__type+(__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN)!==this.__type?", Origin="+__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN):"")}, Id=${this.getId()}] Failed to list recipes of domain ${this.__serverDomain}. Please make sure the domain is a recipe management extension. ${TcHmi.Log.buildMessage(data.details)}`),this.__watchRecipeListResult=null,null===(_b=this.__recipeBrowser)||void 0===_b||_b.setDirectory(null,folder=>new Map(Object.entries(folder)),TcHmi.Server.RecipeManagement.isRecipe),void this.__onRecipeListReceivedManager.trigger(null)):data.value?(this.__watchRecipeListResult=data.value,null===(_d=this.__recipeBrowser)||void 0===_d||_d.setDirectory(data.value,folder=>new Map(Object.entries(folder)),TcHmi.Server.RecipeManagement.isRecipe),void this.__onRecipeListReceivedManager.trigger(data.value)):(TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.errorEx(`[Source=Control, Module=${this.__type+(__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN)!==this.__type?", Origin="+__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN):"")}, Id=${this.getId()}] Failed to list recipes of domain ${this.__serverDomain}. Please make sure the domain is a recipe management extension.`),this.__watchRecipeListResult=null,null===(_c=this.__recipeBrowser)||void 0===_c||_c.setDirectory(null,folder=>new Map(Object.entries(folder)),TcHmi.Server.RecipeManagement.isRecipe),void this.__onRecipeListReceivedManager.trigger(null))}}__previnit(){if(super.__previnit(),this.__elementTemplateRoot=this.__element[0].querySelector(".TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-template"),!this.__elementTemplateRoot)throw new Error("Invalid Template.html - Missing element with class: 'TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-template'.");this.__destroyLocalizationWatch=this.__localization.watch(data=>{data.error===TcHmi.Errors.NONE&&data.reader&&(this.__localizationReader=data.reader)})}__init(){if(super.__init(),!this.__elementTemplateRoot)throw new Error("Invalid Template.html - Missing element with class: 'TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-template'.");const elementPathBox=this.__elementTemplateRoot.querySelector("div.TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-path-box");if(!elementPathBox)throw new Error("Invalid Template.html - A div element with class 'TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-path-box' must exist");const elementBrowsingBox=this.__elementTemplateRoot.querySelector("ul.TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-browsing-box");if(!elementBrowsingBox)throw new Error("Invalid Template.html - An ul element with class 'TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-browsing-box' must exist.");const pathDisplay=new Controls.Helpers.PathDisplay(elementPathBox,this),browsingDisplay=new Controls.Helpers.ListBrowsingDisplay(elementBrowsingBox,this);this.__recipeBrowser=new Controls.Helpers.DirectoryBrowser([pathDisplay,browsingDisplay]),this.__recipeBrowser.setMultiSelectAllowed(!0),this.__recipeBrowser.onBeforePathChange.add(this.__onBeforePathChange),this.__recipeBrowser.onSelectionChange.add(this.__onSelectionChanged),this.__recipeBrowser.onPathChange.add(this.__onPathChanged);const elementBrowsingButtons=this.__elementTemplateRoot.querySelector(".TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-browsing-pane .TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-button-container");if(!elementBrowsingButtons)throw new Error("Invalid Template.html - An element with class 'TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-browsing-pane' must exist and contain a child element with class 'TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-button-container'.");const newFolderButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__id+"_ButtonNewFolder",{"data-tchmi-width":35,"data-tchmi-height":35,"data-tchmi-tooltip":this.__expandLocalizationSymbol("Button_Tooltip_CreateFolder")},this);if(!newFolderButton)throw new Error("Could not create controls for TcHmiRecipeEdit.");const newFolderElement=newFolderButton.getElement()[0];newFolderElement.classList.add("TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-button-icon-create-folder"),elementBrowsingButtons.appendChild(newFolderElement),this.__destroyersToCallOnDestroy.push(TcHmi.EventProvider.register(newFolderButton.getId()+".onPressed",this.__onNewFolderPressed)),this.__childControls.push(newFolderButton);const newRecipeButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__id+"_ButtonNewRecipe",{"data-tchmi-width":35,"data-tchmi-height":35,"data-tchmi-tooltip":this.__expandLocalizationSymbol("Button_Tooltip_CreateRecipe")},this);if(!newRecipeButton)throw new Error("Could not create controls for TcHmiRecipeEdit.");const newRecipeElement=newRecipeButton.getElement()[0];newRecipeElement.classList.add("TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-button-icon-create-recipe"),elementBrowsingButtons.appendChild(newRecipeElement),this.__destroyersToCallOnDestroy.push(TcHmi.EventProvider.register(newRecipeButton.getId()+".onPressed",this.__onNewRecipePressed)),this.__childControls.push(newRecipeButton);const renameButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__id+"_ButtonRename",{"data-tchmi-width":35,"data-tchmi-height":35,"data-tchmi-tooltip":this.__expandLocalizationSymbol("Button_Tooltip_Rename"),"data-tchmi-is-enabled":!1},this);if(!renameButton)throw new Error("Could not create controls for TcHmiRecipeEdit.");const renameElement=renameButton.getElement()[0];renameElement.classList.add("TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-button-icon-rename"),elementBrowsingButtons.appendChild(renameElement),this.__destroyersToCallOnDestroy.push(TcHmi.EventProvider.register(renameButton.getId()+".onPressed",this.__onRenamePressed)),this.__childControls.push(renameButton);const copyButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__id+"_ButtonCopy",{"data-tchmi-width":35,"data-tchmi-height":35,"data-tchmi-tooltip":this.__expandLocalizationSymbol("Button_Tooltip_Copy"),"data-tchmi-is-enabled":!1},this);if(!copyButton)throw new Error("Could not create controls for TcHmiRecipeEdit.");const copyElement=copyButton.getElement()[0];copyElement.classList.add("TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-button-icon-copy"),elementBrowsingButtons.appendChild(copyElement),this.__destroyersToCallOnDestroy.push(TcHmi.EventProvider.register(copyButton.getId()+".onPressed",this.__onCopyPressed)),this.__childControls.push(copyButton);const cutButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__id+"_ButtonCut",{"data-tchmi-width":35,"data-tchmi-height":35,"data-tchmi-tooltip":this.__expandLocalizationSymbol("Button_Tooltip_Cut"),"data-tchmi-is-enabled":!1},this);if(!cutButton)throw new Error("Could not create controls for TcHmiRecipeEdit.");const cutElement=cutButton.getElement()[0];cutElement.classList.add("TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-button-icon-cut"),elementBrowsingButtons.appendChild(cutElement),this.__destroyersToCallOnDestroy.push(TcHmi.EventProvider.register(cutButton.getId()+".onPressed",this.__onCutPressed)),this.__childControls.push(cutButton);const pasteButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__id+"_ButtonPaste",{"data-tchmi-width":35,"data-tchmi-height":35,"data-tchmi-tooltip":this.__expandLocalizationSymbol("Button_Tooltip_Paste"),"data-tchmi-is-enabled":!1},this);if(!pasteButton)throw new Error("Could not create controls for TcHmiRecipeEdit.");const pasteElement=pasteButton.getElement()[0];pasteElement.classList.add("TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-button-icon-paste"),elementBrowsingButtons.appendChild(pasteElement),this.__destroyersToCallOnDestroy.push(TcHmi.EventProvider.register(pasteButton.getId()+".onPressed",this.__onPastePressed)),this.__childControls.push(pasteButton);const deleteButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__id+"_ButtonDelete",{"data-tchmi-width":35,"data-tchmi-height":35,"data-tchmi-tooltip":this.__expandLocalizationSymbol("Button_Tooltip_Delete"),"data-tchmi-is-enabled":!1},this);if(!deleteButton)throw new Error("Could not create controls for TcHmiRecipeEdit.");const deleteElement=deleteButton.getElement()[0];deleteElement.classList.add("TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-button-icon-delete"),elementBrowsingButtons.appendChild(deleteElement),this.__destroyersToCallOnDestroy.push(TcHmi.EventProvider.register(deleteButton.getId()+".onPressed",this.__onDeletePressed)),this.__childControls.push(deleteButton);const elementEditingArea=this.__elementTemplateRoot.querySelector(".TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-editing-area");if(!(elementEditingArea instanceof HTMLDivElement))throw new Error("Invalid Template.html - A <div> element with class 'TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-editing-area' must exist.");this.__recipeEditor=new Beckhoff.TcHmiRecipeEditComponents.RecipeEditor(elementEditingArea,this),this.__recipeEditor.onChange.add(this.__onRecipeEditorChanged),this.__recipeEditor.setLocalizations({tableHeaderName:this.__expandLocalizationSymbol("Table_Header_Name"),tableHeaderValue:this.__expandLocalizationSymbol("Table_Header_Value"),tableHeaderMin:this.__expandLocalizationSymbol("Table_Header_Min"),tableHeaderMax:this.__expandLocalizationSymbol("Table_Header_Max"),tableHeaderUnit:this.__expandLocalizationSymbol("Table_Header_Unit"),tableHeaderComment:this.__expandLocalizationSymbol("Table_Header_Comment"),editorLocalizations:{optionalEditor:{optionalCheckboxTooltip:this.__expandLocalizationSymbol("Editor_Checkbox_Tooltip_Optional")},booleanEditor:{falseText:this.__expandLocalizationSymbol("Editor_Combobox_Text_False"),trueText:this.__expandLocalizationSymbol("Editor_Combobox_Text_True")},buttonBasedEditor:{buttonTooltip:this.__expandLocalizationSymbol("Editor_Button_Tooltip_Open")},timeEditor:{dateTimeButtonTooltip:this.__expandLocalizationSymbol("Editor_Button_Tooltip_DateTime"),timespanButtonTooltip:this.__expandLocalizationSymbol("Editor_Button_Tooltip_Timespan")},choiceEditor:{comboboxText:this.__expandLocalizationSymbol("Editor_Combobox_Text_ChooseType")},arrayBasedEditorPane:{addButtonTooltip:this.__expandLocalizationSymbol("Editor_Button_Tooltip_AddItem"),removeButtonTooltip:this.__expandLocalizationSymbol("Editor_Button_Tooltip_RemoveItem"),upButtonTooltip:this.__expandLocalizationSymbol("Editor_Button_Tooltip_ItemUp"),downButtonTooltip:this.__expandLocalizationSymbol("Editor_Button_Tooltip_ItemDown")},objectEditorPane:{addButtonTooltip:this.__expandLocalizationSymbol("Editor_Button_Tooltip_AddProperty"),acceptButtonText:this.__expandLocalizationSymbol("Popup_Button_Text_OK"),acceptButtonTooltip:this.__expandLocalizationSymbol("Editor_Button_Tooltip_AcceptProperty"),cancelButtonTooltip:this.__expandLocalizationSymbol("Editor_Button_Tooltip_CancelProperty"),removeButtonTooltip:this.__expandLocalizationSymbol("Editor_Button_Tooltip_RemoveProperty")},arrayEditorPrompt:{buttonTextOk:this.__expandLocalizationSymbol("Popup_Button_Text_OK"),buttonTooltipOk:this.__expandLocalizationSymbol("Popup_Button_Tooltip_OK"),buttonTextCancel:this.__expandLocalizationSymbol("Popup_Button_Text_Cancel"),buttonTooltipCancel:this.__expandLocalizationSymbol("Popup_Button_Tooltip_Cancel")},objectEditorPrompt:{buttonTextOk:this.__expandLocalizationSymbol("Popup_Button_Text_OK"),buttonTooltipOk:this.__expandLocalizationSymbol("Popup_Button_Tooltip_OK"),buttonTextCancel:this.__expandLocalizationSymbol("Popup_Button_Text_Cancel"),buttonTooltipCancel:this.__expandLocalizationSymbol("Popup_Button_Tooltip_Cancel")},tupleEditorPrompt:{buttonTextOk:this.__expandLocalizationSymbol("Popup_Button_Text_OK"),buttonTooltipOk:this.__expandLocalizationSymbol("Popup_Button_Tooltip_OK"),buttonTextCancel:this.__expandLocalizationSymbol("Popup_Button_Text_Cancel"),buttonTooltipCancel:this.__expandLocalizationSymbol("Popup_Button_Tooltip_Cancel")}},recipeReferenceEditorLocalizations:{buttonTextOk:this.__expandLocalizationSymbol("Popup_Button_Text_OK"),buttonTooltipOk:this.__expandLocalizationSymbol("Popup_Button_Tooltip_OK"),buttonTextCancel:this.__expandLocalizationSymbol("Popup_Button_Text_Cancel"),buttonTooltipCancel:this.__expandLocalizationSymbol("Popup_Button_Tooltip_Cancel"),openPopupButtonTooltip:this.__expandLocalizationSymbol("Editor_Button_Tooltip_Open"),recipePopupHeaderText:this.__expandLocalizationSymbol("Popup_Header_Recipe")}});const elementEditingButtons=this.__elementTemplateRoot.querySelector(".TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-editing-pane .TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-button-container");if(!elementEditingButtons)throw new Error("Invalid Template.html - An element with class 'TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-browsing-pane' must exist and contain a child element with class 'TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-button-container'.");const activateButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__id+"_ButtonActivate",{"data-tchmi-width":35,"data-tchmi-height":35,"data-tchmi-tooltip":this.__expandLocalizationSymbol("Button_Tooltip_Activate")},this);if(!activateButton)throw new Error("Could not create controls for TcHmiRecipeEdit.");const activateElement=activateButton.getElement()[0];activateElement.classList.add("TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-button-icon-activate-recipe"),elementEditingButtons.appendChild(activateElement),this.__destroyersToCallOnDestroy.push(TcHmi.EventProvider.register(activateButton.getId()+".onPressed",this.__onActivatePressed)),this.__childControls.push(activateButton);const teachButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__id+"_ButtonTeach",{"data-tchmi-width":35,"data-tchmi-height":35,"data-tchmi-tooltip":this.__expandLocalizationSymbol("Button_Tooltip_Teach")},this);if(!teachButton)throw new Error("Could not create controls for TcHmiRecipeEdit.");const teachElement=teachButton.getElement()[0];teachElement.classList.add("TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-button-icon-teach-recipe"),elementEditingButtons.appendChild(teachElement),this.__destroyersToCallOnDestroy.push(TcHmi.EventProvider.register(teachButton.getId()+".onPressed",this.__onTeachPressed)),this.__childControls.push(teachButton);const saveButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__id+"_ButtonSave",{"data-tchmi-width":35,"data-tchmi-height":35,"data-tchmi-tooltip":this.__expandLocalizationSymbol("Button_Tooltip_Save"),"data-tchmi-is-enabled":!1},this);if(!saveButton)throw new Error("Could not create controls for TcHmiRecipeEdit.");const saveElement=saveButton.getElement()[0];saveElement.classList.add("TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-button-icon-save"),elementEditingButtons.appendChild(saveElement),this.__destroyersToCallOnDestroy.push(TcHmi.EventProvider.register(saveButton.getId()+".onPressed",this.__onSavePressed)),this.__childControls.push(saveButton);const closeButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__id+"_ButtonClose",{"data-tchmi-width":35,"data-tchmi-height":35,"data-tchmi-tooltip":this.__expandLocalizationSymbol("Button_Tooltip_Close")},this);if(!closeButton)throw new Error("Could not create controls for TcHmiRecipeEdit.");const closeElement=closeButton.getElement()[0];closeElement.classList.add("TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-button-icon-exit"),elementEditingButtons.appendChild(closeElement),this.__destroyersToCallOnDestroy.push(TcHmi.EventProvider.register(closeButton.getId()+".onPressed",this.__onClosePressed)),this.__childControls.push(closeButton),this.__buttons={createFolder:newFolderButton,createRecipe:newRecipeButton,rename:renameButton,copy:copyButton,cut:cutButton,paste:pasteButton,delete:deleteButton,activate:activateButton,teach:teachButton,save:saveButton,close:closeButton};const createMapping={controlRight:"operate",virtualControlRight:"create"};this.__buttons.createFolder.setVirtualControlRightMappings([createMapping]),this.__buttons.createRecipe.setVirtualControlRightMappings([createMapping]),this.__buttons.rename.setVirtualControlRightMappings([{controlRight:"operate",virtualControlRight:"rename"}]),this.__buttons.copy.setVirtualControlRightMappings([createMapping]),this.__buttons.cut.setVirtualControlRightMappings([{controlRight:"operate",virtualControlRight:"cut"}]),this.__buttons.paste.setVirtualControlRightMappings([createMapping]),this.__buttons.delete.setVirtualControlRightMappings([{controlRight:"operate",virtualControlRight:"delete"}]),this.__buttons.activate.setVirtualControlRightMappings([{controlRight:"operate",virtualControlRight:"activateRecipe"}]),this.__buttons.teach.setVirtualControlRightMappings([{controlRight:"operate",virtualControlRight:"teachRecipe"}]),this.__buttons.save.setVirtualControlRightMappings([{controlRight:"operate",virtualControlRight:"editRecipe"}]),this.__processPath()}__attach(){var _b;super.__attach(),null===(_b=this.__recipeBrowser)||void 0===_b||_b.resume(),this.__updateRecipeWatches(),this.__updateSymbolAccessSubscription()}__detach(){var _b;super.__detach(),null===(_b=this.__recipeBrowser)||void 0===_b||_b.suspend(),this.__updateRecipeWatches(!0),this.__updateSymbolAccessSubscription(!0)}destroy(){var _b,_c,_d,_e,_f,_g,_h,_j,_k;if(!this.__keepAlive){null===(_b=this.__destroyLocalizationWatch)||void 0===_b||_b.call(this),this.__destroyLocalizationWatch=null,null===(_c=this.__recipeBrowser)||void 0===_c||_c.suspend(),null===(_d=this.__recipeEditor)||void 0===_d||_d.destroy(),null===(_e=this.__namePrompt)||void 0===_e||_e.destroy(),this.__namePrompt=null,null===(_f=this.__createRecipePrompt)||void 0===_f||_f.destroy(),this.__createRecipePrompt=null,null===(_g=this.__confirmDeletionPrompt)||void 0===_g||_g.destroy(),this.__confirmDeletionPrompt=null,null===(_h=this.__activatePrompt)||void 0===_h||_h.destroy(),this.__activatePrompt=null,null===(_j=this.__teachErrorPopup)||void 0===_j||_j.destroy(),this.__teachErrorPopup=null,null===(_k=this.__confirmClosePrompt)||void 0===_k||_k.destroy(),this.__confirmClosePrompt=null;for(const destroy of this.__destroyersToCallOnDestroy)destroy();this.__destroyersToCallOnDestroy=[];for(const control of this.__childControls)control.destroy();this.__childControls=[],super.destroy()}}__expandLocalizationSymbol(key){return`%l%Control::${__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN)}::${key}%/l%`}__updateButtonAccess(){var _b,_c;const canWriteConfig=this.__symbolAccess["{0}.Config"]>=TcHmi.Server.ACCESS.WRITE,canRename=this.__symbolAccess.Rename>=TcHmi.Server.ACCESS.WRITE,canActivateRecipe=this.__symbolAccess["{0}.ActivateRecipe"]>=TcHmi.Server.ACCESS.WRITE,canReadFromTarget=this.__symbolAccess["{0}.ReadFromTarget"]>=TcHmi.Server.ACCESS.WRITE,canUpdateRecipe=this.__symbolAccess["{0}.UpdateRecipe"]>=TcHmi.Server.ACCESS.WRITE;TcHmi.Access.setControlRightOverride(this.__buttons.createFolder,"operate",canWriteConfig?null:"Deny"),TcHmi.Binding.createEx2(this.__expandLocalizationSymbol(canWriteConfig?"Button_Tooltip_CreateFolder":"Button_Tooltip_CreateFolder_MissingSymbolAccess"),"Tooltip",this.__buttons.createFolder),TcHmi.Access.setControlRightOverride(this.__buttons.createRecipe,"operate",canWriteConfig&&canUpdateRecipe?null:"Deny"),TcHmi.Binding.createEx2(this.__expandLocalizationSymbol(canWriteConfig&&canUpdateRecipe?"Button_Tooltip_CreateRecipe":"Button_Tooltip_CreateRecipe_MissingSymbolAccess"),"Tooltip",this.__buttons.createRecipe),TcHmi.Access.setControlRightOverride(this.__buttons.rename,"operate",canRename?null:"Deny"),TcHmi.Binding.createEx2(this.__expandLocalizationSymbol(canRename?"Button_Tooltip_Rename":"Button_Tooltip_Rename_MissingSymbolAccess"),"Tooltip",this.__buttons.rename),TcHmi.Access.setControlRightOverride(this.__buttons.copy,"operate",canWriteConfig&&canUpdateRecipe?null:"Deny"),TcHmi.Binding.createEx2(this.__expandLocalizationSymbol(canWriteConfig&&canUpdateRecipe?"Button_Tooltip_Copy":"Button_Tooltip_Copy_MissingSymbolAccess"),"Tooltip",this.__buttons.copy),TcHmi.Access.setControlRightOverride(this.__buttons.cut,"operate",canRename?null:"Deny"),TcHmi.Binding.createEx2(this.__expandLocalizationSymbol(canRename?"Button_Tooltip_Cut":"Button_Tooltip_Cut_MissingSymbolAccess"),"Tooltip",this.__buttons.cut),TcHmi.Access.setControlRightOverride(this.__buttons.paste,"operate",null===this.__clipboard||("copy"===this.__clipboard.action?canWriteConfig&&canUpdateRecipe:canRename)?null:"Deny"),TcHmi.Binding.createEx2(this.__expandLocalizationSymbol(null===this.__clipboard||("copy"===this.__clipboard.action?canWriteConfig&&canUpdateRecipe:canRename)?"Button_Tooltip_Paste":"Button_Tooltip_Paste_MissingSymbolAccess"),"Tooltip",this.__buttons.paste),TcHmi.Access.setControlRightOverride(this.__buttons.delete,"operate",canWriteConfig?null:"Deny"),TcHmi.Binding.createEx2(this.__expandLocalizationSymbol(canWriteConfig?"Button_Tooltip_Delete":"Button_Tooltip_Delete_MissingSymbolAccess"),"Tooltip",this.__buttons.delete),TcHmi.Access.setControlRightOverride(this.__buttons.activate,"operate",canActivateRecipe?null:"Deny"),TcHmi.Binding.createEx2(this.__expandLocalizationSymbol(canActivateRecipe?"Button_Tooltip_Activate":"Button_Tooltip_Activate_MissingSymbolAccess"),"Tooltip",this.__buttons.activate),TcHmi.Access.setControlRightOverride(this.__buttons.teach,"operate",canReadFromTarget&&canWriteConfig&&canUpdateRecipe?null:"Deny"),TcHmi.Binding.createEx2(this.__expandLocalizationSymbol(canReadFromTarget&&canWriteConfig&&canUpdateRecipe?"Button_Tooltip_Teach":"Button_Tooltip_Teach_MissingSymbolAccess"),"Tooltip",this.__buttons.teach),TcHmi.Access.setControlRightOverride(this.__buttons.save,"operate",canWriteConfig&&canUpdateRecipe?null:"Deny"),TcHmi.Binding.createEx2(this.__expandLocalizationSymbol(canWriteConfig&&canUpdateRecipe?"Button_Tooltip_Save":"Button_Tooltip_Save_MissingSymbolAccess"),"Tooltip",this.__buttons.save);const confirmCloseSaveButton=null===(_c=null===(_b=this.__confirmClosePrompt)||void 0===_b?void 0:_b.getButtons().get("save"))||void 0===_c?void 0:_c.button;confirmCloseSaveButton&&TcHmi.Access.setControlRightOverride(confirmCloseSaveButton,"operate",canWriteConfig&&canUpdateRecipe?null:"Deny")}__createNamePrompt(){const prompt=new Controls.Helpers.InputPrompt(this);return prompt.setBackgroundAction({close:!0,action:"cancel"}),prompt.setValidationPatterns([{pattern:/::/,expectedTestResult:!1},{pattern:/^(?:|\.\.?)$/,expectedTestResult:!1}]),prompt.setLocalizations({labelText:this.__expandLocalizationSymbol("Popup_Label_Name"),buttonTextOk:this.__expandLocalizationSymbol("Popup_Button_Text_OK"),buttonTooltipOk:this.__expandLocalizationSymbol("Popup_Button_Tooltip_OK"),buttonTextCancel:this.__expandLocalizationSymbol("Popup_Button_Text_Cancel"),buttonTooltipCancel:this.__expandLocalizationSymbol("Popup_Button_Tooltip_Cancel")}),prompt}async __createFolder(){var _b;if(!TcHmi.Access.checkAccess(this,"create"))return;if(!this.__serverDomain)return;if(!this.__recipeBrowser)return;const currentItem=this.__recipeBrowser.getCurrentItem();if(!currentItem||currentItem.type===Controls.Helpers.DirectoryBrowser.ItemType.File)return;const path=this.__recipeBrowser.getPath();if(path){this.__namePrompt||(this.__namePrompt=this.__createNamePrompt()),this.__namePrompt.setLocalizations({headerText:this.__expandLocalizationSymbol("Popup_Header_NewFolder")});try{const result=await this.__namePrompt.prompt(currentItem.children.keys(),null===(_b=this.__localizationReader)||void 0===_b?void 0:_b.get("New_Folder"));if(result.isOk){path.push(result.value);const stringPath=path.join("::");TcHmi.Server.RecipeManagement.createRecipeFolderEx(stringPath,{domain:this.__serverDomain,parallel:!0},null,data=>{data.error!==TcHmi.Errors.NONE&&TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.errorEx(`[Source=Control, Module=${this.__type+(__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN)!==this.__type?", Origin="+__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN):"")}, Id=${this.getId()}] Failed to create recipe folder. ${TcHmi.Log.buildMessage(data.details)}`)})}}catch(e){}}}async __createRecipe(){var _b;if(!TcHmi.Access.checkAccess(this,"create"))return;if(!this.__serverDomain)return;if(!this.__recipeBrowser)return;if(!this.__recipeEditor)return;const currentItem=this.__recipeBrowser.getCurrentItem();if(!currentItem||currentItem.type===Controls.Helpers.DirectoryBrowser.ItemType.File)return;const path=this.__recipeBrowser.getPath();if(path){this.__createRecipePrompt||(this.__createRecipePrompt=new Beckhoff.TcHmiRecipeEditComponents.CreateRecipePrompt(this),this.__createRecipePrompt.setBackgroundAction({close:!0,action:"cancel"}),this.__createRecipePrompt.setRecipeManagementDomain(this.__serverDomain),this.__createRecipePrompt.setLocalizations({buttonTextOk:this.__expandLocalizationSymbol("Popup_Button_Text_OK"),buttonTooltipOk:this.__expandLocalizationSymbol("Popup_Button_Tooltip_OK"),buttonTextCancel:this.__expandLocalizationSymbol("Popup_Button_Text_Cancel"),buttonTooltipCancel:this.__expandLocalizationSymbol("Popup_Button_Tooltip_Cancel"),headerText:this.__expandLocalizationSymbol("Popup_Header_NewRecipe"),nameLabelText:this.__expandLocalizationSymbol("Popup_Label_Name"),recipeTypeLabelText:this.__expandLocalizationSymbol("Popup_Label_RecipeType"),selectButtonTooltip:this.__expandLocalizationSymbol("Popup_Button_Tooltip_RecipeType"),recipeTypePopupHeaderText:this.__expandLocalizationSymbol("Popup_Header_RecipeType")}));try{const result=await this.__createRecipePrompt.prompt(currentItem.children.keys(),null===(_b=this.__localizationReader)||void 0===_b?void 0:_b.get("New_Recipe"));if(result.isOk){const recipePath=path.concat(result.value.name);this.__recipeBrowser.fakeFile(recipePath,{recipeTypeName:result.value.recipeTypeName,values:{}}),this.__element[0].classList.add("editing"),this.__recipeBrowser.setPath(recipePath),this.__recipeEditor.populate({name:result.value.recipeTypeName,recipeType:result.value.recipeType},{name:recipePath.join("::")}),this.__recipeBrowser.suspendDirectoryUpdates()}}catch(e){}}}async __rename(){if(!TcHmi.Access.checkAccess(this,"rename"))return;if(!this.__serverDomain)return;if(!this.__recipeBrowser)return;const currentItem=this.__recipeBrowser.getCurrentItem();if(!currentItem||currentItem.type===Controls.Helpers.DirectoryBrowser.ItemType.File)return;const selectedItems=this.__recipeBrowser.getSelectedItems();if(!selectedItems||1!==selectedItems.length)return;const path=this.__recipeBrowser.getPath();if(!path)return;const selectedItem=selectedItems[0];this.__namePrompt||(this.__namePrompt=this.__createNamePrompt()),this.__namePrompt.setLocalizations({headerText:this.__expandLocalizationSymbol("Popup_Header_Rename")});try{const result=await this.__namePrompt.prompt(Array.from(currentItem.children.keys()).filter(name=>name!==selectedItem.name),selectedItem.name);if(result.isOk&&result.value!==selectedItem.name){const stringPath=path.join("::");TcHmi.Server.RecipeManagement.isRecipe(selectedItem.payload)?TcHmi.Server.RecipeManagement.renameRecipeEx(selectedItem.name,stringPath,result.value,stringPath,{domain:this.__serverDomain,parallel:!0},null,data=>{data.error!==TcHmi.Errors.NONE&&TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.errorEx(`[Source=Control, Module=${this.__type+(__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN)!==this.__type?", Origin="+__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN):"")}, Id=${this.getId()}] Failed to rename recipe. ${TcHmi.Log.buildMessage(data.details)}`)}):TcHmi.Server.RecipeManagement.renameRecipeFolderEx(selectedItem.name,stringPath,result.value,stringPath,{domain:this.__serverDomain,parallel:!0},null,data=>{data.error!==TcHmi.Errors.NONE&&TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.errorEx(`[Source=Control, Module=${this.__type+(__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN)!==this.__type?", Origin="+__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN):"")}, Id=${this.getId()}] Failed to rename recipe folder. ${TcHmi.Log.buildMessage(data.details)}`)})}}catch(e){}}async __delete(){var _b;if(!TcHmi.Access.checkAccess(this,"delete"))return;if(!this.__serverDomain)return;if(!this.__recipeBrowser)return;const currentItem=null===(_b=this.__recipeBrowser.getCurrentItem())||void 0===_b?void 0:_b.payload;if(!currentItem||TcHmi.Server.RecipeManagement.isRecipe(currentItem))return;const selectedItems=this.__recipeBrowser.getSelectedItems();if(!selectedItems||0===selectedItems.length)return;const path=this.__recipeBrowser.getPath();if(path){this.__confirmDeletionPrompt||(this.__confirmDeletionPrompt=new Controls.Helpers.TextAndButtonsPrompt({yes:{value:!0,attributes:{"data-tchmi-width":60,"data-tchmi-height":30,"data-tchmi-text":this.__expandLocalizationSymbol("Popup_Button_Text_Yes")}},no:{value:!1,attributes:{"data-tchmi-width":60,"data-tchmi-height":30,"data-tchmi-text":this.__expandLocalizationSymbol("Popup_Button_Text_No")}}},this),this.__confirmDeletionPrompt.setBackgroundAction({close:!0,action:"no"}),this.__confirmDeletionPrompt.setLocalizations({headerText:this.__expandLocalizationSymbol("Popup_Header_ConfirmDelete"),contentText:this.__expandLocalizationSymbol("Popup_Text_ConfirmDelete")}));try{if(await this.__confirmDeletionPrompt.prompt())for(const selectedItem of selectedItems)if(TcHmi.Server.RecipeManagement.isRecipe(selectedItem.payload)){const stringPath=path.join("::");TcHmi.Server.RecipeManagement.deleteRecipeEx(selectedItem.name,stringPath,{domain:this.__serverDomain,parallel:!0},null,data=>{data.error!==TcHmi.Errors.NONE&&TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.errorEx(`[Source=Control, Module=${this.__type+(__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN)!==this.__type?", Origin="+__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN):"")}, Id=${this.getId()}] Failed to delete recipe. ${TcHmi.Log.buildMessage(data.details)}`)})}else{path.push(selectedItem.name);const stringPath=path.join("::");TcHmi.Server.RecipeManagement.deleteRecipeFolderEx(stringPath,{domain:this.__serverDomain,parallel:!0},null,data=>{data.error!==TcHmi.Errors.NONE&&TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.errorEx(`[Source=Control, Module=${this.__type+(__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN)!==this.__type?", Origin="+__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN):"")}, Id=${this.getId()}] Failed to delete recipe folder. ${TcHmi.Log.buildMessage(data.details)}`)})}}catch(e){}}}__fillClipboard(action){var _b,_c;const items=null===(_b=this.__recipeBrowser)||void 0===_b?void 0:_b.getSelectedItems(),path=null===(_c=this.__recipeBrowser)||void 0===_c?void 0:_c.getPath();items&&path&&(this.__clipboard={action:action,origin:path,items:items},this.__buttons.paste.setIsEnabled(!0),this.__updateButtonAccess(),this.__buttons.paste.setVirtualControlRightMappings([{controlRight:"operate",virtualControlRight:"cut"===action?"cut":"create"}]))}async __paste(){var _b,_c,_d;if(!this.__clipboard||!this.__recipeBrowser)return;if("cut"===this.__clipboard.action&&tchmi_equal(this.__clipboard.origin,this.__recipeBrowser.getFolderPath()))return void(this.__clipboard.action="copy");const itemsToPaste=new Map(this.__clipboard.items.map(item=>[item.name,item])),existingNames=new Set(null===(_b=this.__recipeBrowser.getCurrentFolder())||void 0===_b?void 0:_b.children.keys()),conflictingNames=new Set;for(const name of itemsToPaste.keys())existingNames.has(name)&&conflictingNames.add(name),existingNames.add(name);if(conflictingNames.size>0){const result=await this.__resolveFileNameConflicts(conflictingNames,existingNames);if(!result.isOk)return;for(const name of conflictingNames){const resolvedName=result.value.get(name);if(resolvedName){if(resolvedName!==name){const item=itemsToPaste.get(name);item&&itemsToPaste.set(resolvedName,item),itemsToPaste.delete(name)}}else itemsToPaste.delete(name)}}if(0!==itemsToPaste.size)switch(this.__clipboard.action){case"copy":this.__copyPaste(itemsToPaste,null!==(_c=this.__recipeBrowser.getFolderPath())&&void 0!==_c?_c:[]);break;case"cut":this.__cutPaste(itemsToPaste,this.__clipboard.origin,null!==(_d=this.__recipeBrowser.getFolderPath())&&void 0!==_d?_d:[])}}__copyPaste(itemsToPaste,target){if(!this.__serverDomain)return;const path=target.join("::");for(const[name,item]of itemsToPaste)if(item.type===Controls.Helpers.DirectoryBrowser.ItemType.File)TcHmi.Server.RecipeManagement.createRecipeEx(name,path,item.payload,{domain:this.__serverDomain,parallel:!0},null,data=>{data.error!==TcHmi.Errors.NONE&&TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.errorEx(`[Source=Control, Module=${this.__type+(__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN)!==this.__type?", Origin="+__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN):"")}, Id=${this.getId()}] Failed to create recipe. ${TcHmi.Log.buildMessage(data.details)}`)});else{const subPath=target.concat(name);TcHmi.Server.RecipeManagement.createRecipeFolderEx(subPath.join("::"),{domain:this.__serverDomain,parallel:!0},null,data=>{data.error!==TcHmi.Errors.NONE&&TCHMI_CONSOLE_LOG_LEVEL>=1?TcHmi.Log.errorEx(`[Source=Control, Module=${this.__type+(__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN)!==this.__type?", Origin="+__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN):"")}, Id=${this.getId()}] Failed to create recipe folder. ${TcHmi.Log.buildMessage(data.details)}`):this.__copyPaste(item.children,subPath)})}}__cutPaste(itemsToPaste,origin,target){if(!this.__clipboard||!this.__serverDomain)return;const oldPath=origin.join("::"),newPath=target.join("::");for(const[newName,item]of itemsToPaste)item.type===Controls.Helpers.DirectoryBrowser.ItemType.File?TcHmi.Server.RecipeManagement.renameRecipeEx(item.name,oldPath,newName,newPath,{domain:this.__serverDomain,parallel:!0},null,data=>{data.error!==TcHmi.Errors.NONE&&TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.errorEx(`[Source=Control, Module=${this.__type+(__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN)!==this.__type?", Origin="+__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN):"")}, Id=${this.getId()}] Failed to move recipe. ${TcHmi.Log.buildMessage(data.details)}`)}):TcHmi.Server.RecipeManagement.renameRecipeFolderEx(item.name,oldPath,newName,newPath,{domain:this.__serverDomain,parallel:!0},null,data=>{data.error!==TcHmi.Errors.NONE&&TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.errorEx(`[Source=Control, Module=${this.__type+(__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN)!==this.__type?", Origin="+__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN):"")}, Id=${this.getId()}] Failed to move recipe. ${TcHmi.Log.buildMessage(data.details)}`)});this.__clipboard.action="copy"}async __resolveFileNameConflicts(conflictingNames,existingNames){var _b,_c;if(!(null===(_b=this.__recipeBrowser)||void 0===_b?void 0:_b.getCurrentFolder()))return{isOk:!1};const conflictMap=new Map,canDelete=null!==(_c=TcHmi.Access.checkAccess(this,"delete"))&&void 0!==_c&&_c;for(const name of conflictingNames)conflictMap.set(name,canDelete);const popup=new Beckhoff.TcHmiRecipeEditComponents.FileConflictPrompt(conflictMap,existingNames,this);popup.setBackgroundAction({close:!0,action:"cancel"}),popup.setLocalizations({headerText:this.__expandLocalizationSymbol("Popup_Header_FileConflict"),labelText:this.__expandLocalizationSymbol("Popup_Label_FileConflict"),labelDoForAll:this.__expandLocalizationSymbol("Popup_FileConflict_Label_DoForAll"),radioTextSkip:this.__expandLocalizationSymbol("Popup_FileConflict_Radio_Text_Skip"),radioTextReplace:this.__expandLocalizationSymbol("Popup_FileConflict_Radio_Text_Replace"),radioTextKeepBoth:this.__expandLocalizationSymbol("Popup_FileConflict_Radio_Text_KeepBoth"),buttonTextOk:this.__expandLocalizationSymbol("Popup_Button_Text_OK"),buttonTextCancel:this.__expandLocalizationSymbol("Popup_Button_Text_Cancel"),buttonTooltipCancel:this.__expandLocalizationSymbol("Popup_Button_Tooltip_Cancel")});const result=await popup.prompt();return popup.destroy(!0),result}__updateBrowsingButtons(selectedItems){this.__buttons.rename.setIsEnabled(selectedItems&&1===selectedItems.length),this.__buttons.copy.setIsEnabled(selectedItems&&selectedItems.length>0),this.__buttons.cut.setIsEnabled(selectedItems&&selectedItems.length>0),this.__buttons.delete.setIsEnabled(selectedItems&&selectedItems.length>0)}__openOrCloseEditor(currentItem,path){var _b,_c,_d;this.__recipeEditor&&(path&&currentItem&&TcHmi.Server.RecipeManagement.isRecipe(currentItem)?this.__element[0].classList.contains("editing")||(this.__recipeEditor.populate({name:currentItem.recipeTypeName},{name:path.join("::"),recipe:currentItem}),this.__element[0].classList.add("editing"),null===(_b=this.__recipeBrowser)||void 0===_b||_b.suspendDirectoryUpdates(),TcHmi.EventProvider.raise(this.__id+".onEditStarted",{name:path.join("::"),recipe:currentItem})):this.__element[0].classList.contains("editing")&&(this.__element[0].classList.remove("editing"),this.__recipeEditor.clear(),null===(_c=this.__recipeBrowser)||void 0===_c||_c.clearFakedFile(),null===(_d=this.__recipeBrowser)||void 0===_d||_d.resumeDirectoryUpdates()))}async __checkUnsavedChanges(){var _b,_c,_d,_e;if(!this.__recipeEditor)return!0;if(!this.__element[0].classList.contains("editing")||!this.__recipeEditor.getRecipeName())return!0;if(!this.__recipeEditor.hasChanges()){const state=this.__recipeEditor.getState();return state.isValid&&TcHmi.EventProvider.raise(this.__id+".onEditEnded",{name:state.recipeName,recipe:state.value}),!0}this.__confirmClosePrompt||(this.__confirmClosePrompt=new Controls.Helpers.TextAndButtonsPrompt({save:{value:"save",attributes:{"data-tchmi-width":120,"data-tchmi-height":30,"data-tchmi-text":this.__expandLocalizationSymbol("Popup_Button_Text_SaveChanges")}},discard:{value:"discard",attributes:{"data-tchmi-width":120,"data-tchmi-height":30,"data-tchmi-text":this.__expandLocalizationSymbol("Popup_Button_Text_DiscardChanges")}},cancel:{value:"cancel",attributes:{"data-tchmi-width":60,"data-tchmi-height":30,"data-tchmi-text":this.__expandLocalizationSymbol("Popup_Button_Text_Cancel")}}},this),this.__confirmClosePrompt.setBackgroundAction({close:!0,action:"cancel"}),this.__confirmClosePrompt.setLocalizations({headerText:this.__expandLocalizationSymbol("Popup_Header_UnsavedChanges"),contentText:this.__expandLocalizationSymbol("Popup_Text_UnsavedChanges")}));const saveButton=null===(_b=this.__confirmClosePrompt.getButtons().get("save"))||void 0===_b?void 0:_b.button;null==saveButton||saveButton.setIsEnabled(this.__recipeEditor.isValid()),null==saveButton||saveButton.setVirtualControlRightMappings([{controlRight:"operate",virtualControlRight:"editRecipe"}]),saveButton&&TcHmi.Access.setControlRightOverride(saveButton,"operate",this.__symbolAccess["{0}.Config"]>=TcHmi.Server.ACCESS.WRITE&&this.__symbolAccess["{0}.UpdateRecipe"]>=TcHmi.Server.ACCESS.WRITE?null:"Deny");try{switch(await this.__confirmClosePrompt.prompt()){case"save":try{await this.__save()}catch(e){return!1}const state=this.__recipeEditor.getState();return state.isValid&&TcHmi.EventProvider.raise(this.__id+".onEditEnded",{name:state.recipeName,recipe:state.value}),!0;case"discard":const path=null===(_c=this.__recipeBrowser)||void 0===_c?void 0:_c.getPath(),currentItem=null===(_e=null===(_d=this.__recipeBrowser)||void 0===_d?void 0:_d.getCurrentItem())||void 0===_e?void 0:_e.payload;return path&&currentItem&&TcHmi.Server.RecipeManagement.isRecipe(currentItem)&&TcHmi.EventProvider.raise(this.__id+".onEditEnded",{name:path.join("::"),recipe:currentItem}),!0;case"cancel":return!1}}catch(e){return!1}}__moveItem(dragged,droppedOnto){var _b;if(!TcHmi.Access.checkAccess(this,"rename"))return;if(!this.__serverDomain)return;if(!this.__recipeBrowser)return;const currentItem=null===(_b=this.__recipeBrowser.getCurrentItem())||void 0===_b?void 0:_b.payload;if(!currentItem||TcHmi.Server.RecipeManagement.isRecipe(currentItem))return;const path=this.__recipeBrowser.getPath();if(!path)return;const stringPath=path.join("::"),newPath=droppedOnto.isParent?path.slice(0,-1).join("::"):path.concat(droppedOnto.name).join("::");TcHmi.Server.RecipeManagement.isRecipe(currentItem[dragged])?TcHmi.Server.RecipeManagement.renameRecipeEx(dragged,stringPath,dragged,newPath,{domain:this.__serverDomain,parallel:!0},null,data=>{data.error!==TcHmi.Errors.NONE&&TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.errorEx(`[Source=Control, Module=${this.__type+(__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN)!==this.__type?", Origin="+__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN):"")}, Id=${this.getId()}] Failed to move recipe. ${TcHmi.Log.buildMessage(data.details)}`)}):TcHmi.Server.RecipeManagement.renameRecipeFolderEx(dragged,stringPath,dragged,newPath,{domain:this.__serverDomain,parallel:!0},null,data=>{data.error!==TcHmi.Errors.NONE&&TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.errorEx(`[Source=Control, Module=${this.__type+(__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN)!==this.__type?", Origin="+__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN):"")}, Id=${this.getId()}] Failed to move recipe folder. ${TcHmi.Log.buildMessage(data.details)}`)})}async __activate(){var _b,_c;if(!this.__recipeEditor)return;const recipeName=this.__recipeEditor.getRecipeName();if(recipeName){if(this.__recipeEditor.hasChanges()){this.__activatePrompt||(this.__activatePrompt=new Controls.Helpers.TextAndButtonsPrompt({saveAndActivate:{value:"saveAndActivate",attributes:{"data-tchmi-width":160,"data-tchmi-height":30,"data-tchmi-text":this.__expandLocalizationSymbol("Popup_Button_Text_SaveAndActivate")}},justActivate:{value:"justActivate",attributes:{"data-tchmi-width":160,"data-tchmi-height":30,"data-tchmi-text":this.__expandLocalizationSymbol("Popup_Button_Text_JustActivate")}},cancel:{value:"cancel",attributes:{"data-tchmi-width":60,"data-tchmi-height":30,"data-tchmi-text":this.__expandLocalizationSymbol("Popup_Button_Text_Cancel")}}},this),this.__activatePrompt.setBackgroundAction({close:!0,action:"cancel"}),this.__activatePrompt.setLocalizations({headerText:this.__expandLocalizationSymbol("Popup_Header_UnsavedChanges"),contentText:this.__expandLocalizationSymbol("Popup_Text_UnsavedChangesActivating")}));const saveButton=null===(_b=this.__activatePrompt.getButtons().get("saveAndActivate"))||void 0===_b?void 0:_b.button;null==saveButton||saveButton.setIsEnabled(this.__recipeEditor.isValid()),null==saveButton||saveButton.setVirtualControlRightMappings([{controlRight:"operate",virtualControlRight:"editRecipe"}]),saveButton&&TcHmi.Access.setControlRightOverride(saveButton,"operate",this.__symbolAccess["{0}.Config"]>=TcHmi.Server.ACCESS.WRITE&&this.__symbolAccess["{0}.UpdateRecipe"]>=TcHmi.Server.ACCESS.WRITE?null:"Deny");const activateButton=null===(_c=this.__activatePrompt.getButtons().get("justActivate"))||void 0===_c?void 0:_c.button;null==activateButton||activateButton.setIsEnabled(this.__recipeEditor.recipeExists());try{switch(await this.__activatePrompt.prompt()){case"saveAndActivate":await this.__save();break;case"justActivate":break;case"cancel":return}}catch(e){return}}TcHmi.Server.RecipeManagement.activateEx(recipeName,null,{domain:this.__serverDomain,parallel:!0},null,data=>{data.error!==TcHmi.Errors.NONE&&TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.errorEx(`[Source=Control, Module=${this.__type+(__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN)!==this.__type?", Origin="+__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN):"")}, Id=${this.getId()}] Failed to activate recipe. ${TcHmi.Log.buildMessage(data.details)}`)})}}async __teach(){if(!this.__recipeEditor)return;const recipeName=this.__recipeEditor.getRecipeName();if(recipeName){if(!this.__recipeEditor.recipeExists()){if(!this.__recipeEditor.isValid())return this.__teachErrorPopup||(this.__teachErrorPopup=new Controls.Helpers.TextAndButtonsPrompt({ok:{value:void 0,attributes:{"data-tchmi-width":60,"data-tchmi-height":30,"data-tchmi-text":this.__expandLocalizationSymbol("Popup_Button_Text_OK")}}},this),this.__teachErrorPopup.setBackgroundAction({close:!0,action:"ok"}),this.__teachErrorPopup.setLocalizations({headerText:this.__expandLocalizationSymbol("Popup_Header_TeachError"),contentText:this.__expandLocalizationSymbol("Popup_Text_TeachError")})),void this.__teachErrorPopup.show();try{await this.__save()}catch(e){return}}TcHmi.Server.RecipeManagement.teachEx(recipeName,null,{domain:this.__serverDomain,parallel:!0},null,data=>{var _b;const recipe=null===(_b=data.value)||void 0===_b?void 0:_b[recipeName];data.error===TcHmi.Errors.NONE&&recipe?this.__recipeEditor.setValue(recipe):TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.errorEx(`[Source=Control, Module=${this.__type+(__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN)!==this.__type?", Origin="+__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN):"")}, Id=${this.getId()}] Failed to teach recipe. ${TcHmi.Log.buildMessage(data.details)}`)})}}__save(){return new Promise((resolve,reject)=>{if(!this.__recipeEditor)return void reject();const state=this.__recipeEditor.getState();if(state.isValid){const recipe=state.value;this.__recipeEditor.recipeExists()?TcHmi.Server.RecipeManagement.updateRecipeEx(state.recipeName,null,recipe.values,{domain:this.__serverDomain,parallel:!0},null,data=>{data.error!==TcHmi.Errors.NONE&&TCHMI_CONSOLE_LOG_LEVEL>=1?(TcHmi.Log.errorEx(`[Source=Control, Module=${this.__type+(__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN)!==this.__type?", Origin="+__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN):"")}, Id=${this.getId()}] Failed to update recipe. ${TcHmi.Log.buildMessage(data.details)}`),reject()):(this.__recipeEditor.confirmSave(),resolve())}):TcHmi.Server.RecipeManagement.createRecipeEx(state.recipeName,null,recipe,{domain:this.__serverDomain,parallel:!0},null,data=>{var _b;data.error!==TcHmi.Errors.NONE&&TCHMI_CONSOLE_LOG_LEVEL>=1?(TcHmi.Log.errorEx(`[Source=Control, Module=${this.__type+(__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN)!==this.__type?", Origin="+__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN):"")}, Id=${this.getId()}] Failed to create recipe. ${TcHmi.Log.buildMessage(data.details)}`),reject()):(this.__recipeEditor.confirmSave(),null===(_b=this.__recipeBrowser)||void 0===_b||_b.clearFakedFile(),resolve())})}else reject()})}async __closeEditor(){var _b;if(!this.__recipeBrowser)return;if(!this.__recipeEditor)return;await this.__checkUnsavedChanges()&&(this.__element[0].classList.remove("editing"),this.__recipeEditor.clear(),this.__recipeBrowser.clearFakedFile(),this.__recipeBrowser.resumeDirectoryUpdates(),this.__recipeBrowser.setPath(null!==(_b=this.__recipeBrowser.getFolderPath())&&void 0!==_b?_b:[]))}__updateEditingButtons(isValid){this.__recipeEditor&&this.__buttons.save.setIsEnabled(isValid&&this.__recipeEditor.hasChanges())}setServerDomain(valueNew){let convertedValue=TcHmi.ValueConverter.toString(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("ServerDomain")),tchmi_equal(convertedValue,this.__serverDomain)||(this.__serverDomain=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ServerDomain"}),this.__processServerDomain())}getServerDomain(){return this.__serverDomain}__processServerDomain(){var _b;this.__updateRecipeWatches(),this.__updateSymbolAccessSubscription(),this.__serverDomain&&(null===(_b=this.__createRecipePrompt)||void 0===_b||_b.setRecipeManagementDomain(this.__serverDomain))}setPath(valueNew){let convertedValue=TcHmi.ValueConverter.toString(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("Path")),tchmi_equal(convertedValue,this.__path)||(this.__oldPath=this.__path,this.__path=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"Path"}),this.__processPath())}getPath(){return this.__path}async __processPath(){if(!this.__recipeBrowser)return;await this.__recipeBrowser.setPath(this.__path?this.__path.split("::"):[])||(this.__path=this.__oldPath,TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.errorEx(`[Source=Control, Module=${this.__type+(__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN)!==this.__type?", Origin="+__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN):"")}, Id=${this.getId()}, Property=Path] `+TcHmi.Log.buildMessage({code:TcHmi.Errors.E_INVALID,message:TcHmi.Errors[TcHmi.Errors.E_INVALID],reason:`The path "${this.__path}" is invalid or was rejected by the user.`,domain:this.__type})))}getSelectedItems(){var _b,_c;return(null!==(_c=null===(_b=this.__recipeBrowser)||void 0===_b?void 0:_b.getSelectedItems())&&void 0!==_c?_c:[]).map(item=>item.name)}__updateRecipeWatches(unwatchOnly=!1){var _b,_c;TCHMI_DESIGNER||(null===(_b=this.__unwatchRecipeList)||void 0===_b||_b.call(this),this.__unwatchRecipeList=null,null===(_c=this.__unwatchRecipeManagementDomain)||void 0===_c||_c.call(this),this.__unwatchRecipeManagementDomain=null,!unwatchOnly&&this.__isAttached&&this.__serverDomain&&(this.__unwatchRecipeManagementDomain=TcHmi.Server.Domains.watch(this.__serverDomain,data=>{var _b,_c,_d,_e,_f,_g,_h,_j,_k,_l,_m,_o;data.error===TcHmi.Errors.NONE?"Loaded"===(null===(_b=data.value)||void 0===_b?void 0:_b.state)||"Initialized"===(null===(_c=data.value)||void 0===_c?void 0:_c.state)?(this.setIsEnabled(!0),this.__unwatchRecipeList||(this.__unwatchRecipeList=TcHmi.Server.RecipeManagement.watchRecipeList({domain:this.__serverDomain,parallel:!0},this.__onRecipeListWatch)),null===(_d=this.__recipeEditor)||void 0===_d||_d.setRecipeManagementDomain(null!==(_e=this.__serverDomain)&&void 0!==_e?_e:null),null===(_f=this.__createRecipePrompt)||void 0===_f||_f.setRecipeManagementDomain(null!==(_g=this.__serverDomain)&&void 0!==_g?_g:null)):(this.setIsEnabled(!1),null===(_h=this.__unwatchRecipeList)||void 0===_h||_h.call(this),this.__unwatchRecipeList=null,null===(_j=this.__recipeEditor)||void 0===_j||_j.setRecipeManagementDomain(null),null===(_k=this.__createRecipePrompt)||void 0===_k||_k.setRecipeManagementDomain(null),TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.errorEx(`[Source=Control, Module=${this.__type+(__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN)!==this.__type?", Origin="+__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN):"")}, Id=${this.getId()}] Domain '${this.__serverDomain}' is not loaded. Please make sure the server extension is activated.`)):(this.setIsEnabled(!1),null===(_l=this.__unwatchRecipeList)||void 0===_l||_l.call(this),this.__unwatchRecipeList=null,null===(_m=this.__recipeEditor)||void 0===_m||_m.setRecipeManagementDomain(null),null===(_o=this.__createRecipePrompt)||void 0===_o||_o.setRecipeManagementDomain(null),TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.errorEx(`[Source=Control, Module=${this.__type+(__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN)!==this.__type?", Origin="+__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN):"")}, Id=${this.getId()}] Domain '${this.__serverDomain}' is not known. Please make sure the server extension is loaded and the domain name is correct. ${TcHmi.Log.buildMessage(data.details)}`))})))}__registerOnRecipeListReceived(callback){return callback(this.__watchRecipeListResult),this.__onRecipeListReceivedManager.add(callback)}__unregisterOnRecipeListReceived(callback){this.__onRecipeListReceivedManager.remove(callback)}__updateSymbolAccessSubscription(unsubscribeOnly=!1){if(TCHMI_DESIGNER)return;if(null!==this.__symbolAccessSubscriptionId&&(TcHmi.Server.unsubscribeEx(this.__symbolAccessSubscriptionId,null),this.__symbolAccessSubscriptionId=null),unsubscribeOnly||!this.__isAttached||!this.__serverDomain)return;const writeValuePropertyMap={},commands=Object.keys(this.__symbolAccess).map(symbolName=>{const writeValue=tchmi_format_string(symbolName,this.__serverDomain);return writeValuePropertyMap[writeValue]=symbolName,{symbol:"GetSymbolAccess",writeValue:writeValue,commandOptions:["SendWriteValue","SendErrorMessage"]}});this.__symbolAccessSubscriptionId=TcHmi.Server.subscribeEx(commands,TcHmi.Config.get().tcHmiServer.websocketIntervalTime,{parallel:!0},data=>{if(data.error===TcHmi.Errors.NONE)if(data.response)if(data.response.error)TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.errorEx(`[Source=Control, Module=${this.__type+(__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN)!==this.__type?", Origin="+__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN):"")}, Id=${this.getId()}, Symbol=GetSymbolAccess] `+TcHmi.Log.buildMessage(data.response.error));else if(data.response.commands){for(const command of data.response.commands)command.error?TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.errorEx(`[Source=Control, Module=${this.__type+(__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN)!==this.__type?", Origin="+__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN):"")}, Id=${this.getId()}, Symbol=GetSymbolAccess] `+TcHmi.Log.buildMessage(command.error)):void 0!==command.readValue?command.writeValue?this.__symbolAccess[writeValuePropertyMap[command.writeValue]]=command.readValue:TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.errorEx(`[Source=Control, Module=${this.__type+(__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN)!==this.__type?", Origin="+__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN):"")}, Id=${this.getId()}, Symbol=GetSymbolAccess] `+TcHmi.Log.buildMessage({code:TcHmi.Errors.E_SERVER_WRITEVALUE_MISSING,message:TcHmi.Errors[TcHmi.Errors.E_SERVER_WRITEVALUE_MISSING],reason:`Missing writeValue in response from server with id: '${data.response.id}'.`,domain:this.__type})):TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.errorEx(`[Source=Control, Module=${this.__type+(__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN)!==this.__type?", Origin="+__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN):"")}, Id=${this.getId()}, Symbol=GetSymbolAccess] `+TcHmi.Log.buildMessage({code:TcHmi.Errors.E_SERVER_READVALUE_MISSING,message:TcHmi.Errors[TcHmi.Errors.E_SERVER_READVALUE_MISSING],reason:`Missing readValue in response from server with id: '${data.response.id}'.`,domain:this.__type}));this.__updateButtonAccess()}else TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.errorEx(`[Source=Control, Module=${this.__type+(__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN)!==this.__type?", Origin="+__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN):"")}, Id=${this.getId()}, Symbol=GetSymbolAccess] `+TcHmi.Log.buildMessage({code:TcHmi.Errors.E_SERVER_COMMANDS_MISSING,message:TcHmi.Errors[TcHmi.Errors.E_SERVER_COMMANDS_MISSING],reason:`Missing commands in response from server with id: '${data.response.id}'.`,domain:this.__type}));else TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.errorEx(`[Source=Control, Module=${this.__type+(__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN)!==this.__type?", Origin="+__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN):"")}, Id=${this.getId()}, Symbol=GetSymbolAccess] `+TcHmi.Log.buildMessage({code:TcHmi.Errors.E_SERVER_RESPONSE_MISSING,message:TcHmi.Errors[TcHmi.Errors.E_SERVER_RESPONSE_MISSING],reason:"Missing response from server.",domain:this.__type}));else TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.errorEx(`[Source=Control, Module=${this.__type+(__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN)!==this.__type?", Origin="+__classPrivateFieldGet(TcHmiRecipeEdit,_a,"f",_TcHmiRecipeEdit_tchmiFQN):"")}, Id=${this.getId()}, Symbol=GetSymbolAccess] `+TcHmi.Log.buildMessage(data.details))})}}_TcHmiRecipeEdit_tchmiFQN={value:"TcHmi.Controls.Beckhoff."+(_a=TcHmiRecipeEdit).name},Beckhoff.TcHmiRecipeEdit=TcHmiRecipeEdit}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),TcHmi.Controls.registerEx("TcHmiRecipeEdit","TcHmi.Controls.Beckhoff",TcHmi.Controls.Beckhoff.TcHmiRecipeEdit),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiRecipeEditComponents){TcHmiRecipeEditComponents.RecipeTypeParser=class{constructor(__recipeManagementDomain,__parentControl){this.__recipeManagementDomain=__recipeManagementDomain,this.__parentControl=__parentControl}async parse(recipeTypeName,recipeType){return recipeType||(recipeType=(await this.__getRecipeTypes([recipeTypeName]))[0]),await this.__parseRecipeType(recipeTypeName,recipeType)}__getRecipeTypes(names){return new Promise((resolve,reject)=>{if(!this.__recipeManagementDomain)return void reject(new Error(TcHmi.Log.buildMessage({code:TcHmi.Errors.ERROR,message:TcHmi.Errors[TcHmi.Errors.ERROR],reason:"No recipe management domain was specified.",domain:this.__parentControl.getType()})));const recipeTypes=[];for(const name of names){const result=TcHmi.Server.RecipeManagement.getRecipeTypeEx(name,null,{domain:this.__recipeManagementDomain,parallel:!0},null,data=>{data.error===TcHmi.Errors.NONE&&data.value?(recipeTypes.push(data.value),recipeTypes.length===names.length&&resolve(recipeTypes)):data.details?reject(new Error(TcHmi.Log.buildMessage(data.details))):reject(new Error(TcHmi.Log.buildMessage({code:TcHmi.Errors.ERROR,message:TcHmi.Errors[TcHmi.Errors.ERROR],reason:"Unknown error occured while getting recipe type.",domain:this.__parentControl.getType()})))});if(result.code!==TcHmi.Errors.NONE)return void reject(new Error(TcHmi.Log.buildMessage(result)))}})}async __parseRecipeType(recipeTypeName,recipeType){var _a,_b;const parsed={name:recipeTypeName,ungroupedMembers:[],memberGroups:new Map,membersEnabled:"Disabled"!==(null===(_a=recipeType.options)||void 0===_a?void 0:_a.enabled),comment:null===(_b=recipeType.options)||void 0===_b?void 0:_b.comment},symbols=new Map,parse=async recipeType=>{var _a,_b;for(const key in recipeType.members){const member=recipeType.members[key];if(!member)continue;let parsedMember;if(member.group){let group=parsed.memberGroups.get(member.group);group||(group=[],parsed.memberGroups.set(member.group,group)),parsedMember=tchmi_clone_object(member),parsedMember.name=key,parsedMember.enabled=null!==(_b=parsed.membersEnabled&&parsedMember.enabled)&&void 0!==_b&&_b,group.push(parsedMember)}else parsedMember=tchmi_clone_object(member),parsedMember.name=key,parsedMember.enabled=null!==(_a=parsed.membersEnabled&&parsedMember.enabled)&&void 0!==_a&&_a,parsed.ungroupedMembers.push(parsedMember);if("symbol"in parsedMember){const symbolsEntry=symbols.get(parsedMember.symbol);symbolsEntry?symbolsEntry.push(parsedMember):symbols.set(parsedMember.symbol,[parsedMember])}}if(recipeType.recipeTypeNames&&recipeType.recipeTypeNames.length>0){const bases=await this.__getRecipeTypes(recipeType.recipeTypeNames);for(const base of bases)await parse(base)}};await parse(recipeType);const schemas=await this.__getSchemas(new Set(symbols.keys()));for(const[symbol,schema]of schemas){const symbolMembers=symbols.get(symbol);if(symbolMembers)for(const symbolMember of symbolMembers)symbolMember.symbolType=schema}const sort=(a,b)=>void 0!==a.order&&void 0!==b.order?a.order-b.order:void 0===a.order&&void 0===b.order?a.name<b.name?-1:a.name>b.name?1:0:void 0!==a.order?-1:1;return parsed.ungroupedMembers.sort(sort),parsed.memberGroups.forEach(memberGroup=>memberGroup.sort(sort)),parsed}__getSchemas(symbols){return 0===symbols.size?Promise.resolve(new Map):new Promise((resolve,reject)=>{const schemas=new Map;for(const symbol of symbols)TcHmi.Symbol.resolveSchema(`%s%${symbol}%/s%`,data=>{if(data.error===TcHmi.Errors.NONE&&data.schema)schemas.set(symbol,data.schema),schemas.size===symbols.size&&resolve(schemas);else{const details=data.details||{code:data.error,message:TcHmi.Errors[data.error],domain:"TcHmi.System.Symbol"};reject(new Error(TcHmi.Log.buildMessage(details)))}})})}}}(Beckhoff.TcHmiRecipeEditComponents||(Beckhoff.TcHmiRecipeEditComponents={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiRecipeEditComponents){class SchemaParser{static parse(schema){schema=this.resolveAllOf(this.resolveReferences(schema));const types=this.__findPossibleEditorTypes(schema),condensedTypes=[],convertedTypes=[],condense=type=>{let condensedType;return["boolean","number","string","time","enum","null"].includes(type.editorType)&&(condensedType=condensedTypes.find(condensed=>condensed.editorType===type.editorType&&condensed.id===type.schema.id&&condensed.title===type.schema.title)),condensedType?condensedType.condensedFrom.push(type):(condensedType={editorType:type.editorType,convertibles:[],condensedFrom:[type]},type.schema.id&&(condensedType.id=type.schema.id),type.schema.title&&(condensedType.title=type.schema.title),condensedTypes.push(condensedType)),condensedType};for(const type of types)type.convert?convertedTypes.push(type):condense(type);for(const type of convertedTypes){const existingTypes=condensedTypes.filter(condensed=>condensed.condensedFrom.some(condensedFrom=>condensedFrom.rawType===type.convert));if(existingTypes.length>0)for(const existingType of existingTypes)existingType.convertibles.push(type);else{const condensedType=condense(type);condensedType.convertibles.push(...convertedTypes.filter(converted=>converted!==type&&condensedType.condensedFrom.some(condensedFrom=>condensedFrom.rawType===converted.convert)))}}return 1===condensedTypes.length?this.__createEditorInfo(condensedTypes[0],schema):condensedTypes.length>1?this.__createChoiceEditorInfo(condensedTypes,schema):TcHmiRecipeEditComponents.ChoiceEditor.createAnyEditorInfo()}static resolveAllOf(schema){if(null!==(schema=tchmi_clone_object(schema))&&"object"==typeof schema){if(schema.allOf&&Array.isArray(schema.allOf))return schema.allOf.reduce((combined,current)=>{for(const key in current)combined[key]=current[key];return combined});if(Array.isArray(schema))for(let i=0,ii=schema.length;i<ii;i++)null!==schema[i]&&"object"==typeof schema[i]&&(schema[i]=this.resolveAllOf(schema[i]));else for(const key in schema)schema.hasOwnProperty(key)&&null!==schema[key]&&"object"==typeof schema[key]&&(schema[key]=this.resolveAllOf(schema[key]))}return schema}static resolveReferences(schema){schema=tchmi_clone_object(schema);const knownRefs=new Map,resolve=schema=>{var _a;if(null!==schema&&"object"==typeof schema){if("string"==typeof schema.$ref){let subSchema=knownRefs.get(schema.$ref);if(!subSchema){if(subSchema=tchmi_clone_object(null!==(_a=TcHmi.Type.getSchema(schema.$ref))&&void 0!==_a?_a:void 0),!subSchema)throw new Error(TcHmi.Log.buildMessage({code:TcHmi.Errors.ERROR,message:TcHmi.Errors[TcHmi.Errors.ERROR],domain:"TcHmi.Controls.Beckhoff.TcHmiRecipeEditComponents.SchemaParser",reason:`Unknown schema reference ${schema.$ref}.`}));knownRefs.set(schema.$ref,subSchema),knownRefs.set(schema.$ref,resolve(subSchema))}return subSchema}if(Array.isArray(schema))for(let i=0,ii=schema.length;i<ii;i++)null!==schema[i]&&"object"==typeof schema[i]&&(schema[i]=resolve(schema[i]));else for(const key in schema)schema.hasOwnProperty(key)&&null!==schema[key]&&"object"==typeof schema[key]&&(schema[key]=resolve(schema[key]))}return schema};return resolve(schema)}static __findPossibleEditorTypes(schema,strayRestrictions=new Map){let rawTypes=new Set;if(schema.type)"string"==typeof schema.type?rawTypes.add(schema.type):Array.isArray(schema.type)&&(rawTypes=new Set(schema.type));else if(schema.enum)for(const entry of schema.enum){const type=typeof entry;let rawType;switch(type){case"bigint":rawType="number";break;case"symbol":case"function":rawType="object";break;case"undefined":rawType="null";break;case"object":rawType=entry?"object":"null";break;default:rawType=type}rawTypes.add(rawType)}const subSchemas=[];schema.anyOf&&subSchemas.push(...schema.anyOf),schema.oneOf&&subSchemas.push(...schema.oneOf);const newStrayRestrictions=new Map;for(const[typename,keywords]of this.__restrictions)if(!rawTypes.has(typename))for(const keyword of keywords)if(keyword in schema){let restrictionMap=newStrayRestrictions.get(typename);restrictionMap||(restrictionMap=new Map,newStrayRestrictions.set(typename,restrictionMap)),restrictionMap.set(keyword,schema[keyword])}0===rawTypes.size&&0===subSchemas.length&&newStrayRestrictions.size>0&&(rawTypes=new Set(newStrayRestrictions.keys()),newStrayRestrictions.clear());for(const[typename,strayRestriction]of strayRestrictions)if(rawTypes.has(typename)){for(const[keyword,value]of strayRestriction)keyword in schema||(schema[keyword]=value);strayRestrictions.delete(typename)}for(const[typename,strayRestriction]of newStrayRestrictions){const existingStrayRestriction=strayRestrictions.get(typename);if(existingStrayRestriction)for(const[restriction,value]of strayRestriction)existingStrayRestriction.set(restriction,value);else strayRestrictions.set(typename,strayRestriction)}const types=[];for(const rawType of rawTypes){let editorType;if(schema.enum)editorType="enum";else if("date-time"===schema.format||"timespan"===schema.format)editorType="time";else switch(rawType){case"boolean":editorType="boolean";break;case"integer":case"number":editorType="number";break;case"string":editorType="string";break;case"object":editorType="object";break;case"array":editorType=Array.isArray(schema.items)?"tuple":"array";break;case"null":editorType="null";break;default:editorType="invalid"}types.push({editorType:editorType,rawType:rawType,schema:schema})}if(schema.convert)for(const type of types)type.rawType!==schema.convert&&(type.convert=schema.convert);for(const subSchema of subSchemas){const subTypes=this.__findPossibleEditorTypes(subSchema,strayRestrictions);types.push(...subTypes)}return types}static __generateName(type){if(type.title)return type.title;if(type.id){const result=/tchmi:([a-zA-Z]+)#\/definitions\/(.+)$/.exec(type.id);if(result)return result[2]}return type.editorType.charAt(0).toUpperCase()+type.editorType.slice(1)}static __createEditorInfo(type,schema){switch(type.editorType){case"boolean":return this.__createBooleanEditorInfo(type,schema);case"number":return this.__createNumberEditorInfo(type,schema);case"string":return this.__createStringEditorInfo(type,schema);case"time":return this.__createTimeEditorInfo(type,schema);case"enum":return this.__createEnumEditorInfo(type,schema);case"object":return this.__createObjectEditorInfo(type,schema);case"array":return this.__createArrayEditorInfo(type,schema);case"tuple":return this.__createTupleEditorInfo(type,schema);case"null":return this.__createNullEditorInfo(type,schema);default:return this.__createAnyEditorInfo(type,schema)}}static __createBooleanEditorInfo(type,schema){return{type:"boolean",schema:schema,name:this.__generateName(type)}}static __createNumberEditorInfo(type,schema){const restrictions=type.condensedFrom.map(type=>{var _a,_b;const restriction={isInteger:"integer"===type.rawType};return void 0!==type.schema.multipleOf&&(restriction.multipleOf=type.schema.multipleOf),void 0!==type.schema.maximum&&(restriction.maximum={value:type.schema.maximum,exclusive:null!==(_a=type.schema.exclusiveMaximum)&&void 0!==_a&&_a}),void 0!==type.schema.minimum&&(restriction.minimum={value:type.schema.minimum,exclusive:null!==(_b=type.schema.exclusiveMinimum)&&void 0!==_b&&_b}),restriction}),info={type:"number",schema:schema,name:this.__generateName(type),restrictions:restrictions,specialValues:new Set};for(const convertible of type.convertibles)if(convertible.schema.enum)for(const item of convertible.schema.enum)info.specialValues.add(item);return info}static __createStringEditorInfo(type,schema){const restrictions=type.condensedFrom.map(type=>{const restriction={};return void 0!==type.schema.minLength&&(restriction.minLength=type.schema.minLength),void 0!==type.schema.maxLength&&(restriction.maxLength=type.schema.maxLength),type.schema.pattern&&(restriction.patterns=[new RegExp(type.schema.pattern)]),type.schema.format&&(restriction.format=type.schema.format),restriction});return{type:"string",schema:schema,name:this.__generateName(type),restrictions:restrictions.filter(restriction=>Object.keys(restriction).length>0)}}static __createTimeEditorInfo(type,schema){const formats=new Set(type.condensedFrom.map(type=>type.schema.format).filter(format=>"date-time"===format||"timespan"===format));return{type:"time",schema:schema,name:this.__generateName(type),formats:formats}}static __createEnumEditorInfo(type,schema){const info={type:"enum",schema:schema,name:this.__generateName(type),members:new Map};for(const condensedFrom of type.condensedFrom)if(condensedFrom.schema.enum){for(const member of condensedFrom.schema.enum)info.members.set(member,void 0);if(condensedFrom.schema.options)for(const option of condensedFrom.schema.options)info.members.has(option.value)&&info.members.set(option.value,option.label)}return info}static __createObjectEditorInfo(type,schema){var _a;const info={type:"object",schema:schema,name:this.__generateName(type),properties:new Map,additionalProperties:{allowed:!0}},editorSchema=type.condensedFrom[0].schema;if(editorSchema.patternProperties){info.patternProperties=new Map;for(const key in editorSchema.patternProperties)info.patternProperties.set(new RegExp(key),this.parse(editorSchema.patternProperties[key]))}if(editorSchema.properties)for(const key in editorSchema.properties){let editorInfo=this.parse(editorSchema.properties[key]);if(info.patternProperties&&Array.from(info.patternProperties.keys()).some(regex=>regex.test(key))){const matchingInfos=[];for(const[regex,patternInfo]of info.patternProperties)regex.test(key)&&matchingInfos.push(patternInfo);editorInfo=this.mergeEditorInfos(editorInfo,...matchingInfos)}(null===(_a=editorSchema.required)||void 0===_a?void 0:_a.includes(key))||"optional"===editorInfo.type||(editorInfo={type:"optional",schema:editorInfo.schema,name:editorInfo.name,editorInfo:editorInfo,temporarilyRequired:!1}),info.properties.set(key,editorInfo)}if(void 0!==editorSchema.additionalProperties&&(info.additionalProperties.allowed=!1!==editorSchema.additionalProperties,info.additionalProperties.allowed&&(info.additionalProperties.editorInfo=this.parse("object"==typeof editorSchema.additionalProperties?editorSchema.additionalProperties:{}))),editorSchema.required)for(const requiredProperty of editorSchema.required.filter(item=>!info.properties.has(item)))info.properties.set(requiredProperty,TcHmiRecipeEditComponents.ObjectEditor.getEditorInfoForProperty(info,requiredProperty));if(void 0!==editorSchema.maxProperties&&(info.maxProperties=editorSchema.maxProperties),void 0!==editorSchema.minProperties&&(info.minProperties=editorSchema.minProperties),void 0!==editorSchema.dependencies){info.dependencies=new Map;for(const key in editorSchema.dependencies){const dependency=editorSchema.dependencies[key];if(Array.isArray(dependency)){const dependencyInfo={type:"object",schema:{},name:info.name,properties:new Map,additionalProperties:{allowed:!0}};for(const requiredProperty of dependency){const editorInfo=TcHmiRecipeEditComponents.ObjectEditor.getEditorInfoForProperty(info,requiredProperty);"optional"===editorInfo.type?dependencyInfo.properties.set(requiredProperty,editorInfo.editorInfo):info.properties.get(requiredProperty)!==editorInfo&&dependencyInfo.properties.set(requiredProperty,editorInfo)}info.dependencies.set(key,dependencyInfo)}else{const dependencyInfo=this.parse(dependency);"object"===dependencyInfo.type&&info.dependencies.set(key,dependencyInfo)}}}return info}static __createArrayEditorInfo(type,schema){var _a;const editorSchema=type.condensedFrom[0].schema,info={type:"array",schema:schema,name:this.__generateName(type),items:editorSchema.items&&!Array.isArray(editorSchema.items)?this.parse(editorSchema.items):TcHmiRecipeEditComponents.ChoiceEditor.createAnyEditorInfo(),uniqueItems:null!==(_a=editorSchema.uniqueItems)&&void 0!==_a&&_a};return void 0!==editorSchema.minItems&&(info.minItems=editorSchema.minItems),void 0!==editorSchema.maxItems&&(info.maxItems=editorSchema.maxItems),info}static __createTupleEditorInfo(type,schema){var _a,_b;const editorSchema=type.condensedFrom[0].schema,info={type:"tuple",schema:schema,name:this.__generateName(type),items:[],additionalItems:{allowed:!0},uniqueItems:null!==(_a=editorSchema.uniqueItems)&&void 0!==_a&&_a};if(void 0!==editorSchema.minItems&&(info.minItems=editorSchema.minItems),void 0!==editorSchema.maxItems&&(info.maxItems=editorSchema.maxItems),Array.isArray(editorSchema.items)){const minItems=null!==(_b=info.minItems)&&void 0!==_b?_b:0;for(let i=0,ii=editorSchema.items.length;i<ii;i++){let editorInfo=this.parse(editorSchema.items[i]);i>=minItems&&(editorInfo={type:"optional",schema:editorInfo.schema,name:editorInfo.name,editorInfo:editorInfo,temporarilyRequired:!1}),info.items.push(editorInfo)}}return void 0!==editorSchema.additionalItems&&(info.additionalItems.allowed=!1!==editorSchema.additionalItems,info.additionalItems.allowed&&(info.additionalItems.editorInfo=this.parse("object"==typeof editorSchema.additionalItems?editorSchema.additionalItems:{}))),info}static __createChoiceEditorInfo(types,schema){var _a;const info={type:"choice",schema:schema,name:this.__generateName({editorType:"choice",id:schema.id,title:schema.title}),choices:[]};for(const type of types){const choice=this.__createEditorInfo(type,schema);if("choice"!==choice.type)info.choices.push(choice);else for(const subChoice of null!==(_a=choice.choices)&&void 0!==_a?_a:TcHmiRecipeEditComponents.ChoiceEditor.getAnyChoices())info.choices.push(subChoice)}return info}static __createNullEditorInfo(type,schema){return{type:"null",schema:schema,name:this.__generateName(type)}}static __createAnyEditorInfo(type,schema){const info=TcHmiRecipeEditComponents.ChoiceEditor.createAnyEditorInfo();return info.schema=schema,info.name=this.__generateName(type),info}static mergeEditorInfos(...toMerge){let result;const enumIndex=toMerge.findIndex(info=>"enum"===info.type);if(-1!==enumIndex)result=tchmi_clone_object(toMerge.splice(enumIndex,1)[0],SchemaParser.__cloneEditorInfoOptions);else{const nonAnyIndex=toMerge.findIndex(info=>"choice"!==info.type||void 0!==info.choices);result=-1!==nonAnyIndex?tchmi_clone_object(toMerge.splice(nonAnyIndex,1)[0],SchemaParser.__cloneEditorInfoOptions):tchmi_clone_object(toMerge.shift(),SchemaParser.__cloneEditorInfoOptions)}if(!result)return{type:"invalid",schema:{},name:"Invalid"};if(0===(toMerge=toMerge.filter(info=>"choice"!==info.type||void 0!==info.choices)).length)return result;switch(result.schema={allOf:[result.schema].concat(...toMerge.map(info=>info.schema))},result.type){case"boolean":return this.__mergeBooleanEditorInfos(result,toMerge);case"number":return this.__mergeNumberEditorInfos(result,toMerge);case"string":return this.__mergeStringEditorInfos(result,toMerge);case"time":return this.__mergeTimeEditorInfos(result,toMerge);case"enum":return this.__mergeEnumEditorInfos(result,toMerge);case"object":return this.__mergeObjectEditorInfos(result,toMerge);case"array":return this.__mergeArrayEditorInfos(result,toMerge);case"tuple":return this.__mergeTupleEditorInfos(result,toMerge);case"choice":return this.__mergeChoiceEditorInfos(result,toMerge);case"optional":return this.__mergeOptionalEditorInfos(result,toMerge);case"null":return this.__mergeNullEditorInfos(result,toMerge);case"invalid":return result}}static __mergeBooleanEditorInfos(target,toMerge){return toMerge.every(info=>"boolean"===info.type||"optional"===info.type&&"boolean"===info.editorInfo.type||"choice"===info.type&&(!info.choices||info.choices.some(choice=>"boolean"===choice.type)))?target:{type:"invalid",schema:target.schema,name:"Invalid"}}static __mergeNumberEditorInfos(target,toMerge){toMerge=toMerge.map(info=>{var _a;if("optional"===info.type)return info.editorInfo;if("choice"===info.type){const numberChoices=(null!==(_a=info.choices)&&void 0!==_a?_a:TcHmiRecipeEditComponents.ChoiceEditor.getAnyChoices()).filter(choice=>"number"===choice.type);return 0===numberChoices.length?info:1===numberChoices.length?numberChoices[0]:(numberChoices[1]=tchmi_clone_object(numberChoices[1]),numberChoices.reduce((result,current)=>{for(const specialValue of current.specialValues)result.specialValues.add(specialValue);return result.restrictions.push(...current.restrictions),result}))}return info});for(const info of toMerge){if("number"!==info.type)return{type:"invalid",schema:target.schema,name:"Invalid"};if(target.specialValues=new Set([...target.specialValues].filter(value=>info.specialValues.has(value))),info.restrictions.length>0)if(0===target.restrictions.length)target.restrictions=tchmi_clone_object(info.restrictions,SchemaParser.__cloneEditorInfoOptions);else{const restrictions=[];for(const targetRestriction of target.restrictions)for(const mergeRestriction of info.restrictions){const restriction={isInteger:targetRestriction.isInteger||mergeRestriction.isInteger};let isValid=!0;void 0!==targetRestriction.multipleOf&&void 0!==mergeRestriction.multipleOf?restriction.multipleOf=targetRestriction.multipleOf===mergeRestriction.multipleOf?targetRestriction.multipleOf:targetRestriction.multipleOf*mergeRestriction.multipleOf:void 0!==targetRestriction.multipleOf?restriction.multipleOf=targetRestriction.multipleOf:void 0!==mergeRestriction.multipleOf&&(restriction.multipleOf=mergeRestriction.multipleOf),targetRestriction.maximum&&mergeRestriction.maximum?targetRestriction.maximum.value<mergeRestriction.maximum.value?restriction.maximum=targetRestriction.maximum:mergeRestriction.maximum.value<targetRestriction.maximum.value?restriction.maximum=mergeRestriction.maximum:restriction.maximum={value:targetRestriction.maximum.value,exclusive:targetRestriction.maximum.exclusive||mergeRestriction.maximum.exclusive}:targetRestriction.maximum?restriction.maximum=targetRestriction.maximum:mergeRestriction.maximum&&(restriction.maximum=mergeRestriction.maximum),targetRestriction.minimum&&mergeRestriction.minimum?targetRestriction.minimum.value>mergeRestriction.minimum.value?restriction.minimum=targetRestriction.minimum:mergeRestriction.minimum.value>targetRestriction.minimum.value?restriction.minimum=mergeRestriction.minimum:restriction.minimum={value:targetRestriction.minimum.value,exclusive:targetRestriction.minimum.exclusive||mergeRestriction.minimum.exclusive}:targetRestriction.minimum?restriction.minimum=targetRestriction.minimum:mergeRestriction.minimum&&(restriction.minimum=mergeRestriction.minimum),restriction.maximum&&restriction.minimum&&(restriction.maximum.value<restriction.minimum.value||restriction.maximum.value===restriction.minimum.value&&(restriction.maximum.exclusive||restriction.minimum.exclusive))&&(isValid=!1),isValid&&!restrictions.some(r=>tchmi_equal(r,restriction,SchemaParser.__compareEditorInfoOptions))&&restrictions.push(restriction)}if(!(restrictions.length>0))return{type:"invalid",schema:target.schema,name:"Invalid"};target.restrictions=restrictions}}return target}static __mergeStringEditorInfos(target,toMerge){toMerge=toMerge.map(info=>{var _a;if("optional"===info.type)return info.editorInfo;if("choice"===info.type){const stringChoices=(null!==(_a=info.choices)&&void 0!==_a?_a:TcHmiRecipeEditComponents.ChoiceEditor.getAnyChoices()).filter(choice=>"string"===choice.type);return 0===stringChoices.length?info:1===stringChoices.length?stringChoices[0]:(stringChoices[1]=tchmi_clone_object(stringChoices[1]),stringChoices.reduce((result,current)=>(result.restrictions.push(...current.restrictions),result)))}return info});for(const info of toMerge){if("string"!==info.type)return{type:"invalid",schema:target.schema,name:"Invalid"};if(info.restrictions.length>0)if(0===target.restrictions.length)target.restrictions=tchmi_clone_object(info.restrictions,SchemaParser.__cloneEditorInfoOptions);else{const restrictions=[];for(const targetRestriction of target.restrictions)for(const mergeRestriction of info.restrictions){const restriction={};let isValid=!0;targetRestriction.patterns&&mergeRestriction.patterns?restriction.patterns=targetRestriction.patterns.concat(mergeRestriction.patterns):targetRestriction.patterns?restriction.patterns=tchmi_clone_object(targetRestriction.patterns,SchemaParser.__cloneEditorInfoOptions):mergeRestriction.patterns&&(restriction.patterns=tchmi_clone_object(mergeRestriction.patterns,SchemaParser.__cloneEditorInfoOptions)),targetRestriction.format&&mergeRestriction.format?targetRestriction.format===mergeRestriction.format?restriction.format=targetRestriction.format:isValid=!1:targetRestriction.format?restriction.format=targetRestriction.format:mergeRestriction.format&&(restriction.format=mergeRestriction.format),void 0!==targetRestriction.maxLength&&void 0!==mergeRestriction.maxLength?restriction.maxLength=Math.min(targetRestriction.maxLength,mergeRestriction.maxLength):void 0!==targetRestriction.maxLength?restriction.maxLength=targetRestriction.maxLength:void 0!==mergeRestriction.maxLength&&(restriction.maxLength=mergeRestriction.maxLength),void 0!==targetRestriction.minLength&&void 0!==mergeRestriction.minLength?restriction.minLength=Math.max(targetRestriction.minLength,mergeRestriction.minLength):void 0!==targetRestriction.minLength?restriction.minLength=targetRestriction.minLength:void 0!==mergeRestriction.minLength&&(restriction.minLength=mergeRestriction.minLength),void 0!==restriction.maxLength&&void 0!==restriction.minLength&&restriction.maxLength<restriction.minLength&&(isValid=!1),isValid&&!restrictions.some(r=>tchmi_equal(r,restriction,SchemaParser.__compareEditorInfoOptions))&&restrictions.push(restriction)}if(!(restrictions.length>0))return{type:"invalid",schema:target.schema,name:"Invalid"};target.restrictions=restrictions}}return target}static __mergeTimeEditorInfos(target,toMerge){toMerge=toMerge.map(info=>{var _a;if("optional"===info.type)return info.editorInfo;if("choice"===info.type){const timeChoices=(null!==(_a=info.choices)&&void 0!==_a?_a:TcHmiRecipeEditComponents.ChoiceEditor.getAnyChoices()).filter(choice=>"time"===choice.type);return 0===timeChoices.length?info:1===timeChoices.length?timeChoices[0]:(timeChoices[1]=tchmi_clone_object(timeChoices[1]),timeChoices.reduce((result,current)=>{for(const format of current.formats)result.formats.add(format);return result}))}return info});for(const info of toMerge){if("time"!==info.type)return{type:"invalid",schema:target.schema,name:"Invalid"};if(target.formats=new Set([...target.formats].filter(value=>info.formats.has(value))),0===target.formats.size)return{type:"invalid",schema:target.schema,name:"Invalid"}}return target}static __mergeEnumEditorInfos(target,toMerge){toMerge=toMerge.map(info=>"optional"!==info.type?info:info.editorInfo);for(const info of toMerge){if("enum"===info.type)for(const member of target.members.keys())info.members.has(member)?target.members.set(member,info.members.get(member)):target.members.delete(member);else for(const member of target.members.keys())TcHmiRecipeEditComponents.Editor.validate(info,member)||target.members.delete(member);if(0===target.members.size)return{type:"invalid",schema:target.schema,name:"Invalid"}}return target}static __mergeObjectEditorInfos(target,toMerge){const reduceObjectEditors=(result,current)=>{var _a,_b,_c,_d,_e,_f;if(result.additionalProperties.allowed=result.additionalProperties.allowed||current.additionalProperties.allowed,current.additionalProperties.editorInfo&&(result.additionalProperties.editorInfo?("choice"!==result.additionalProperties.editorInfo.type&&(result.additionalProperties.editorInfo={type:"choice",schema:{},name:"Choice",choices:[result.additionalProperties.editorInfo]}),"choice"===current.additionalProperties.editorInfo.type?current.additionalProperties.editorInfo.choices?null===(_a=result.additionalProperties.editorInfo.choices)||void 0===_a||_a.push(...current.additionalProperties.editorInfo.choices):delete result.additionalProperties.editorInfo.choices:null===(_b=result.additionalProperties.editorInfo.choices)||void 0===_b||_b.push(current.additionalProperties.editorInfo)):result.additionalProperties.editorInfo=current.additionalProperties.editorInfo),current.patternProperties){result.patternProperties||(result.patternProperties=new Map);for(const[regex,propertyInfo]of current.patternProperties){let resultKey=null,resultValue=propertyInfo;for(const[resultRegex,resultPropertyInfo]of result.patternProperties)if(regex.source===resultRegex.source){resultKey=resultRegex,resultValue="choice"!==resultPropertyInfo.type?{type:"choice",schema:{},name:"Choice",choices:[resultPropertyInfo]}:resultPropertyInfo,"choice"===propertyInfo.type?propertyInfo.choices?null===(_c=resultValue.choices)||void 0===_c||_c.push(...propertyInfo.choices):delete resultValue.choices:null===(_d=resultValue.choices)||void 0===_d||_d.push(propertyInfo);break}null===resultKey&&(resultKey=regex),result.patternProperties.set(resultKey,resultValue)}}const propertiesToMakeOptional=new Set(result.properties.keys());for(const[name,propertyInfo]of current.properties){let resultValue=result.properties.get(name);resultValue?(propertiesToMakeOptional.delete(name),"choice"!==resultValue.type&&(resultValue={type:"choice",schema:{},name:"Choice",choices:[resultValue]}),"choice"===propertyInfo.type?propertyInfo.choices?null===(_e=resultValue.choices)||void 0===_e||_e.push(...propertyInfo.choices):delete resultValue.choices:null===(_f=resultValue.choices)||void 0===_f||_f.push(propertyInfo)):(resultValue=propertyInfo,"optional"!==resultValue.type&&(resultValue={type:"optional",schema:{},name:resultValue.name,editorInfo:resultValue,temporarilyRequired:!1})),result.properties.set(name,resultValue)}for(const name of propertiesToMakeOptional){let resultValue=result.properties.get(name);resultValue&&("optional"!==resultValue.type&&(resultValue={type:"optional",schema:{},name:resultValue.name,editorInfo:resultValue,temporarilyRequired:!1},result.properties.set(name,resultValue)))}if(result.dependencies)if(current.dependencies){const dependenciesToDelete=new Set(result.dependencies.keys());for(const[name,dependency]of current.dependencies){let resultValue=result.dependencies.get(name);resultValue&&(dependenciesToDelete.delete(name),resultValue=reduceObjectEditors(resultValue,dependency),result.dependencies.set(name,resultValue))}for(const name of dependenciesToDelete)result.dependencies.delete(name)}else delete result.dependencies;return void 0!==result.minProperties&&(void 0===current.minProperties?delete result.minProperties:result.minProperties=Math.min(current.minProperties,result.minProperties)),void 0!==result.maxProperties&&(void 0===current.maxProperties?delete result.maxProperties:result.maxProperties=Math.max(current.maxProperties,result.maxProperties)),result};toMerge=toMerge.map(info=>{var _a;if("optional"===info.type)return info.editorInfo;if("choice"===info.type){const objectChoices=(null!==(_a=info.choices)&&void 0!==_a?_a:TcHmiRecipeEditComponents.ChoiceEditor.getAnyChoices()).filter(choice=>"object"===choice.type);return 0===objectChoices.length?info:1===objectChoices.length?objectChoices[0]:(objectChoices[1]=tchmi_clone_object(objectChoices[1]),objectChoices.reduce(reduceObjectEditors))}return info});for(const info of toMerge){if("object"!==info.type)return{type:"invalid",schema:target.schema,name:"Invalid"};if(!info.additionalProperties.allowed)for(const name of target.properties.keys())if(!(info.properties.has(name)||info.patternProperties&&Array.from(info.patternProperties.keys()).some(regex=>regex.test(name))))return{type:"invalid",schema:target.schema,name:"Invalid"};if(info.patternProperties){target.patternProperties||(target.patternProperties=new Map);for(const[regex,mergePropertyInfo]of info.patternProperties){let foundTarget=!1;for(const[targetRegex,targetPropertyInfo]of target.patternProperties)if(targetRegex.source===regex.source){foundTarget=!0,target.patternProperties.set(targetRegex,this.mergeEditorInfos(targetPropertyInfo,mergePropertyInfo));break}foundTarget||target.patternProperties.set(regex,mergePropertyInfo);for(const[targetName,targetPropertyInfo]of target.properties)regex.test(targetName)&&target.properties.set(targetName,this.mergeEditorInfos(targetPropertyInfo,mergePropertyInfo))}}if(info.additionalProperties.editorInfo)for(const[name,targetPropertyInfo]of target.properties)info.properties.has(name)||info.patternProperties&&Array.from(info.patternProperties.keys()).some(regex=>regex.test(name))||target.properties.set(name,this.mergeEditorInfos(targetPropertyInfo,info.additionalProperties.editorInfo));for(const[name,mergePropertyInfo]of info.properties){const targetPropertyInfo=TcHmiRecipeEditComponents.ObjectEditor.getEditorInfoForProperty(target,name);if("invalid"===targetPropertyInfo.type)return{type:"invalid",schema:target.schema,name:"Invalid"};target.properties.set(name,this.mergeEditorInfos(targetPropertyInfo,mergePropertyInfo))}if(target.additionalProperties.allowed=target.additionalProperties.allowed&&info.additionalProperties.allowed,target.additionalProperties.allowed?target.additionalProperties.editorInfo&&info.additionalProperties.editorInfo?target.additionalProperties.editorInfo=this.mergeEditorInfos(target.additionalProperties.editorInfo,info.additionalProperties.editorInfo):info.additionalProperties.editorInfo&&(target.additionalProperties.editorInfo=tchmi_clone_object(info.additionalProperties.editorInfo,SchemaParser.__cloneEditorInfoOptions)):target.additionalProperties.editorInfo&&delete target.additionalProperties.editorInfo,void 0!==info.maxProperties&&(void 0!==target.maxProperties?target.maxProperties=Math.min(target.maxProperties,info.maxProperties):target.maxProperties=info.maxProperties),void 0!==info.minProperties&&(void 0!==target.minProperties?target.minProperties=Math.max(target.minProperties,info.minProperties):target.minProperties=info.minProperties),info.dependencies)if(target.dependencies)for(const[name,mergeDependency]of info.dependencies){const targetDependency=target.dependencies.get(name);if(targetDependency){const dependency=this.mergeEditorInfos(targetDependency,mergeDependency);if("object"!==dependency.type)return{type:"invalid",schema:target.schema,name:"Invalid"};target.dependencies.set(name,dependency)}else target.dependencies.set(name,tchmi_clone_object(mergeDependency,SchemaParser.__cloneEditorInfoOptions))}else target.dependencies=tchmi_clone_object(info.dependencies,SchemaParser.__cloneEditorInfoOptions)}return void 0!==target.minProperties&&void 0!==target.maxProperties&&target.minProperties>target.maxProperties?{type:"invalid",schema:target.schema,name:"Invalid"}:target}static __mergeArrayEditorInfos(target,toMerge){toMerge=toMerge.map(info=>{var _a;if("optional"===info.type)return info.editorInfo;if("choice"===info.type){const arrayChoices=(null!==(_a=info.choices)&&void 0!==_a?_a:TcHmiRecipeEditComponents.ChoiceEditor.getAnyChoices()).filter(choice=>"array"===choice.type);return 0===arrayChoices.length?info:1===arrayChoices.length?arrayChoices[0]:(arrayChoices[1]=tchmi_clone_object(arrayChoices[1]),arrayChoices.reduce((result,current)=>{var _a,_b;return"choice"!==result.items.type&&(result.items={type:"choice",schema:{},name:"Choice",choices:[result.items]}),"choice"===current.items.type?current.items.choices?null===(_a=result.items.choices)||void 0===_a||_a.push(...current.items.choices):delete result.items.choices:null===(_b=result.items.choices)||void 0===_b||_b.push(current.items),void 0!==result.minItems&&(void 0===current.minItems?delete result.minItems:result.minItems=Math.min(current.minItems,result.minItems)),void 0!==result.maxItems&&(void 0===current.maxItems?delete result.maxItems:result.maxItems=Math.max(current.maxItems,result.maxItems)),result.uniqueItems=result.uniqueItems&&current.uniqueItems,result}))}return info});const itemInfos=[target.items];for(const info of toMerge){if("array"!==info.type)return{type:"invalid",schema:target.schema,name:"Invalid"};void 0!==info.minItems&&(void 0===target.minItems||target.minItems<info.minItems)&&(target.minItems=info.minItems),void 0!==info.maxItems&&(void 0===target.maxItems||target.maxItems>info.maxItems)&&(target.maxItems=info.maxItems),target.uniqueItems=target.uniqueItems||info.uniqueItems,itemInfos.push(info.items)}return void 0!==target.minItems&&void 0!==target.maxItems&&target.minItems>target.maxItems?{type:"invalid",schema:target.schema,name:"Invalid"}:(target.items=this.mergeEditorInfos(...itemInfos),"invalid"===target.items.type?{type:"invalid",schema:target.schema,name:"Invalid"}:target)}static __mergeTupleEditorInfos(target,toMerge){toMerge=toMerge.map(info=>{var _a;if("optional"===info.type)return info.editorInfo;if("choice"===info.type){const tupleChoices=(null!==(_a=info.choices)&&void 0!==_a?_a:TcHmiRecipeEditComponents.ChoiceEditor.getAnyChoices()).filter(choice=>"tuple"===choice.type);return 0===tupleChoices.length?info:1===tupleChoices.length?tupleChoices[0]:(tupleChoices[1]=tchmi_clone_object(tupleChoices[1]),tupleChoices.reduce((result,current)=>{var _a,_b,_c,_d;result.additionalItems.allowed=result.additionalItems.allowed||current.additionalItems.allowed,result.additionalItems.editorInfo&&(current.additionalItems.editorInfo?("choice"!==result.additionalItems.editorInfo.type&&(result.additionalItems.editorInfo={type:"choice",schema:{},name:"Choice",choices:[result.additionalItems.editorInfo]}),"choice"===current.additionalItems.editorInfo.type?current.additionalItems.editorInfo.choices?null===(_a=result.additionalItems.editorInfo.choices)||void 0===_a||_a.push(...current.additionalItems.editorInfo.choices):delete result.additionalItems.editorInfo.choices:null===(_b=result.additionalItems.editorInfo.choices)||void 0===_b||_b.push(current.additionalItems.editorInfo)):delete result.additionalItems.editorInfo);const itemsToMakeOptional=new Set(result.items.keys());for(const[index,itemInfo]of current.items.entries()){let resultValue=result.items[index];resultValue?(itemsToMakeOptional.delete(index),"choice"!==resultValue.type&&(resultValue={type:"choice",schema:{},name:"Choice",choices:[resultValue]}),"choice"===itemInfo.type?itemInfo.choices?null===(_c=resultValue.choices)||void 0===_c||_c.push(...itemInfo.choices):delete resultValue.choices:null===(_d=resultValue.choices)||void 0===_d||_d.push(itemInfo)):(resultValue=itemInfo,"optional"!==resultValue.type&&(resultValue={type:"optional",schema:{},name:resultValue.name,editorInfo:resultValue,temporarilyRequired:!1})),result.items[index]=resultValue}for(const index of itemsToMakeOptional){let resultValue=result.items[index];resultValue&&("optional"!==resultValue.type&&(resultValue={type:"optional",schema:{},name:resultValue.name,editorInfo:resultValue,temporarilyRequired:!1},result.items[index]=resultValue))}return void 0!==result.minItems&&(void 0===current.minItems?delete result.minItems:result.minItems=Math.min(current.minItems,result.minItems)),void 0!==result.maxItems&&(void 0===current.maxItems?delete result.maxItems:result.maxItems=Math.max(current.maxItems,result.maxItems)),result.uniqueItems=result.uniqueItems&&current.uniqueItems,result}))}return info});for(const info of toMerge){if("tuple"!==info.type)return{type:"invalid",schema:target.schema,name:"Invalid"};let index=0;for(const length=target.items.length;index<length;index++){if(index<info.items.length)target.items[index]=this.mergeEditorInfos(target.items[index],info.items[index]);else{if(!info.additionalItems.allowed)return{type:"invalid",schema:target.schema,name:"Invalid"};info.additionalItems.editorInfo&&(target.items[index]=this.mergeEditorInfos(target.items[index],info.additionalItems.editorInfo))}if("invalid"===target.items[index].type)return{type:"invalid",schema:target.schema,name:"Invalid"}}for(const length=info.items.length;index<length;index++){if(!target.additionalItems.allowed)return{type:"invalid",schema:target.schema,name:"Invalid"};if(target.additionalItems.editorInfo){if(target.items[index]=this.mergeEditorInfos(target.additionalItems.editorInfo,info.items[index]),"invalid"===target.items[index].type)return{type:"invalid",schema:target.schema,name:"Invalid"}}else target.items[index]=tchmi_clone_object(info.items[index],this.__cloneEditorInfoOptions)}target.additionalItems.allowed=target.additionalItems.allowed&&info.additionalItems.allowed,target.additionalItems.allowed?target.additionalItems.editorInfo&&info.additionalItems.editorInfo?target.additionalItems.editorInfo=this.mergeEditorInfos(target.additionalItems.editorInfo,info.additionalItems.editorInfo):info.additionalItems.editorInfo&&(target.additionalItems.editorInfo=tchmi_clone_object(info.additionalItems.editorInfo,SchemaParser.__cloneEditorInfoOptions)):target.additionalItems.editorInfo&&delete target.additionalItems.editorInfo,void 0!==info.minItems&&(void 0===target.minItems||target.minItems<info.minItems)&&(target.minItems=info.minItems),void 0!==info.maxItems&&(void 0===target.maxItems||target.maxItems>info.maxItems)&&(target.maxItems=info.maxItems),target.uniqueItems=target.uniqueItems||info.uniqueItems}return void 0!==target.minItems&&void 0!==target.maxItems&&target.minItems>target.maxItems?{type:"invalid",schema:target.schema,name:"Invalid"}:target}static __mergeChoiceEditorInfos(target,toMerge){var _a;function boolToNum(value){return value?1:0}function findValidMerge(choice,candidates){const mergeOrder=Array.from(candidates).sort((a,b)=>{const aVal=(boolToNum(a.name===choice.name)<<1)+boolToNum(a.type===choice.type);return(boolToNum(b.name===choice.name)<<1)+boolToNum(b.type===choice.type)-aVal});for(const mergeChoice of mergeOrder){const mergeResult=SchemaParser.mergeEditorInfos(choice,mergeChoice);if("invalid"!==mergeResult.type&&"choice"!==mergeResult.type)return{validCandidate:mergeChoice,mergedInfo:mergeResult}}return null}toMerge=toMerge.map(info=>"optional"!==info.type?info:info.editorInfo);for(const info of toMerge){const mergeChoices=new Set("choice"===info.type?null!==(_a=info.choices)&&void 0!==_a?_a:TcHmiRecipeEditComponents.ChoiceEditor.getAnyChoices():[info]),missingChoices=new Set(mergeChoices),originalChoices=new Set(target.choices);target.choices||(target.choices=TcHmiRecipeEditComponents.ChoiceEditor.getAnyChoices());for(let i=0;i<target.choices.length;i++){const mergeResult=findValidMerge(target.choices[i],mergeChoices);mergeResult?(target.choices[i]=mergeResult.mergedInfo,missingChoices.delete(mergeResult.validCandidate)):(target.choices.splice(i,1),i--)}for(const choice of missingChoices){const mergeResult=findValidMerge(choice,originalChoices);mergeResult&&target.choices.push(mergeResult.mergedInfo)}}return target}static __mergeOptionalEditorInfos(target,toMerge){let temporarilyRequired=!1;const unwrappedInfos=toMerge.map(info=>"optional"===info.type?(info.temporarilyRequired&&(temporarilyRequired=!0),info.editorInfo):(temporarilyRequired=!0,info)),merged=this.mergeEditorInfos(target.editorInfo,...unwrappedInfos);return target.editorInfo="optional"!==merged.type?merged:merged.editorInfo,target.temporarilyRequired=temporarilyRequired,target}static __mergeNullEditorInfos(target,toMerge){return(toMerge=toMerge.map(info=>"optional"!==info.type?info:info.editorInfo)).every(info=>"null"===info.type)?target:{type:"invalid",schema:target.schema,name:"Invalid"}}static editorInfoEquivalent(a,b){for(const key in a)if("schema"!==key&&!tchmi_equal(a[key],b[key],SchemaParser.__compareEditorInfoOptions))return!1;return!0}}SchemaParser.__restrictions=new Map([["number",["maximum","minimum","exclusiveMaximum","exclusiveMinimum","multipleOf"]],["string",["maxLength","minLength","pattern","format"]],["object",["properties","patternProperties","dependencies","maxProperties","minProperties","required","additionalProperties"]],["array",["additionalItems","items","maxItems","minItems","uniqueItems"]]]),SchemaParser.__cloneEditorInfoOptions={cloneMaps:{deepCloneKeys:!0,deepCloneValues:!0},cloneSets:{deepCloneValues:!0},cloneDates:!0},SchemaParser.__compareEditorInfoOptions={compareMaps:{deepCompareKeys:!0,deepCompareValues:!0},compareSets:{deepCompareValues:!0},compareDates:!0},TcHmiRecipeEditComponents.SchemaParser=SchemaParser}(Beckhoff.TcHmiRecipeEditComponents||(Beckhoff.TcHmiRecipeEditComponents={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiRecipeEditComponents){var _a,_RecipeEditor_tchmiFQN;class RecipeEditor{constructor(__element,__parentControl){this.__element=__element,this.__parentControl=__parentControl,this.__recipeManagementDomain=null,this.__recipe=null,this.__recipeName=null,this.__recipeTypeName=null,this.__editors=new Map,this.__localizations=void 0,this.__localizationSymbols=new Map,this.__onChangeManager=new Controls.Helpers.CallbackManager,this.onChange=this.__onChangeManager.getManipulators(),this.__onEditorChanged=()=>{this.__onChangeManager.trigger(this)};const table=document.createElement("table"),thead=document.createElement("thead");table.appendChild(thead);const tr=document.createElement("tr");thead.appendChild(tr),this.__tableHeaders={name:tr.appendChild(document.createElement("th")),value:tr.appendChild(document.createElement("th")),min:tr.appendChild(document.createElement("th")),max:tr.appendChild(document.createElement("th")),unit:tr.appendChild(document.createElement("th")),comment:tr.appendChild(document.createElement("th"))},this.__tableBody=document.createElement("tbody"),table.appendChild(this.__tableBody),__element.appendChild(table)}destroy(){this.clear();for(const entry of this.__localizationSymbols.values())entry.destroyWatch(),entry.symbol.destroy();this.__localizationSymbols.clear()}async populate(recipeType,recipe){var _b;let parsedRecipeType;try{parsedRecipeType=await new TcHmiRecipeEditComponents.RecipeTypeParser(this.__recipeManagementDomain,this.__parentControl).parse(recipeType.name,recipeType.recipeType)}catch(e){return void(TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.errorEx(`[Source=Control, Module=${this.__parentControl.getType()}, Origin=${__classPrivateFieldGet(RecipeEditor,_a,"f",_RecipeEditor_tchmiFQN)}, Id=${this.__parentControl.getId()}] Could not populate recipe editor. ${e instanceof Error?e.message:"Unknown error"}`))}this.__recipe=null!==(_b=recipe.recipe)&&void 0!==_b?_b:null,this.__recipeName=recipe.name,this.__recipeTypeName=recipeType.name,this.__render(parsedRecipeType,recipe.recipe)}clear(){this.__recipe=null,this.__recipeName=null,this.__recipeTypeName=null,this.__clearTableBodyAndEditors()}__clearTableBodyAndEditors(){for(const editor of this.__editors.values())editor.destroy();for(this.__editors.clear();this.__tableBody.firstElementChild;)this.__tableBody.firstElementChild.remove()}__render(recipeType,recipe){this.__clearTableBodyAndEditors();const fragment=document.createDocumentFragment();for(const member of recipeType.ungroupedMembers)fragment.appendChild(this.__createMemberRow(member,null==recipe?void 0:recipe.values[member.name]));for(const[groupName,group]of recipeType.memberGroups){const tr=document.createElement("tr"),groupCell=document.createElement("td");groupCell.colSpan=6,groupCell.textContent=groupName,tr.appendChild(groupCell),fragment.appendChild(tr);for(const member of group)fragment.appendChild(this.__createMemberRow(member,null==recipe?void 0:recipe.values[member.name]))}this.__tableBody.appendChild(fragment)}__createMemberRow(member,value){var _b,_c,_d,_e,_f;const tr=document.createElement("tr"),nameCell=document.createElement("td");if(nameCell.textContent=member.name,tr.appendChild(nameCell),"symbol"in member){const valueCell=document.createElement("td");valueCell.classList.add("value-cell");let editorInfo=TcHmiRecipeEditComponents.SchemaParser.parse(member.symbolType);member.schema&&Object.keys(member.schema).length>0&&(editorInfo=TcHmiRecipeEditComponents.SchemaParser.mergeEditorInfos(editorInfo,TcHmiRecipeEditComponents.SchemaParser.parse(member.schema)));const editor=TcHmiRecipeEditComponents.Editor.create(valueCell,editorInfo,this.__parentControl,null===(_b=this.__localizations)||void 0===_b?void 0:_b.editorLocalizations);this.__editors.set(member.name,editor),editor.onChange.add(this.__onEditorChanged),editor.setIsEnabled(member.enabled),void 0!==value?editor.setValue(value):void 0!==member.defaultValue&&editor.setValue(member.defaultValue),tr.appendChild(valueCell);const minCell=document.createElement("td");void 0!==(null===(_c=member.schema)||void 0===_c?void 0:_c.minimum)&&(minCell.textContent=member.schema.minimum.toString()),tr.appendChild(minCell);const maxCell=document.createElement("td");void 0!==(null===(_d=member.schema)||void 0===_d?void 0:_d.maximum)&&(maxCell.textContent=member.schema.maximum.toString()),tr.appendChild(maxCell);const unitCell=document.createElement("td");member.unit&&(unitCell.textContent=member.unit),tr.appendChild(unitCell);const commentCell=document.createElement("td");member.comment&&(commentCell.textContent=member.comment),tr.appendChild(commentCell)}else{const valueCell=document.createElement("td");valueCell.classList.add("value-cell");const editor=new TcHmiRecipeEditComponents.RecipeReferenceEditor(valueCell,member.recipeType,this.__parentControl);editor.setLocalizations(null!==(_f=null===(_e=this.__localizations)||void 0===_e?void 0:_e.recipeReferenceEditorLocalizations)&&void 0!==_f?_f:{}),this.__editors.set(member.name,editor),editor.onChange.add(this.__onEditorChanged),editor.setIsEnabled(member.enabled),void 0!==value&&editor.setValue(value),tr.appendChild(valueCell);const spanCell=document.createElement("td");spanCell.colSpan=3,tr.appendChild(spanCell);const commentCell=document.createElement("td");member.comment&&(commentCell.textContent=member.comment),tr.appendChild(commentCell)}return tr}isValid(){if(null===this.__recipeTypeName)return!1;if(null===this.__recipeName)return!1;for(const editor of this.__editors.values())if(!editor.getState().isValid)return!1;return!0}setValue(value){if(this.__recipeTypeName===value.recipeTypeName){this.__recipe=value;for(const[name,editor]of this.__editors)editor.setValue(this.__recipe.values[name])}}getState(){if(null===this.__recipeTypeName)return{isValid:!1};if(null===this.__recipeName)return{isValid:!1};const values={};for(const[name,editor]of this.__editors){const state=editor.getState();if(!state.isValid)return{isValid:!1};values[name]=state.value}return{isValid:!0,value:{recipeTypeName:this.__recipeTypeName,values:values},recipeName:this.__recipeName,recipeTypeName:this.__recipeTypeName}}hasChanges(){const state=this.getState();return!state.isValid||!tchmi_equal(this.__recipe,state.value)}getRecipeName(){return this.__recipeName}recipeExists(){return null!==this.__recipe}confirmSave(){const state=this.getState();state.isValid&&(this.__recipe=state.value),this.__onChangeManager.trigger(this)}setRecipeManagementDomain(domain){this.__recipeManagementDomain!==domain&&(this.__recipeManagementDomain=domain)}getRecipeManagementDomain(){return this.__recipeManagementDomain}setLocalizations(texts){if(this.__localizations||(this.__localizations=texts),texts.tableHeaderName&&(this.__watchLocalization("tableHeaderName","string"==typeof texts.tableHeaderName?{symbol:texts.tableHeaderName,formatValues:[]}:texts.tableHeaderName,text=>this.__tableHeaders.name.textContent=text),this.__localizations.tableHeaderName=texts.tableHeaderName),texts.tableHeaderValue&&(this.__watchLocalization("tableHeaderValue","string"==typeof texts.tableHeaderValue?{symbol:texts.tableHeaderValue,formatValues:[]}:texts.tableHeaderValue,text=>this.__tableHeaders.value.textContent=text),this.__localizations.tableHeaderValue=texts.tableHeaderValue),texts.tableHeaderMin&&(this.__watchLocalization("tableHeaderMin","string"==typeof texts.tableHeaderMin?{symbol:texts.tableHeaderMin,formatValues:[]}:texts.tableHeaderMin,text=>this.__tableHeaders.min.textContent=text),this.__localizations.tableHeaderMin=texts.tableHeaderMin),texts.tableHeaderMax&&(this.__watchLocalization("tableHeaderMax","string"==typeof texts.tableHeaderMax?{symbol:texts.tableHeaderMax,formatValues:[]}:texts.tableHeaderMax,text=>this.__tableHeaders.max.textContent=text),this.__localizations.tableHeaderMax=texts.tableHeaderMax),texts.tableHeaderUnit&&(this.__watchLocalization("tableHeaderUnit","string"==typeof texts.tableHeaderUnit?{symbol:texts.tableHeaderUnit,formatValues:[]}:texts.tableHeaderUnit,text=>this.__tableHeaders.unit.textContent=text),this.__localizations.tableHeaderUnit=texts.tableHeaderUnit),texts.tableHeaderComment&&(this.__watchLocalization("tableHeaderComment","string"==typeof texts.tableHeaderComment?{symbol:texts.tableHeaderComment,formatValues:[]}:texts.tableHeaderComment,text=>this.__tableHeaders.comment.textContent=text),this.__localizations.tableHeaderComment=texts.tableHeaderComment),texts.editorLocalizations){if(this.__localizations.editorLocalizations)for(const[name,subEditorLocalizations]of Object.entries(texts.editorLocalizations))if(this.__localizations.editorLocalizations[name])for(const[textName,text]of Object.entries(subEditorLocalizations))this.__localizations.editorLocalizations[name][textName]=text;else this.__localizations.editorLocalizations[name]=subEditorLocalizations;else this.__localizations.editorLocalizations=texts.editorLocalizations;for(const editor of this.__editors.values())editor instanceof TcHmiRecipeEditComponents.Editor&&editor.setLocalizations(texts.editorLocalizations)}if(texts.recipeReferenceEditorLocalizations){if(this.__localizations.recipeReferenceEditorLocalizations)for(const[name,text]of Object.entries(texts.recipeReferenceEditorLocalizations))this.__localizations.recipeReferenceEditorLocalizations[name]=text;else this.__localizations.recipeReferenceEditorLocalizations=texts.recipeReferenceEditorLocalizations;for(const editor of this.__editors.values())editor instanceof TcHmiRecipeEditComponents.RecipeReferenceEditor&&editor.setLocalizations(texts.recipeReferenceEditorLocalizations)}}__watchLocalization(name,localization,onChange){const existing=this.__localizationSymbols.get(name);null==existing||existing.destroyWatch(),null==existing||existing.symbol.destroy();const symbol=new TcHmi.Symbol(localization.symbol),destroyWatch=symbol.watch(data=>{var _b;if(data.error!==TcHmi.Errors.NONE)return void(TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.errorEx(`[Source=Control, Module=${this.__parentControl.getType()}, Id=${this.__parentControl.getId()}, Symbol=${localization.symbol}] `+TcHmi.Log.buildMessage(data.details)));let text=null!==(_b=data.value)&&void 0!==_b?_b:"";localization.formatValues.length>0&&(text=tchmi_format_string(text,...localization.formatValues)),onChange(text)});this.__localizationSymbols.set(name,{symbol:symbol,destroyWatch:destroyWatch})}}_RecipeEditor_tchmiFQN={value:"TcHmi.Controls.Beckhoff.TcHmiRecipeEditComponents."+(_a=RecipeEditor).name},TcHmiRecipeEditComponents.RecipeEditor=RecipeEditor}(Beckhoff.TcHmiRecipeEditComponents||(Beckhoff.TcHmiRecipeEditComponents={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiRecipeEditComponents){var _a,_RecipeReferenceEditor_tchmiFQN;class RecipeReferenceEditor{constructor(__element,__recipeType,__parentControl){this.__element=__element,this.__recipeType=__recipeType,this.__parentControl=__parentControl,this.__eventDestroyers=new Set,this.__recipe=null,this.__isEnabled=!0,this.__localizationSymbols=new Map,this.__onChangeManager=new Controls.Helpers.CallbackManager,this.onChange=this.__onChangeManager.getManipulators(),this.__onPressed=()=>{this.__parentControl.getIsEnabled()&&TcHmi.Access.checkAccess(this.__parentControl,"operate")&&this.__promptRecipe()},this.__onPathItemClicked=event=>{this.__parentControl.getIsEnabled()&&TcHmi.Access.checkAccess(this.__parentControl,"operate")&&event.target instanceof Element&&event.target.closest("li")&&this.__promptRecipe()},this.__onRecipeListReceived=rootDirectory=>{const filteredRecipes=tchmi_clone_object(rootDirectory),filter=dir=>{for(const[name,value]of Object.entries(dir))TcHmi.Server.RecipeManagement.isRecipe(value)?value.recipeTypeName!==this.__recipeType&&delete dir[name]:filter(value)};null!==filteredRecipes&&filter(filteredRecipes),this.__selectRecipePrompt.setRecipeList(filteredRecipes)};const controlClass=this.__parentControl.getType().replace(/\./g,"_");__element.classList.add(controlClass+"-editor"),this.__container=document.createElement("div"),this.__container.classList.add("compound-control-container","with-validation","invalid"),this.__pathBoxElement=this.__container.appendChild(document.createElement("div"));const pathDisplay=new Controls.Helpers.PathDisplay(this.__pathBoxElement,this.__parentControl);this.__selectRecipePrompt=new TcHmiRecipeEditComponents.SelectRecipePrompt(pathDisplay,this.__parentControl),this.__selectRecipePrompt.setBackgroundAction({close:!0,action:"cancel"});const name=`${this.__parentControl.getId()}.${this.constructor.name}-${tchmi_create_guid()}`,button=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",name+".button",{"data-tchmi-width":30,"data-tchmi-height":100,"data-tchmi-height-unit":"%","data-tchmi-text":"..."},this.__parentControl);if(!button)throw new Error("Could not create controls for button based editor.");this.__button=button,this.__container.appendChild(button.getElement()[0]),this.__element.appendChild(this.__container),this.__eventDestroyers.add(TcHmi.EventProvider.register(button.getId()+".onPressed",this.__onPressed)),this.__pathBoxElement.addEventListener("click",this.__onPathItemClicked),this.__parentControl.__registerOnRecipeListReceived(this.__onRecipeListReceived),this.__selectRecipePrompt.resume()}destroy(){TcHmi.Binding.removeEx2(null,"Tooltip",this.__button);for(const destroy of this.__eventDestroyers)destroy();this.__eventDestroyers.clear(),this.__pathBoxElement.removeEventListener("click",this.__onPathItemClicked),this.__button.destroy(),this.__parentControl.__unregisterOnRecipeListReceived(this.__onRecipeListReceived),this.__selectRecipePrompt.suspend()}async setValue(value){value?this.__setRecipe(await this.__selectRecipePrompt.setPath(value.split("::"))):(this.__selectRecipePrompt.reset(),this.__setRecipe(null))}getState(){return this.__recipe&&this.__recipe.recipe.recipeTypeName===this.__recipeType?{isValid:!0,value:this.__recipe.name}:{isValid:!1}}setIsEnabled(isEnabled){this.__isEnabled=isEnabled,this.__element.classList.toggle("disabled",!isEnabled),this.__button.setIsEnabled(isEnabled)}getIsEnabled(){return this.__isEnabled}async __promptRecipe(){try{const result=await this.__selectRecipePrompt.prompt();result.isOk&&this.__setRecipe(result.value)}catch(e){}}__setRecipe(recipe){this.__recipe=recipe,this.__container.classList.toggle("invalid",!this.__recipe||this.__recipe.recipe.recipeTypeName!==this.__recipeType),this.__onChangeManager.trigger(this)}setLocalizations(texts){texts.openPopupButtonTooltip&&("string"==typeof texts.openPopupButtonTooltip?(this.__unwatchLocalization("openPopupButtonTooltip"),TcHmi.Binding.createEx2(texts.openPopupButtonTooltip,"Tooltip",this.__button)):(TcHmi.Binding.removeEx2(null,"Tooltip",this.__button),this.__watchLocalization("openPopupButtonTooltip",texts.openPopupButtonTooltip,text=>this.__button.setTooltip(text)))),this.__selectRecipePrompt.setLocalizations({buttonTextOk:texts.buttonTextOk,buttonTooltipOk:texts.buttonTooltipOk,buttonTextCancel:texts.buttonTextCancel,buttonTooltipCancel:texts.buttonTooltipCancel,headerText:texts.recipePopupHeaderText})}__watchLocalization(name,localization,onChange){const existing=this.__localizationSymbols.get(name);null==existing||existing.destroyWatch(),null==existing||existing.symbol.destroy();const symbol=new TcHmi.Symbol(localization.symbol),destroyWatch=symbol.watch(data=>{var _b;if(data.error!==TcHmi.Errors.NONE)return void(TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.errorEx(`[Source=Control, Module=${this.__parentControl.getType()}, Origin=${__classPrivateFieldGet(RecipeReferenceEditor,_a,"f",_RecipeReferenceEditor_tchmiFQN)}, Id=${this.__parentControl.getId()}, Symbol=${localization.symbol}] `+TcHmi.Log.buildMessage(data.details)));let text=null!==(_b=data.value)&&void 0!==_b?_b:"";localization.formatValues.length>0&&(text=tchmi_format_string(text,...localization.formatValues)),onChange(text)});this.__localizationSymbols.set(name,{symbol:symbol,destroyWatch:destroyWatch})}__unwatchLocalization(name){const existing=this.__localizationSymbols.get(name);existing&&(existing.destroyWatch(),existing.symbol.destroy(),this.__localizationSymbols.delete(name))}}_RecipeReferenceEditor_tchmiFQN={value:"TcHmi.Controls.Beckhoff.TcHmiRecipeEditComponents."+(_a=RecipeReferenceEditor).name},TcHmiRecipeEditComponents.RecipeReferenceEditor=RecipeReferenceEditor}(Beckhoff.TcHmiRecipeEditComponents||(Beckhoff.TcHmiRecipeEditComponents={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiRecipeEditComponents){class CreateRecipePrompt extends Controls.Helpers.OkCancelPrompt{constructor(parentControl){super(parentControl),this.__forbiddenNames=new Set,this.__recipeType=null,this.__onTextChanged=()=>{if(!this.__parentControl.getIsEnabled())return;if(!TcHmi.Access.checkAccess(this.__parentControl,"operate"))return;const text=this.__textbox.getText(),isValid=void 0!==text&&this.__isValidName(text);this.__okButton.setIsEnabled(null!==this.__recipeType&&isValid),this.__textbox.getElement()[0].classList.toggle("invalid",!isValid)},this.__onSelectPressed=()=>{this.__parentControl.getIsEnabled()&&TcHmi.Access.checkAccess(this.__parentControl,"operate")&&this.__promptRecipeType()},this.__onPathItemClicked=event=>{this.__parentControl.getIsEnabled()&&TcHmi.Access.checkAccess(this.__parentControl,"operate")&&event.target instanceof Element&&event.target.closest("li")&&this.__promptRecipeType()},this.__nameLabel=document.createElement("span"),this.__nameLabel.className=this.__className+"-label-block",this.__elementContent.appendChild(this.__nameLabel);const textbox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiTextbox",`${this.__parentControl.getId()}.${this.__name}Popup.textbox`,{"data-tchmi-width":300,"data-tchmi-height":26,"data-tchmi-content-padding":{top:3,right:3,bottom:3,left:3}},this.__parentControl);if(!textbox)throw new Error("Could not create controls for NamePrompt.");this.__textbox=textbox;const textboxElement=textbox.getElement()[0];textboxElement.classList.add("with-validation"),this.__elementContent.appendChild(textboxElement),this.__destroyers.push(TcHmi.EventProvider.register(textbox.getId()+".onTextChanged",this.__onTextChanged)),this.__recipeTypeLabel=document.createElement("span"),this.__recipeTypeLabel.className=this.__className+"-label-block",this.__elementContent.appendChild(this.__recipeTypeLabel),this.__pathBoxElement=document.createElement("div"),this.__pathBoxElement.className=this.__className+"-path-box",this.__elementContent.appendChild(this.__pathBoxElement);const selectButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__parentControl.getId()}.${this.__name}Popup.selectButton`,{"data-tchmi-width":35,"data-tchmi-height":35,"data-tchmi-text":"..."},this.__parentControl);if(!selectButton)throw new Error("Could not create controls for NamePrompt.");const selectButtonElement=selectButton.getElement()[0];selectButtonElement.classList.add(this.__className+"-select-button"),this.__elementContent.appendChild(selectButtonElement),this.__destroyers.push(TcHmi.EventProvider.register(selectButton.getId()+".onPressed",this.__onSelectPressed));const pathDisplay=new Controls.Helpers.PathDisplay(this.__pathBoxElement,this.__parentControl);this.__selectRecipeTypePrompt=new TcHmiRecipeEditComponents.SelectRecipeTypePrompt(pathDisplay,this.__parentControl),this.__selectRecipeTypePrompt.setBackgroundAction({close:!0,action:"cancel"}),this.__childControls.push(textbox,selectButton),this.__selectButton=selectButton}destroy(force=!1){TcHmi.Binding.removeEx2(null,"Tooltip",this.__selectButton),super.destroy(force)}__isValidName(text){return text.length>0&&!text.includes("::")&&".."!==text&&"."!==text&&!this.__forbiddenNames.has(text)}async __promptRecipeType(){try{const result=await this.__selectRecipeTypePrompt.prompt();if(result.isOk){this.__recipeType=result.value;const text=this.__textbox.getText();this.__okButton.setIsEnabled(void 0!==text&&this.__isValidName(text))}}catch(e){}}__ok(){var _a,_b;const text=this.__textbox.getText();this.__recipeType&&void 0!==text&&this.__isValidName(text)?null===(_b=this.__prompt)||void 0===_b||_b.answer({isOk:!0,value:{name:text,recipeTypeName:this.__recipeType.name,recipeType:this.__recipeType.recipeType}}):null===(_a=this.__prompt)||void 0===_a||_a.error(new Error("Invalid name or missing recipe type."))}setRecipeManagementDomain(recipeManagementDomain){this.__selectRecipeTypePrompt.setRecipeManagementDomain(recipeManagementDomain)}prompt(forbiddenNames=null,defaultValue=""){this.__forbiddenNames=new Set(forbiddenNames),this.__recipeType=null,this.__textbox.setText(defaultValue);const input=this.__textbox.getElement()[0].querySelector("input");return input instanceof HTMLInputElement&&(input.selectionDirection="forward",input.selectionStart=0,input.selectionEnd=input.value.length),this.__okButton.setIsEnabled(!1),super.prompt()}show(){super.show(),this.__selectRecipeTypePrompt.resume();const input=this.__textbox.getElement()[0].querySelector("input");input instanceof HTMLInputElement&&input.focus(),this.__pathBoxElement.addEventListener("click",this.__onPathItemClicked)}hide(){super.hide(),this.__selectRecipeTypePrompt.reset(),this.__selectRecipeTypePrompt.suspend(),this.__pathBoxElement.removeEventListener("click",this.__onPathItemClicked)}setLocalizations(texts){super.setLocalizations(texts),texts.headerText&&this.__watchLocalization("headerText","string"==typeof texts.headerText?{symbol:texts.headerText,formatValues:[]}:texts.headerText,text=>this.__elementHeader.textContent=text),texts.nameLabelText&&this.__watchLocalization("nameLabelText","string"==typeof texts.nameLabelText?{symbol:texts.nameLabelText,formatValues:[]}:texts.nameLabelText,text=>this.__nameLabel.textContent=text),texts.recipeTypeLabelText&&this.__watchLocalization("recipeTypeLabelText","string"==typeof texts.recipeTypeLabelText?{symbol:texts.recipeTypeLabelText,formatValues:[]}:texts.recipeTypeLabelText,text=>this.__recipeTypeLabel.textContent=text),texts.selectButtonTooltip&&("string"==typeof texts.selectButtonTooltip?(this.__unwatchLocalization("selectButtonTooltip"),TcHmi.Binding.createEx2(texts.selectButtonTooltip,"Tooltip",this.__selectButton)):(TcHmi.Binding.removeEx2(null,"Tooltip",this.__selectButton),this.__watchLocalization("selectButtonTooltip",texts.selectButtonTooltip,text=>this.__selectButton.setTooltip(text)))),this.__selectRecipeTypePrompt.setLocalizations({buttonTextOk:texts.buttonTextOk,buttonTooltipOk:texts.buttonTooltipOk,buttonTextCancel:texts.buttonTextCancel,buttonTooltipCancel:texts.buttonTooltipCancel,headerText:texts.recipeTypePopupHeaderText})}}TcHmiRecipeEditComponents.CreateRecipePrompt=CreateRecipePrompt}(Beckhoff.TcHmiRecipeEditComponents||(Beckhoff.TcHmiRecipeEditComponents={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiRecipeEditComponents){class SelectRecipePrompt extends Controls.Helpers.OkCancelPrompt{constructor(pathDisplay,parentControl){super(parentControl),this.__initialPath=null,this.__onPathChanged=(currentItem,path)=>{currentItem&&TcHmi.Server.RecipeManagement.isRecipe(currentItem.payload)?(this.__okButton.setIsEnabled(!0),this.__ok()):this.__okButton.setIsEnabled(!1)},this.__onSelectionChanged=selectedItems=>{selectedItems&&1===selectedItems.length&&TcHmi.Server.RecipeManagement.isRecipe(selectedItems[0].payload)?this.__okButton.setIsEnabled(!0):this.__okButton.setIsEnabled(!1)};const ulist=document.createElement("ul");ulist.className=this.__className+"-browsing-box",this.__elementContent.appendChild(ulist);const browsingDisplay=new Controls.Helpers.ListBrowsingDisplay(ulist,this.__parentControl);this.__recipeBrowser=new Controls.Helpers.DirectoryBrowser([pathDisplay,browsingDisplay]),this.__recipeBrowser.onPathChange.add(this.__onPathChanged),this.__recipeBrowser.onSelectionChange.add(this.__onSelectionChanged)}suspend(){this.__recipeBrowser.suspend(!0)}resume(){this.__recipeBrowser.resume()}async setPath(value){var _b;await this.__recipeBrowser.setPath(value);const currentItem=null===(_b=this.__recipeBrowser.getCurrentItem())||void 0===_b?void 0:_b.payload,path=this.__recipeBrowser.getPath();return currentItem&&TcHmi.Server.RecipeManagement.isRecipe(currentItem)&&path?{name:path.join("::"),recipe:currentItem}:null}reset(){this.__recipeBrowser.setPath([])}setRecipeList(rootDirectory){this.__recipeBrowser.setDirectory(rootDirectory,folder=>new Map(Object.entries(folder)),TcHmi.Server.RecipeManagement.isRecipe)}async __ok(){var _b,_c,_d,_e,_f,_g;let currentItem=null===(_b=this.__recipeBrowser.getCurrentItem())||void 0===_b?void 0:_b.payload;if(!currentItem)return void(null===(_c=this.__prompt)||void 0===_c||_c.error(new Error("No recipe types available.")));const selectedItem=null===(_d=this.__recipeBrowser.getSelectedItems())||void 0===_d?void 0:_d[0];let path=this.__recipeBrowser.getPath();!TcHmi.Server.RecipeManagement.isRecipe(currentItem)&&selectedItem&&path&&(await this.__recipeBrowser.setPath(path.concat(selectedItem.name)),currentItem=null===(_e=this.__recipeBrowser.getCurrentItem())||void 0===_e?void 0:_e.payload,path=this.__recipeBrowser.getPath()),currentItem&&TcHmi.Server.RecipeManagement.isRecipe(currentItem)&&path?null===(_f=this.__prompt)||void 0===_f||_f.answer({isOk:!0,value:{name:path.join("::"),recipe:currentItem}}):null===(_g=this.__prompt)||void 0===_g||_g.error(new Error("Invalid recipe type selection."))}__cancel(){this.__initialPath&&this.__recipeBrowser.setPath(this.__initialPath),super.__cancel()}async prompt(){var _b;this.__initialPath=this.__recipeBrowser.getPath();const currentItem=null===(_b=this.__recipeBrowser.getCurrentItem())||void 0===_b?void 0:_b.payload,promise=super.prompt();return this.__initialPath&&this.__initialPath.length>0&&currentItem&&TcHmi.Server.RecipeManagement.isRecipe(currentItem)&&await this.__recipeBrowser.setPath(this.__initialPath.slice(0,-1))&&this.__recipeBrowser.selectItem(this.__initialPath[this.__initialPath.length-1],!1),promise}setLocalizations(texts){super.setLocalizations(texts),texts.headerText&&this.__watchLocalization("headerText","string"==typeof texts.headerText?{symbol:texts.headerText,formatValues:[]}:texts.headerText,text=>this.__elementHeader.textContent=text)}}TcHmiRecipeEditComponents.SelectRecipePrompt=SelectRecipePrompt}(Beckhoff.TcHmiRecipeEditComponents||(Beckhoff.TcHmiRecipeEditComponents={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiRecipeEditComponents){var _a,_SelectRecipeTypePrompt_tchmiFQN;class SelectRecipeTypePrompt extends Controls.Helpers.OkCancelPrompt{constructor(pathDisplay,parentControl){super(parentControl),this.__initialPath=null,this.__recipeManagementDomain=null,this.__unwatchRecipeList=null,this.__onPathChanged=(currentItem,path)=>{currentItem&&TcHmi.Server.RecipeManagement.isRecipeType(currentItem.payload)?(this.__okButton.setIsEnabled(!0),this.__ok()):this.__okButton.setIsEnabled(!1)},this.__onSelectionChanged=selectedItems=>{selectedItems&&1===selectedItems.length&&TcHmi.Server.RecipeManagement.isRecipeType(selectedItems[0].payload)?this.__okButton.setIsEnabled(!0):this.__okButton.setIsEnabled(!1)},this.__onRecipeTypeListWatch=data=>data.error?(TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.errorEx(`[Source=Control, Module=${this.__parentControl.getType()}, Origin=${__classPrivateFieldGet(SelectRecipeTypePrompt,_a,"f",_SelectRecipeTypePrompt_tchmiFQN)}, Id=${this.__parentControl.getId()}] Failed to list recipe types of domain ${this.__recipeManagementDomain}. Please make sure the domain is a recipe management extension. ${TcHmi.Log.buildMessage(data.details)}`),void this.__recipeTypeBrowser.setDirectory(null,folder=>new Map(Object.entries(folder)),TcHmi.Server.RecipeManagement.isRecipeType)):data.value?void this.__recipeTypeBrowser.setDirectory(data.value,folder=>new Map(Object.entries(folder)),TcHmi.Server.RecipeManagement.isRecipeType):(TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.errorEx(`[Source=Control, Module=${this.__parentControl.getType()}, Id=${this.__parentControl.getId()}] Failed to list recipe types of domain ${this.__recipeManagementDomain}. Please make sure the domain is a recipe management extension.`),void this.__recipeTypeBrowser.setDirectory(null,folder=>new Map(Object.entries(folder)),TcHmi.Server.RecipeManagement.isRecipeType));const ulist=document.createElement("ul");ulist.className=this.__className+"-browsing-box",this.__elementContent.appendChild(ulist);const browsingDisplay=new Controls.Helpers.ListBrowsingDisplay(ulist,this.__parentControl);this.__recipeTypeBrowser=new Controls.Helpers.DirectoryBrowser([pathDisplay,browsingDisplay]),this.__recipeTypeBrowser.onPathChange.add(this.__onPathChanged),this.__recipeTypeBrowser.onSelectionChange.add(this.__onSelectionChanged)}suspend(){var _b;this.__recipeTypeBrowser.suspend(!0),null===(_b=this.__unwatchRecipeList)||void 0===_b||_b.call(this),this.__unwatchRecipeList=null}resume(){this.__recipeManagementDomain&&(this.__unwatchRecipeList=TcHmi.Server.RecipeManagement.watchRecipeTypesList({domain:this.__recipeManagementDomain,parallel:!0},this.__onRecipeTypeListWatch)),this.__recipeTypeBrowser.resume()}reset(){this.__recipeTypeBrowser.setPath([])}setRecipeManagementDomain(recipeManagementDomain){var _b;this.__recipeManagementDomain=recipeManagementDomain,null===(_b=this.__unwatchRecipeList)||void 0===_b||_b.call(this),this.__isShowing&&this.__recipeManagementDomain?this.__unwatchRecipeList=TcHmi.Server.RecipeManagement.watchRecipeTypesList({domain:this.__recipeManagementDomain,parallel:!0},this.__onRecipeTypeListWatch):this.__unwatchRecipeList=null}async __ok(){var _b,_c,_d,_e,_f,_g;let currentItem=null===(_b=this.__recipeTypeBrowser.getCurrentItem())||void 0===_b?void 0:_b.payload;if(!currentItem)return void(null===(_c=this.__prompt)||void 0===_c||_c.error(new Error("No recipe types available.")));const selectedItem=null===(_d=this.__recipeTypeBrowser.getSelectedItems())||void 0===_d?void 0:_d[0];let path=this.__recipeTypeBrowser.getPath();!TcHmi.Server.RecipeManagement.isRecipeType(currentItem)&&selectedItem&&path&&(await this.__recipeTypeBrowser.setPath(path.concat(selectedItem.name)),currentItem=null===(_e=this.__recipeTypeBrowser.getCurrentItem())||void 0===_e?void 0:_e.payload,path=this.__recipeTypeBrowser.getPath()),currentItem&&TcHmi.Server.RecipeManagement.isRecipeType(currentItem)&&path?null===(_f=this.__prompt)||void 0===_f||_f.answer({isOk:!0,value:{name:path.join("::"),recipeType:currentItem}}):null===(_g=this.__prompt)||void 0===_g||_g.error(new Error("Invalid recipe type selection."))}__cancel(){this.__initialPath&&this.__recipeTypeBrowser.setPath(this.__initialPath),super.__cancel()}async prompt(){var _b;this.__initialPath=this.__recipeTypeBrowser.getPath();const currentItem=null===(_b=this.__recipeTypeBrowser.getCurrentItem())||void 0===_b?void 0:_b.payload,promise=super.prompt();return this.__initialPath&&this.__initialPath.length>0&&currentItem&&TcHmi.Server.RecipeManagement.isRecipeType(currentItem)&&await this.__recipeTypeBrowser.setPath(this.__initialPath.slice(0,-1))&&this.__recipeTypeBrowser.selectItem(this.__initialPath[this.__initialPath.length-1],!1),promise}setLocalizations(texts){super.setLocalizations(texts),texts.headerText&&this.__watchLocalization("headerText","string"==typeof texts.headerText?{symbol:texts.headerText,formatValues:[]}:texts.headerText,text=>this.__elementHeader.textContent=text)}}_SelectRecipeTypePrompt_tchmiFQN={value:"TcHmi.Controls.Beckhoff.TcHmiRecipeEditComponents."+(_a=SelectRecipeTypePrompt).name},TcHmiRecipeEditComponents.SelectRecipeTypePrompt=SelectRecipeTypePrompt}(Beckhoff.TcHmiRecipeEditComponents||(Beckhoff.TcHmiRecipeEditComponents={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiRecipeEditComponents){class FileConflictPrompt extends Controls.Helpers.OkCancelPrompt{constructor(conflictingNames,existingNames,parentControl){super(parentControl),this.__doAll=void 0,this.__onRadioStateChanged=()=>{let isValid=!0;const allActive={skip:!0,replace:!0,both:!0};for(const controls of this.__rows.values()){let activeRadios=0;for(const[controlName,radio]of Object.entries(controls))"Active"===radio.getRadioState()&&radio.getIsEnabled()?activeRadios++:allActive[controlName]=!1;if(1!==activeRadios){isValid=!1;break}}this.__okButton.setIsEnabled(isValid),this.__doAll&&(this.__doAll.controls.skip.setRadioState(allActive.skip&&isValid?"Active":"Normal"),this.__doAll.controls.replace.setRadioState(allActive.replace&&isValid?"Active":"Normal"),this.__doAll.controls.both.setRadioState(allActive.both&&isValid?"Active":"Normal"))},this.__existingNames=new Set(existingNames),this.__elementLabel=this.__elementContent.appendChild(document.createElement("span")),this.__elementLabel.className=this.__className+"-label-block";const elementScrollContainer=this.__elementContent.appendChild(document.createElement("div"));elementScrollContainer.className=this.__className+"-scroll-container",this.__rows=new Map;for(const[name,replaceable]of conflictingNames){const row=this.__buildRow(name,replaceable,this.__onRadioStateChanged);elementScrollContainer.appendChild(row.container),this.__rows.set(name,row.controls)}if(this.__rows.size>1){const row=this.__buildRow("");TcHmi.EventProvider.register(row.controls.skip.getId()+".onRadioStateChanged",this.__getOnAllRadioStateChangedHandler("skip")),TcHmi.EventProvider.register(row.controls.replace.getId()+".onRadioStateChanged",this.__getOnAllRadioStateChangedHandler("replace")),TcHmi.EventProvider.register(row.controls.both.getId()+".onRadioStateChanged",this.__getOnAllRadioStateChangedHandler("both")),this.__elementContent.insertBefore(row.container,elementScrollContainer),this.__doAll={label:row.label,controls:row.controls}}}destroy(force=!1){for(const row of this.__rows.values())TcHmi.Binding.removeEx2(null,"Text",row.skip),TcHmi.Binding.removeEx2(null,"Text",row.replace),TcHmi.Binding.removeEx2(null,"Text",row.both);this.__doAll&&(TcHmi.Binding.removeEx2(null,"Text",this.__doAll.controls.skip),TcHmi.Binding.removeEx2(null,"Text",this.__doAll.controls.replace),TcHmi.Binding.removeEx2(null,"Text",this.__doAll.controls.both)),super.destroy(force)}__buildRow(labelText,replaceable=!0,eventHandler){const container=document.createElement("div");container.className=this.__className+"-radio-row";const label=container.appendChild(document.createElement("span"));label.textContent=labelText;const guid=tchmi_create_guid(),[skip,replace,both]=["skip","replace","both"].map(controlName=>{const control=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiRadioButton",`${this.__name}.${controlName}.${guid}`,{"data-tchmi-radio-group":guid,"data-tchmi-is-enabled":"replace"!==controlName||replaceable,"data-tchmi-ignore-escape-sequences":!0},this.__parentControl);if(!control)throw new Error("Could not create controls for FileConflictPrompt");return eventHandler&&TcHmi.EventProvider.register(control.getId()+".onRadioStateChanged",eventHandler),container.appendChild(control.getElement()[0]),this.__childControls.push(control),control});return{container:container,label:label,controls:{skip:skip,replace:replace,both:both}}}__getOnAllRadioStateChangedHandler(name){return()=>{for(const controls of this.__rows.values())controls[name].getIsEnabled()&&controls[name].setRadioState("Active")}}__ok(){var _a;const answerValue=new Map;for(const[name,controls]of this.__rows)if("Active"===controls.replace.getRadioState())answerValue.set(name,name),this.__existingNames.add(name);else if("Active"===controls.both.getRadioState()){const dotIndex=name.lastIndexOf(".");let rawName=dotIndex>0?name.slice(0,dotIndex):name;const extension=dotIndex>0?name.slice(dotIndex):"",counterEnding=rawName.match(/\((\d+)\)$/);let counter,newName;counterEnding?(counter=parseInt(counterEnding[1],10),rawName=rawName.slice(0,counterEnding.index),Number.isNaN(counter)&&(counter=0)):(counter=0,rawName+=" ");do{counter++,newName=`${rawName}(${counter})${extension}`}while(this.__existingNames.has(newName));answerValue.set(name,newName),this.__existingNames.add(newName)}null===(_a=this.__prompt)||void 0===_a||_a.answer({isOk:!0,value:answerValue})}setLocalizations(texts){if(super.setLocalizations(texts),texts.headerText&&this.__watchLocalization("headerText","string"==typeof texts.headerText?{symbol:texts.headerText,formatValues:[]}:texts.headerText,text=>this.__elementHeader.textContent=text),texts.labelText&&this.__watchLocalization("labelText","string"==typeof texts.labelText?{symbol:texts.labelText,formatValues:[]}:texts.labelText,text=>this.__elementLabel.textContent=text),texts.labelDoForAll&&this.__doAll&&this.__watchLocalization("labelDoForAll","string"==typeof texts.labelDoForAll?{symbol:texts.labelDoForAll,formatValues:[]}:texts.labelDoForAll,text=>this.__doAll.label.textContent=text),texts.radioTextSkip)if("string"==typeof texts.radioTextSkip){this.__unwatchLocalization("buttonTextSkip");for(const row of this.__rows.values())TcHmi.Binding.createEx2(texts.radioTextSkip,"Text",row.skip);this.__doAll&&TcHmi.Binding.createEx2(texts.radioTextSkip,"Text",this.__doAll.controls.skip)}else{for(const row of this.__rows.values())TcHmi.Binding.removeEx2(null,"Text",row.skip);this.__doAll&&TcHmi.Binding.removeEx2(null,"Text",this.__doAll.controls.skip),this.__watchLocalization("buttonTextSkip",texts.radioTextSkip,text=>{for(const row of this.__rows.values())row.skip.setText(text);this.__doAll&&this.__doAll.controls.skip.setText(text)})}if(texts.radioTextReplace)if("string"==typeof texts.radioTextReplace){this.__unwatchLocalization("buttonTextReplace");for(const row of this.__rows.values())TcHmi.Binding.createEx2(texts.radioTextReplace,"Text",row.replace);this.__doAll&&TcHmi.Binding.createEx2(texts.radioTextReplace,"Text",this.__doAll.controls.replace)}else{for(const row of this.__rows.values())TcHmi.Binding.removeEx2(null,"Text",row.replace);this.__doAll&&TcHmi.Binding.removeEx2(null,"Text",this.__doAll.controls.replace),this.__watchLocalization("buttonTextReplace",texts.radioTextReplace,text=>{for(const row of this.__rows.values())row.replace.setText(text);this.__doAll&&this.__doAll.controls.replace.setText(text)})}if(texts.radioTextKeepBoth)if("string"==typeof texts.radioTextKeepBoth){this.__unwatchLocalization("buttonTextKeepBoth");for(const row of this.__rows.values())TcHmi.Binding.createEx2(texts.radioTextKeepBoth,"Text",row.both);this.__doAll&&TcHmi.Binding.createEx2(texts.radioTextKeepBoth,"Text",this.__doAll.controls.both)}else{for(const row of this.__rows.values())TcHmi.Binding.removeEx2(null,"Text",row.both);this.__doAll&&TcHmi.Binding.removeEx2(null,"Text",this.__doAll.controls.both),this.__watchLocalization("buttonTextKeepBoth",texts.radioTextKeepBoth,text=>{for(const row of this.__rows.values())row.both.setText(text);this.__doAll&&this.__doAll.controls.both.setText(text)})}}}TcHmiRecipeEditComponents.FileConflictPrompt=FileConflictPrompt}(Beckhoff.TcHmiRecipeEditComponents||(Beckhoff.TcHmiRecipeEditComponents={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiRecipeEditComponents){class ObjectEditorPrompt extends Controls.Helpers.OkCancelPrompt{constructor(editorInfo,parentControl){super(parentControl),this.__onEditorChanged=editor=>{this.__okButton.setIsEnabled(editor.getState().isValid)},this.__elementHeader.textContent=editorInfo.name,this.__editorPane=new TcHmiRecipeEditComponents.ObjectEditorPane(this.__elementContent,editorInfo,parentControl),this.__editorPane.onChange.add(this.__onEditorChanged)}destroy(force=!1){super.destroy(force),this.__editorPane.destroy()}setEditorInfo(editorInfo){this.__editorPane.setEditorInfo(editorInfo)}setValue(value){this.__editorPane.setValue(value)}__ok(){var _a,_b;const state=this.__editorPane.getState();state.isValid?null===(_b=this.__prompt)||void 0===_b||_b.answer({isOk:!0,value:state.value}):null===(_a=this.__prompt)||void 0===_a||_a.error(new Error("Object editor pane contained invalid values."))}setLocalizations(texts){super.setLocalizations(texts),texts.editorLocalizations&&this.__editorPane.setLocalizations(texts.editorLocalizations)}}TcHmiRecipeEditComponents.ObjectEditorPrompt=ObjectEditorPrompt}(Beckhoff.TcHmiRecipeEditComponents||(Beckhoff.TcHmiRecipeEditComponents={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiRecipeEditComponents){class ArrayEditorPrompt extends Controls.Helpers.OkCancelPrompt{constructor(editorInfo,parentControl){super(parentControl),this.__onEditorChanged=editor=>{this.__okButton.setIsEnabled(editor.getState().isValid)},this.__elementHeader.textContent=editorInfo.name,this.__editorPane=new TcHmiRecipeEditComponents.ArrayEditorPane(this.__elementContent,editorInfo,parentControl),this.__editorPane.onChange.add(this.__onEditorChanged)}destroy(force=!1){super.destroy(force),this.__editorPane.destroy()}setEditorInfo(editorInfo){this.__editorPane.setEditorInfo(editorInfo)}setValue(value){this.__editorPane.setValue(value)}__ok(){var _a,_b;const state=this.__editorPane.getState();state.isValid?null===(_b=this.__prompt)||void 0===_b||_b.answer({isOk:!0,value:state.value}):null===(_a=this.__prompt)||void 0===_a||_a.error(new Error("Array editor pane contained invalid values."))}setLocalizations(texts){super.setLocalizations(texts),texts.editorLocalizations&&this.__editorPane.setLocalizations(texts.editorLocalizations)}}TcHmiRecipeEditComponents.ArrayEditorPrompt=ArrayEditorPrompt}(Beckhoff.TcHmiRecipeEditComponents||(Beckhoff.TcHmiRecipeEditComponents={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiRecipeEditComponents){class TupleEditorPrompt extends Controls.Helpers.OkCancelPrompt{constructor(editorInfo,parentControl){super(parentControl),this.__onEditorChanged=editor=>{this.__okButton.setIsEnabled(editor.getState().isValid)},this.__elementHeader.textContent=editorInfo.name,this.__editorPane=new TcHmiRecipeEditComponents.TupleEditorPane(this.__elementContent,editorInfo,parentControl),this.__editorPane.onChange.add(this.__onEditorChanged)}destroy(force=!1){super.destroy(force),this.__editorPane.destroy()}setEditorInfo(editorInfo){this.__editorPane.setEditorInfo(editorInfo)}setValue(value){this.__editorPane.setValue(value)}__ok(){var _a,_b;const state=this.__editorPane.getState();state.isValid?null===(_b=this.__prompt)||void 0===_b||_b.answer({isOk:!0,value:state.value}):null===(_a=this.__prompt)||void 0===_a||_a.error(new Error("Tuple editor pane contained invalid values."))}setLocalizations(texts){super.setLocalizations(texts),texts.editorLocalizations&&this.__editorPane.setLocalizations(texts.editorLocalizations)}}TcHmiRecipeEditComponents.TupleEditorPrompt=TupleEditorPrompt}(Beckhoff.TcHmiRecipeEditComponents||(Beckhoff.TcHmiRecipeEditComponents={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiRecipeEditComponents){var _a,_Editor_tchmiFQN;class Editor{constructor(__element,__editorInfo,__parentControl){this.__element=__element,this.__editorInfo=__editorInfo,this.__parentControl=__parentControl,this.__childControls=new Set,this.__eventDestroyers=new Set,this.__isEnabled=!0,this.__localizations=void 0,this.__localizationSymbols=new Map,this.__onChangeManager=new Controls.Helpers.CallbackManager,this.onChange=this.__onChangeManager.getManipulators(),this.__name=`${this.__parentControl.getId()}.${this.constructor.name}-${tchmi_create_guid()}`;const controlClass=this.__parentControl.getType().replace(/\./g,"_");__element.classList.add(controlClass+"-editor")}static create(element,editorInfo,parentControl,localizations){let editor;switch(editorInfo.type){case"boolean":editor=new TcHmiRecipeEditComponents.BooleanEditor(element,editorInfo,parentControl);break;case"number":editor=new TcHmiRecipeEditComponents.NumberEditor(element,editorInfo,parentControl);break;case"string":editor=new TcHmiRecipeEditComponents.StringEditor(element,editorInfo,parentControl);break;case"time":editor=new TcHmiRecipeEditComponents.TimeEditor(element,editorInfo,parentControl);break;case"enum":editor=new TcHmiRecipeEditComponents.EnumEditor(element,editorInfo,parentControl);break;case"object":editor=new TcHmiRecipeEditComponents.ObjectEditor(element,editorInfo,parentControl);break;case"array":editor=new TcHmiRecipeEditComponents.ArrayEditor(element,editorInfo,parentControl);break;case"tuple":editor=new TcHmiRecipeEditComponents.TupleEditor(element,editorInfo,parentControl);break;case"optional":editor=new TcHmiRecipeEditComponents.OptionalEditor(element,editorInfo,parentControl);break;case"choice":editor=new TcHmiRecipeEditComponents.ChoiceEditor(element,editorInfo,parentControl);break;case"null":editor=new TcHmiRecipeEditComponents.NullEditor(element,editorInfo,parentControl);break;case"invalid":editor=new TcHmiRecipeEditComponents.InvalidEditor(element,editorInfo,parentControl)}return localizations&&editor.setLocalizations(localizations),editor}destroy(){for(const destroy of this.__eventDestroyers)destroy();this.__eventDestroyers.clear();for(const control of this.__childControls)this.__parentControl.__removeChild(control),control.destroy();this.__childControls.clear();for(const entry of this.__localizationSymbols.values())entry.destroyWatch(),entry.symbol.destroy();this.__localizationSymbols.clear()}setEditorInfo(editorInfo){const oldState=this.getState();let changeHandlersTriggered=!1;const detectChangeHandlersTriggered=()=>{changeHandlersTriggered=!0};this.onChange.add(detectChangeHandlersTriggered),this.__editorInfo=editorInfo,this.__processEditorInfo(),this.onChange.remove(detectChangeHandlersTriggered),changeHandlersTriggered||tchmi_equal(oldState,this.getState())||this.__onChangeManager.trigger(this)}getEditorInfo(){return this.__editorInfo}getState(){const value=this.getRawValue();return Editor.validate(this.__editorInfo,value)?{isValid:!0,value:value}:{isValid:!1}}static validate(editorInfo,value){switch(editorInfo.type){case"boolean":return TcHmiRecipeEditComponents.BooleanEditor.validate(editorInfo,value);case"number":return TcHmiRecipeEditComponents.NumberEditor.validate(editorInfo,value);case"string":return TcHmiRecipeEditComponents.StringEditor.validate(editorInfo,value);case"time":return TcHmiRecipeEditComponents.TimeEditor.validate(editorInfo,value);case"enum":return TcHmiRecipeEditComponents.EnumEditor.validate(editorInfo,value);case"object":return TcHmiRecipeEditComponents.ObjectEditor.validate(editorInfo,value);case"array":return TcHmiRecipeEditComponents.ArrayEditor.validate(editorInfo,value);case"tuple":return TcHmiRecipeEditComponents.TupleEditor.validate(editorInfo,value);case"optional":return TcHmiRecipeEditComponents.OptionalEditor.validate(editorInfo,value);case"choice":return TcHmiRecipeEditComponents.ChoiceEditor.validate(editorInfo,value);case"null":return TcHmiRecipeEditComponents.NullEditor.validate(editorInfo,value);case"invalid":return TcHmiRecipeEditComponents.InvalidEditor.validate(editorInfo,value)}}setIsEnabled(isEnabled){this.__isEnabled=isEnabled,this.__element.classList.toggle("disabled",!isEnabled);for(const control of this.__childControls)control.setIsEnabled(isEnabled)}getIsEnabled(){return this.__isEnabled}setLocalizations(texts){if(this.__localizations)for(const[name,subEditorLocalizations]of Object.entries(texts))if(this.__localizations[name])for(const[textName,text]of Object.entries(subEditorLocalizations))this.__localizations[name][textName]=text;else this.__localizations[name]=subEditorLocalizations;else this.__localizations=texts}__watchLocalization(name,localization,onChange){const existing=this.__localizationSymbols.get(name);null==existing||existing.destroyWatch(),null==existing||existing.symbol.destroy();const symbol=new TcHmi.Symbol(localization.symbol),destroyWatch=symbol.watch(data=>{var _b;if(data.error!==TcHmi.Errors.NONE)return void(TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.errorEx(`[Source=Control, Module=${this.__parentControl.getType()}, Origin=${__classPrivateFieldGet(Editor,_a,"f",_Editor_tchmiFQN)}, Id=${this.__parentControl.getId()}, Symbol=${localization.symbol}] `+TcHmi.Log.buildMessage(data.details)));let text=null!==(_b=data.value)&&void 0!==_b?_b:"";localization.formatValues.length>0&&(text=tchmi_format_string(text,...localization.formatValues)),onChange(text)});this.__localizationSymbols.set(name,{symbol:symbol,destroyWatch:destroyWatch})}__unwatchLocalization(name){const existing=this.__localizationSymbols.get(name);existing&&(existing.destroyWatch(),existing.symbol.destroy(),this.__localizationSymbols.delete(name))}}_Editor_tchmiFQN={value:"TcHmi.Controls.Beckhoff.TcHmiRecipeEditComponents."+(_a=Editor).name},TcHmiRecipeEditComponents.Editor=Editor}(Beckhoff.TcHmiRecipeEditComponents||(Beckhoff.TcHmiRecipeEditComponents={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiRecipeEditComponents){class TextboxBasedEditor extends TcHmiRecipeEditComponents.Editor{constructor(element,editorInfo,parentControl){super(element,editorInfo,parentControl),this.__onTextChanged=()=>{this.__parentControl.getIsEnabled()&&TcHmi.Access.checkAccess(this.__parentControl,"operate")&&(this.__textbox.getElement()[0].classList.toggle("invalid",!this.getState().isValid),this.__onChangeManager.trigger(this))};const textbox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiTextbox",this.__name+".textbox",{"data-tchmi-content-padding":{top:3,right:3,bottom:3,left:3}},this.__parentControl);if(!textbox)throw new Error("Could not create controls for textbox based editor.");this.__textbox=textbox,this.__childControls.add(textbox);const textboxElement=textbox.getElement()[0];textboxElement.classList.add("with-validation","invalid"),this.__element.appendChild(textboxElement),this.__eventDestroyers.add(TcHmi.EventProvider.register(textbox.getId()+".onTextChanged",this.__onTextChanged))}}TcHmiRecipeEditComponents.TextboxBasedEditor=TextboxBasedEditor}(Beckhoff.TcHmiRecipeEditComponents||(Beckhoff.TcHmiRecipeEditComponents={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiRecipeEditComponents){class NumberEditor extends TcHmiRecipeEditComponents.TextboxBasedEditor{constructor(element,editorInfo,parentControl){super(element,editorInfo,parentControl),this.__textbox.setTextHorizontalAlignment("Right")}static validate(editorInfo,value){if("string"==typeof value)return!!value&&!(!editorInfo.specialValues.has(value)||!editorInfo.restrictions.some(restriction=>!restriction.isInteger));if("number"!=typeof value)return!1;if(!Number.isFinite(value)){const text=value.toString();return!(!editorInfo.specialValues.has(text)||!editorInfo.restrictions.some(restriction=>!restriction.isInteger))}if(0===editorInfo.restrictions.length)return!0;for(const restriction of editorInfo.restrictions)if((!restriction.isInteger||Number.isInteger(value))&&(!restriction.minimum||this.__testMinimum(value,restriction.minimum))&&(!restriction.maximum||this.__testMaximum(value,restriction.maximum))&&(void 0===restriction.multipleOf||value%restriction.multipleOf==0))return!0;return!1}__processEditorInfo(){this.__textbox.getElement()[0].classList.toggle("invalid",!this.getState().isValid)}static __testMinimum(value,minimum){return minimum.exclusive?value>minimum.value:value>=minimum.value}static __testMaximum(value,maximum){return maximum.exclusive?value<maximum.value:value<=maximum.value}setValue(value){"number"==typeof value?this.__textbox.setText(value.toString(10)):this.__textbox.setText(value)}getRawValue(){var _a;const text=null!==(_a=this.__textbox.getText())&&void 0!==_a?_a:"";return/^[+-]?\d*\.?\d+(?:[eE][+-]?\d+)?$/.test(text)?parseFloat(text):text}}TcHmiRecipeEditComponents.NumberEditor=NumberEditor}(Beckhoff.TcHmiRecipeEditComponents||(Beckhoff.TcHmiRecipeEditComponents={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiRecipeEditComponents){class StringEditor extends TcHmiRecipeEditComponents.TextboxBasedEditor{constructor(element,editorInfo,parentControl){super(element,editorInfo,parentControl),this.__processEditorInfo()}static validate(editorInfo,value){if("string"!=typeof value)return!1;if(0===editorInfo.restrictions.length)return!0;for(const restriction of editorInfo.restrictions)if(!(void 0!==restriction.minLength&&value.length<restriction.minLength)&&!(void 0!==restriction.maxLength&&value.length>restriction.maxLength)&&(!restriction.patterns||restriction.patterns.every(pattern=>pattern.test(value)))){if(restriction.format){let regex;switch(restriction.format){case"date-time":regex=/^\d{4}-(?:0\d|1[0-2])-(?:[0-2]\d|3[01])[Tt\s](?:[01]\d|2[0-3]):[0-5]\d:(?:[0-5]\d|60)(?:.\d+)?(?:[Zz]|[+-](?:[01]\d|2[0-3]):[0-5]\d)$/;break;case"timespan":regex=/^P(?=.{2,})(?:\d+Y|\d+[.,]\d+Y$)?(?:\d+M|\d+[.,]\d+M$)?(?:\d+W|\d+[.,]\d+W$)?(?:\d+D|\d+[.,]\d+D$)?(?:T(?:\d+H|\d+[.,]\d+H$)?(?:\d+M|\d+[.,]\d+M$)?(?:\d+S|\d+[.,]\d+S$)?)?$/;break;case"email":regex=/^(?:[^@\s"]+|".+")@(?:[^@.\s]+\.)+[^@.\s]+$/;break;case"hostname":regex=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i;break;case"ipv4":regex=/^(?:(?:25[0-5]|2[0-4]\d|[0-1]?\d?\d)\.){3}(?:25[0-5]|2[0-4]\d|[0-1]?\d?\d)$/;break;case"ipv6":regex=/^(?:[0-9A-F]{1,4}:){7}[0-9A-F]{1,4}$|^(?:[0-9A-F]{1,4}:){6}(?:(?:25[0-5]|2[0-4]\d|[0-1]?\d?\d)\.){3}(?:25[0-5]|2[0-4]\d|[0-1]?\d?\d)$|^(?=.*::)(?!.*(::).*\1.*)(?!.*:::.*)(?:(?:::)?(?:[0-9A-F]{1,4}::?){0,6}(?:[0-9A-F]{1,4}|::?)|(?:::)?(?:[0-9A-F]{1,4}::?){0,5}(?:(?:25[0-5]|2[0-4]\d|[0-1]?\d?\d)\.){3}(?:25[0-5]|2[0-4]\d|[0-1]?\d?\d))$/i;break;case"uri":regex=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;break;default:regex=/[\s\S]*/}if(!regex.test(value))continue}return!0}return!1}__processEditorInfo(){this.__textbox.getElement()[0].classList.toggle("invalid",!this.getState().isValid)}setValue(value){this.__textbox.setText(value)}getRawValue(){var _a;return null!==(_a=this.__textbox.getText())&&void 0!==_a?_a:""}}TcHmiRecipeEditComponents.StringEditor=StringEditor}(Beckhoff.TcHmiRecipeEditComponents||(Beckhoff.TcHmiRecipeEditComponents={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiRecipeEditComponents){class TimeEditor extends TcHmiRecipeEditComponents.TextboxBasedEditor{constructor(element,editorInfo,parentControl){super(element,editorInfo,parentControl),this.__onDateTimeChanged=()=>{var _a;const value=null===(_a=this.__dateTimePicker)||void 0===_a?void 0:_a.getValue();value&&this.__textbox.setText(value)},this.__onDateTimeButtonPressed=()=>{var _a;this.__dateTimePicker&&(this.__dateTimePicker.setValue(null!==(_a=this.__textbox.getText())&&void 0!==_a?_a:null),this.__dateTimePicker.openDateTimePicker())},this.__onTimespanChanged=()=>{var _a;const value=null===(_a=this.__timespanPicker)||void 0===_a?void 0:_a.getValue();value&&this.__textbox.setText(value)},this.__onTimespanButtonPressed=()=>{var _a;this.__timespanPicker&&(this.__timespanPicker.setValue(null!==(_a=this.__textbox.getText())&&void 0!==_a?_a:null),this.__timespanPicker.openTimespanPicker())},this.__container=document.createElement("div"),this.__container.classList.add("compound-control-container");for(const child of this.__element.children)this.__container.appendChild(child);if(this.__processEditorInfo(),!(this.__dateTimeButton||this.__dateTimePicker||this.__timespanButton||this.__timespanPicker))throw new Error("Could not create controls for time editor.");element.appendChild(this.__container),this.__textbox.getElement()[0].classList.toggle("invalid",!this.getState().isValid)}destroy(force=!1){this.__dateTimeButton&&TcHmi.Binding.removeEx2(null,"Tooltip",this.__dateTimeButton),this.__timespanButton&&TcHmi.Binding.removeEx2(null,"Tooltip",this.__timespanButton),super.destroy()}static validate(editorInfo,value){return TcHmiRecipeEditComponents.StringEditor.validate({type:"string",schema:editorInfo.schema,name:"String",restrictions:Array.from(editorInfo.formats).map(format=>({format:format}))},value)}__processEditorInfo(){var _a,_b,_c,_d;this.__editorInfo.formats.has("date-time")?(this.__dateTimeButton&&this.__dateTimePicker||this.__createDateTimeControls(),null===(_a=this.__dateTimeButton)||void 0===_a||_a.setVisibility("Visible")):null===(_b=this.__dateTimeButton)||void 0===_b||_b.setVisibility("Collapsed"),this.__editorInfo.formats.has("timespan")?(this.__timespanButton&&this.__timespanPicker||this.__createTimespanControls(),null===(_c=this.__timespanButton)||void 0===_c||_c.setVisibility("Visible")):null===(_d=this.__timespanButton)||void 0===_d||_d.setVisibility("Collapsed")}setValue(value){this.__textbox.setText(value)}getRawValue(){var _a;return null!==(_a=this.__textbox.getText())&&void 0!==_a?_a:""}__createDateTimeControls(){const dateTimePicker=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiDateTimePicker",this.__name+".dateTimePicker",{"data-tchmi-visibility":"Collapsed","data-tchmi-is-enabled":this.__isEnabled},this.__parentControl),dateTimeButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__name+".dateTimeButton",{"data-tchmi-width":30,"data-tchmi-height":100,"data-tchmi-height-unit":"%","data-tchmi-is-enabled":this.__isEnabled},this.__parentControl);if(!dateTimePicker||!dateTimeButton)return;this.__dateTimePicker=dateTimePicker,this.__dateTimeButton=dateTimeButton,this.__childControls.add(dateTimePicker),this.__childControls.add(dateTimeButton),this.__localizeDateTimeButton(),this.__eventDestroyers.add(TcHmi.EventProvider.register(dateTimePicker.getId()+".onValueChanged",this.__onDateTimeChanged)),this.__eventDestroyers.add(TcHmi.EventProvider.register(dateTimeButton.getId()+".onPressed",this.__onDateTimeButtonPressed));const dateTimeButtonElement=dateTimeButton.getElement()[0];dateTimeButtonElement.classList.add("datetimepicker-button"),this.__container.appendChild(dateTimePicker.getElement()[0]),this.__container.appendChild(dateTimeButtonElement)}__createTimespanControls(){const timespanPicker=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiTimespanPicker",this.__name+".timespanPicker",{"data-tchmi-visibility":"Collapsed","data-tchmi-is-enabled":this.__isEnabled},this.__parentControl),timespanButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__name+".timespanButton",{"data-tchmi-width":30,"data-tchmi-height":100,"data-tchmi-height-unit":"%","data-tchmi-is-enabled":this.__isEnabled},this.__parentControl);if(!timespanPicker||!timespanButton)throw new Error("Could not create controls for time editor.");this.__timespanPicker=timespanPicker,this.__timespanButton=timespanButton,this.__childControls.add(timespanPicker),this.__childControls.add(timespanButton),this.__localizeTimespanButton(),this.__eventDestroyers.add(TcHmi.EventProvider.register(timespanPicker.getId()+".onValueChanged",this.__onTimespanChanged)),this.__eventDestroyers.add(TcHmi.EventProvider.register(timespanButton.getId()+".onPressed",this.__onTimespanButtonPressed));const timespanButtonElement=timespanButton.getElement()[0];timespanButtonElement.classList.add("timespanpicker-button"),this.__container.appendChild(timespanPicker.getElement()[0]),this.__container.appendChild(timespanButtonElement)}setLocalizations(texts){super.setLocalizations(texts),this.__localizeDateTimeButton(),this.__localizeTimespanButton()}__localizeDateTimeButton(){var _a,_b;this.__dateTimeButton&&(null===(_b=null===(_a=this.__localizations)||void 0===_a?void 0:_a.timeEditor)||void 0===_b?void 0:_b.dateTimeButtonTooltip)&&("string"==typeof this.__localizations.timeEditor.dateTimeButtonTooltip?(this.__unwatchLocalization("dateTimeButtonTooltip"),TcHmi.Binding.createEx2(this.__localizations.timeEditor.dateTimeButtonTooltip,"Tooltip",this.__dateTimeButton)):(TcHmi.Binding.removeEx2(null,"Tooltip",this.__dateTimeButton),this.__watchLocalization("dateTimeButtonTooltip",this.__localizations.timeEditor.dateTimeButtonTooltip,text=>{var _a;return null===(_a=this.__dateTimeButton)||void 0===_a?void 0:_a.setTooltip(text)})))}__localizeTimespanButton(){var _a,_b;this.__timespanButton&&(null===(_b=null===(_a=this.__localizations)||void 0===_a?void 0:_a.timeEditor)||void 0===_b?void 0:_b.timespanButtonTooltip)&&("string"==typeof this.__localizations.timeEditor.timespanButtonTooltip?(this.__unwatchLocalization("timespanButtonTooltip"),TcHmi.Binding.createEx2(this.__localizations.timeEditor.timespanButtonTooltip,"Tooltip",this.__timespanButton)):(TcHmi.Binding.removeEx2(null,"Tooltip",this.__timespanButton),this.__watchLocalization("timespanButtonTooltip",this.__localizations.timeEditor.timespanButtonTooltip,text=>{var _a;return null===(_a=this.__timespanButton)||void 0===_a?void 0:_a.setTooltip(text)})))}}TcHmiRecipeEditComponents.TimeEditor=TimeEditor}(Beckhoff.TcHmiRecipeEditComponents||(Beckhoff.TcHmiRecipeEditComponents={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiRecipeEditComponents){class ComboboxBasedEditor extends TcHmiRecipeEditComponents.Editor{constructor(element,editorInfo,parentControl){super(element,editorInfo,parentControl),this.__onSelectionChanged=()=>{this.__parentControl.getIsEnabled()&&TcHmi.Access.checkAccess(this.__parentControl,"operate")&&(this.__combobox.getElement()[0].classList.toggle("invalid",!this.getState().isValid),this.__onChangeManager.trigger(this))};const combobox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCombobox",this.__name+".combobox",{"data-tchmi-content-padding":{top:3,right:3,bottom:3,left:3}},this.__parentControl);if(!combobox)throw new Error("Could not create controls for combobox based editor.");this.__combobox=combobox,this.__childControls.add(combobox);const comboboxElement=combobox.getElement()[0];comboboxElement.classList.add("with-validation","invalid"),this.__element.appendChild(comboboxElement),this.__eventDestroyers.add(TcHmi.EventProvider.register(combobox.getId()+".onSelectionChanged",this.__onSelectionChanged))}}TcHmiRecipeEditComponents.ComboboxBasedEditor=ComboboxBasedEditor}(Beckhoff.TcHmiRecipeEditComponents||(Beckhoff.TcHmiRecipeEditComponents={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiRecipeEditComponents){class EnumEditor extends TcHmiRecipeEditComponents.ComboboxBasedEditor{constructor(element,editorInfo,parentControl){super(element,editorInfo,parentControl),this.__processEditorInfo()}static validate(editorInfo,value){return editorInfo.members.has(value)}__processEditorInfo(){function stringify(value){return"string"==typeof value?value:JSON.stringify(value)}this.__combobox.setSrcData(Array.from(this.__editorInfo.members.entries()).map(([value,label])=>({value:value,text:null!=label?label:stringify(value)})))}setValue(value){if(null===value)this.__combobox.setSelectedIndex(null);else{const index=Array.from(this.__editorInfo.members.keys()).indexOf(value);this.__combobox.setSelectedIndex(-1!==index?index:null)}}getRawValue(){return this.__combobox.getSelectedValue()}}TcHmiRecipeEditComponents.EnumEditor=EnumEditor}(Beckhoff.TcHmiRecipeEditComponents||(Beckhoff.TcHmiRecipeEditComponents={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiRecipeEditComponents){class BooleanEditor extends TcHmiRecipeEditComponents.ComboboxBasedEditor{constructor(element,editorInfo,parentControl){super(element,editorInfo,parentControl),this.__comboboxTexts={false:"",true:""},this.__updateSrcData()}static validate(editorInfo,value){return"boolean"==typeof value}__processEditorInfo(){}setValue(value){switch(value){case!1:this.__combobox.setSelectedIndex(0);break;case!0:this.__combobox.setSelectedIndex(1);break;case null:default:this.__combobox.setSelectedIndex(null)}}getRawValue(){return this.__combobox.getSelectedValue()}__updateSrcData(){this.__combobox.setSrcData([{value:!1,text:this.__comboboxTexts.false},{value:!0,text:this.__comboboxTexts.true}])}setLocalizations(texts){var _a,_b;super.setLocalizations(texts);let update=!1;(null===(_a=texts.booleanEditor)||void 0===_a?void 0:_a.falseText)&&("string"==typeof texts.booleanEditor.falseText?(this.__comboboxTexts.false=texts.booleanEditor.falseText,update=!0):this.__watchLocalization("falseText",texts.booleanEditor.falseText,text=>{this.__comboboxTexts.false=text,this.__updateSrcData()})),(null===(_b=texts.booleanEditor)||void 0===_b?void 0:_b.trueText)&&("string"==typeof texts.booleanEditor.trueText?(this.__comboboxTexts.true=texts.booleanEditor.trueText,update=!0):this.__watchLocalization("trueText",texts.booleanEditor.trueText,text=>{this.__comboboxTexts.true=text,this.__updateSrcData()})),update&&this.__updateSrcData()}}TcHmiRecipeEditComponents.BooleanEditor=BooleanEditor}(Beckhoff.TcHmiRecipeEditComponents||(Beckhoff.TcHmiRecipeEditComponents={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiRecipeEditComponents){class ButtonBasedEditor extends TcHmiRecipeEditComponents.Editor{constructor(element,editorInfo,parentControl){super(element,editorInfo,parentControl),this.__onPressed=()=>{this.__parentControl.getIsEnabled()&&TcHmi.Access.checkAccess(this.__parentControl,"operate")&&this.openPopup()},this.__container=document.createElement("div"),this.__container.classList.add("compound-control-container","with-validation","invalid"),this.__textSpan=document.createElement("span"),this.__textSpan.classList.add("value-description"),this.__container.appendChild(this.__textSpan);const button=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__name+".button",{"data-tchmi-width":30,"data-tchmi-height":100,"data-tchmi-height-unit":"%","data-tchmi-text":"..."},this.__parentControl);if(!button)throw new Error("Could not create controls for button based editor.");this.__button=button,this.__childControls.add(button),this.__container.appendChild(button.getElement()[0]),this.__element.appendChild(this.__container),this.__eventDestroyers.add(TcHmi.EventProvider.register(button.getId()+".onPressed",this.__onPressed))}destroy(force=!1){TcHmi.Binding.removeEx2(null,"Tooltip",this.__button),super.destroy()}setLocalizations(texts){var _a;super.setLocalizations(texts),(null===(_a=texts.buttonBasedEditor)||void 0===_a?void 0:_a.buttonTooltip)&&("string"==typeof texts.buttonBasedEditor.buttonTooltip?(this.__unwatchLocalization("buttonTooltip"),TcHmi.Binding.createEx2(texts.buttonBasedEditor.buttonTooltip,"Tooltip",this.__button)):(TcHmi.Binding.removeEx2(null,"Tooltip",this.__button),this.__watchLocalization("buttonTooltip",texts.buttonBasedEditor.buttonTooltip,text=>this.__button.setTooltip(text))))}}TcHmiRecipeEditComponents.ButtonBasedEditor=ButtonBasedEditor}(Beckhoff.TcHmiRecipeEditComponents||(Beckhoff.TcHmiRecipeEditComponents={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiRecipeEditComponents){class ObjectEditor extends TcHmiRecipeEditComponents.ButtonBasedEditor{constructor(element,editorInfo,parentControl){super(element,editorInfo,parentControl),this.__value={},this.__processEditorInfo()}destroy(){var _a;super.destroy(),null===(_a=this.__popup)||void 0===_a||_a.destroy(!0)}static validate(editorInfo,value){if("object"!=typeof value)return!1;if(null===value)return!1;if(Array.isArray(value))return!1;if(null!==Object.getPrototypeOf(value)&&Object.getPrototypeOf(value)!==Object.getPrototypeOf({}))return!1;const resolvedInfo=ObjectEditor.resolveDependencies(editorInfo,new Set(Object.keys(value)));if("invalid"===resolvedInfo.type)return!1;editorInfo=resolvedInfo;for(const[name,info]of editorInfo.properties)if(("optional"!==info.type||info.temporarilyRequired)&&void 0===value[name])return!1;const isValidName=name=>!!editorInfo.additionalProperties.allowed||(!!editorInfo.properties.has(name)||!(!editorInfo.patternProperties||!Array.from(editorInfo.patternProperties.keys()).some(regex=>regex.test(name))));let propertiesCount=0;for(const propertyName in value){if(!isValidName(propertyName))return!1;const propertyEditorInfo=ObjectEditor.getEditorInfoForProperty(editorInfo,propertyName);if(!TcHmiRecipeEditComponents.Editor.validate(propertyEditorInfo,value[propertyName]))return!1;void 0!==value[propertyName]&&propertiesCount++}return!(void 0!==editorInfo.maxProperties&&propertiesCount>editorInfo.maxProperties)&&!(void 0!==editorInfo.minProperties&&propertiesCount<editorInfo.minProperties)}__processEditorInfo(){var _a;null===(_a=this.__popup)||void 0===_a||_a.setEditorInfo(this.__editorInfo),this.__textSpan.textContent=this.__editorInfo.name}static resolveDependencies(editorInfo,knownProperties){if(!editorInfo.dependencies)return editorInfo;const matchingDependencies=[];for(const[name,dependency]of editorInfo.dependencies)knownProperties.has(name)&&matchingDependencies.push(dependency);if(0===matchingDependencies.length)return editorInfo;const result=TcHmiRecipeEditComponents.SchemaParser.mergeEditorInfos(editorInfo,...matchingDependencies.map(dependency=>this.resolveDependencies(dependency,knownProperties)));return"object"!==result.type?{type:"invalid",schema:result.schema,name:"Invalid"}:result}static getEditorInfoForProperty(editorInfo,property){var _a;let info=editorInfo.properties.get(property);if(!info&&editorInfo.patternProperties){const matchingInfos=[];for(const[pattern,info]of editorInfo.patternProperties)pattern.test(property)&&matchingInfos.push(info);matchingInfos.length>0&&(info=TcHmiRecipeEditComponents.SchemaParser.mergeEditorInfos(...matchingInfos))}return!info&&editorInfo.additionalProperties.allowed&&(info=null!==(_a=editorInfo.additionalProperties.editorInfo)&&void 0!==_a?_a:TcHmiRecipeEditComponents.ChoiceEditor.createAnyEditorInfo()),info||(info={type:"invalid",schema:{},name:"Invalid"}),info}setValue(value){var _a;this.__value=null!=value?value:{},null===(_a=this.__popup)||void 0===_a||_a.setValue(value),this.__container.classList.toggle("invalid",!this.getState().isValid),this.__onChangeManager.trigger(this)}getRawValue(){return this.__value}async openPopup(){var _a,_b,_c,_d,_e,_f,_g,_h;this.__popup||(this.__popup=new TcHmiRecipeEditComponents.ObjectEditorPrompt(this.__editorInfo,this.__parentControl),this.__popup.setBackgroundAction({close:!0,action:"cancel"}),this.__popup.setLocalizations({buttonTextOk:null===(_b=null===(_a=this.__localizations)||void 0===_a?void 0:_a.objectEditorPrompt)||void 0===_b?void 0:_b.buttonTextOk,buttonTooltipOk:null===(_d=null===(_c=this.__localizations)||void 0===_c?void 0:_c.objectEditorPrompt)||void 0===_d?void 0:_d.buttonTooltipOk,buttonTextCancel:null===(_f=null===(_e=this.__localizations)||void 0===_e?void 0:_e.objectEditorPrompt)||void 0===_f?void 0:_f.buttonTextCancel,buttonTooltipCancel:null===(_h=null===(_g=this.__localizations)||void 0===_g?void 0:_g.objectEditorPrompt)||void 0===_h?void 0:_h.buttonTooltipCancel,editorLocalizations:this.__localizations}));try{this.__popup.setValue(this.__value);const result=await this.__popup.prompt();result.isOk&&(this.__value=result.value,this.__container.classList.toggle("invalid",!this.getState().isValid),this.__onChangeManager.trigger(this))}catch(ex){}}setLocalizations(texts){var _a,_b,_c,_d,_e,_f,_g,_h,_j;super.setLocalizations(texts),null===(_a=this.__popup)||void 0===_a||_a.setLocalizations({buttonTextOk:null===(_c=null===(_b=this.__localizations)||void 0===_b?void 0:_b.objectEditorPrompt)||void 0===_c?void 0:_c.buttonTextOk,buttonTooltipOk:null===(_e=null===(_d=this.__localizations)||void 0===_d?void 0:_d.objectEditorPrompt)||void 0===_e?void 0:_e.buttonTooltipOk,buttonTextCancel:null===(_g=null===(_f=this.__localizations)||void 0===_f?void 0:_f.objectEditorPrompt)||void 0===_g?void 0:_g.buttonTextCancel,buttonTooltipCancel:null===(_j=null===(_h=this.__localizations)||void 0===_h?void 0:_h.objectEditorPrompt)||void 0===_j?void 0:_j.buttonTooltipCancel,editorLocalizations:this.__localizations})}}TcHmiRecipeEditComponents.ObjectEditor=ObjectEditor}(Beckhoff.TcHmiRecipeEditComponents||(Beckhoff.TcHmiRecipeEditComponents={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiRecipeEditComponents){class ObjectEditorPane extends TcHmiRecipeEditComponents.Editor{constructor(element,editorInfo,parentControl){super(element,editorInfo,parentControl),this.__removeButtonTooltip="",this.__editors=new Map,this.__pauseChangeHandlers=!1,this.__onEditorChanged=editor=>{this.__pauseChangeHandlers||(this.__onChangeManager.trigger(this),editor instanceof TcHmiRecipeEditComponents.OptionalEditor&&this.__applyDependencies())},this.__onAddPropertyPressed=()=>{var _a;this.__parentControl.getIsEnabled()&&TcHmi.Access.checkAccess(this.__parentControl,"operate")&&(this.__newPropertyContainer.classList.add("show"),this.__addPropertyButton.setVisibility("Collapsed"),null===(_a=this.__newPropertyTextbox.getElement()[0].querySelector("input"))||void 0===_a||_a.focus())},this.__onNewPropertyTextChanged=()=>{if(!this.__parentControl.getIsEnabled())return;if(!TcHmi.Access.checkAccess(this.__parentControl,"operate"))return;const name=this.__newPropertyTextbox.getText();if(!name)return this.__newPropertyTextbox.getElement()[0].classList.remove("invalid"),void this.__acceptNewPropertyButton.setIsEnabled(!1);!this.__editors.has(name)&&(this.__dependencyOverride.additionalProperties.allowed||this.__dependencyOverride.patternProperties&&Array.from(this.__dependencyOverride.patternProperties.keys()).some(pattern=>pattern.test(name)))?(this.__newPropertyTextbox.getElement()[0].classList.remove("invalid"),this.__acceptNewPropertyButton.setIsEnabled(!0)):(this.__newPropertyTextbox.getElement()[0].classList.add("invalid"),this.__acceptNewPropertyButton.setIsEnabled(!1))},this.__onAcceptNewPropertyPressed=()=>{if(!this.__parentControl.getIsEnabled())return;if(!TcHmi.Access.checkAccess(this.__parentControl,"operate"))return;const name=this.__newPropertyTextbox.getText();if(!name)return;let possibleEditors=[];if(this.__dependencyOverride.patternProperties&&(possibleEditors=Array.from(this.__dependencyOverride.patternProperties).filter(([pattern,info])=>pattern.test(name)).map(([pattern,info])=>info)),0===possibleEditors.length&&this.__dependencyOverride.additionalProperties.editorInfo&&(possibleEditors=[this.__dependencyOverride.additionalProperties.editorInfo]),0===possibleEditors.length)return;const editorEntry=this.__createEditorRow(name,TcHmiRecipeEditComponents.SchemaParser.mergeEditorInfos(...possibleEditors),!0);this.__editorTable.appendChild(editorEntry.row),this.__editors.set(name,editorEntry),this.__newPropertyTextbox.setText(null),this.__newPropertyContainer.classList.remove("show"),this.__addPropertyButton.setVisibility("Visible"),this.__pauseChangeHandlers||(this.__onChangeManager.trigger(this),this.__applyDependencies())},this.__onCancelNewPropertyPressed=()=>{this.__parentControl.getIsEnabled()&&TcHmi.Access.checkAccess(this.__parentControl,"operate")&&this.__cancelNewProperty()},this.__dependencyOverride=editorInfo;const controlClass=this.__parentControl.getType().replace(/\./g,"_");this.__editorTable=document.createElement("table"),this.__editorTable.classList.add(controlClass+"_editor-table"),this.__element.appendChild(this.__editorTable);const newPropertyTextbox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiTextbox",this.__name+".NewPropertyTextbox",{"data-tchmi-content-padding":{top:3,right:3,bottom:3,left:3}},this.__parentControl),acceptNewPropertyButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__name+".AcceptNewPropertyButton",{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-is-enabled":!1},this.__parentControl),cancelNewPropertyButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__name+".CancelNewPropertyButton",{"data-tchmi-width":30,"data-tchmi-height":30},this.__parentControl),addPropertyButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__name+".AddPropertyButton",{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-visibility":"Collapsed"},this.__parentControl);if(!(newPropertyTextbox&&acceptNewPropertyButton&&cancelNewPropertyButton&&addPropertyButton))throw new Error("Could not create controls for object editor.");this.__newPropertyTextbox=newPropertyTextbox,this.__acceptNewPropertyButton=acceptNewPropertyButton,this.__cancelNewPropertyButton=cancelNewPropertyButton,this.__addPropertyButton=addPropertyButton,this.__childControls.add(newPropertyTextbox),this.__childControls.add(acceptNewPropertyButton),this.__childControls.add(cancelNewPropertyButton),this.__childControls.add(addPropertyButton),this.__eventDestroyers.add(TcHmi.EventProvider.register(newPropertyTextbox.getId()+".onTextChanged",this.__onNewPropertyTextChanged)),this.__eventDestroyers.add(TcHmi.EventProvider.register(acceptNewPropertyButton.getId()+".onPressed",this.__onAcceptNewPropertyPressed)),this.__eventDestroyers.add(TcHmi.EventProvider.register(cancelNewPropertyButton.getId()+".onPressed",this.__onCancelNewPropertyPressed)),this.__eventDestroyers.add(TcHmi.EventProvider.register(addPropertyButton.getId()+".onPressed",this.__onAddPropertyPressed)),this.__newPropertyContainer=document.createElement("div"),this.__newPropertyContainer.classList.add("new-property-container");const newPropertyTextboxElement=newPropertyTextbox.getElement()[0];newPropertyTextboxElement.classList.add("with-validation");const cancelNewPropertyButtonElement=cancelNewPropertyButton.getElement()[0];cancelNewPropertyButtonElement.classList.add("TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-button-icon-remove"),this.__newPropertyContainer.appendChild(newPropertyTextboxElement),this.__newPropertyContainer.appendChild(acceptNewPropertyButton.getElement()[0]),this.__newPropertyContainer.appendChild(cancelNewPropertyButtonElement),this.__element.appendChild(this.__newPropertyContainer);addPropertyButton.getElement()[0].classList.add("TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-button-icon-add"),this.__element.appendChild(addPropertyButton.getElement()[0]),this.__processEditorInfo()}destroy(){TcHmi.Binding.removeEx2(null,"Tooltip",this.__addPropertyButton),TcHmi.Binding.removeEx2(null,"Text",this.__acceptNewPropertyButton),TcHmi.Binding.removeEx2(null,"Tooltip",this.__acceptNewPropertyButton),TcHmi.Binding.removeEx2(null,"Tooltip",this.__cancelNewPropertyButton);for(const editorEntry of this.__editors.values())editorEntry.editor.destroy(),editorEntry.removeButton&&TcHmi.Binding.removeEx2(null,"Tooltip",editorEntry.removeButton);this.__editors.clear(),super.destroy()}__processEditorInfo(){this.__pauseChangeHandlers=!0;const value=this.getRawValue();this.__editorTable.innerHTML="";for(const name of this.__editors.keys())this.__removeEditorRow(name);for(const[name,info]of this.__editorInfo.properties){const editorEntry=this.__createEditorRow(name,info,!1);this.__editorTable.appendChild(editorEntry.row),this.__editors.set(name,editorEntry)}this.__addPropertyButton.setVisibility(this.__editorInfo.additionalProperties.editorInfo||this.__editorInfo.patternProperties?"Visible":"Collapsed"),this.setValue(value),this.__pauseChangeHandlers=!1}setValue(value){this.__pauseChangeHandlers=!0;const missingProperties=new Set(this.__editors.keys());if(value)for(const key in value){let editorEntry=this.__editors.get(key);if(editorEntry)editorEntry.editor.setValue(value[key]),missingProperties.delete(key);else{const editorInfo=TcHmiRecipeEditComponents.ObjectEditor.getEditorInfoForProperty(this.__editorInfo,key);editorEntry=this.__createEditorRow(key,editorInfo,!0),this.__editorTable.appendChild(editorEntry.row),this.__editors.set(key,editorEntry),editorEntry.editor.setValue(value[key])}}for(const name of missingProperties){const editorEntry=this.__editors.get(name);editorEntry&&(editorEntry.additionalDestroyer?this.__removeEditorRow(name):editorEntry.editor.setValue(void 0))}this.__pauseChangeHandlers=!1,this.__onChangeManager.trigger(this),this.__applyDependencies()}getRawValue(){const value={};for(const[name,entry]of this.__editors){const rawValue=entry.editor.getRawValue();void 0!==rawValue&&(value[name]=rawValue)}return value}__applyDependencies(){this.__pauseChangeHandlers=!0;const knownProperties=new Set;for(const[name,entry]of this.__editors)void 0!==entry.editor.getRawValue()&&knownProperties.add(name);let resolvedInfo,knownPropertiesCount;do{if(resolvedInfo=TcHmiRecipeEditComponents.ObjectEditor.resolveDependencies(this.__editorInfo,knownProperties),knownPropertiesCount=knownProperties.size,"invalid"===resolvedInfo.type)break;for(const[property,info]of resolvedInfo.properties)("optional"!==info.type||info.temporarilyRequired)&&knownProperties.add(property)}while(knownProperties.size!==knownPropertiesCount);if("invalid"===resolvedInfo.type)return void(this.__pauseChangeHandlers=!1);if(TcHmiRecipeEditComponents.SchemaParser.editorInfoEquivalent(resolvedInfo,this.__dependencyOverride))return void(this.__pauseChangeHandlers=!1);this.__dependencyOverride=resolvedInfo;const updateEditor=(editorEntry,editorInfo)=>{if(!TcHmiRecipeEditComponents.SchemaParser.editorInfoEquivalent(editorEntry.editor.getEditorInfo(),editorInfo))if(editorEntry.editor.getEditorInfo().type===editorInfo.type)editorEntry.editor.setEditorInfo(editorInfo);else{const value=editorEntry.editor.getRawValue();editorEntry.cell.innerHTML="",editorEntry.editor.destroy(),editorEntry.editor=TcHmiRecipeEditComponents.Editor.create(editorEntry.cell,editorInfo,this.__parentControl,this.__localizations),editorEntry.editor.setValue(value)}},missingProperties=new Set(this.__editors.keys());for(const[name,editorInfo]of resolvedInfo.properties){missingProperties.delete(name);let entry=this.__editors.get(name);entry?updateEditor(entry,editorInfo):(entry=this.__createEditorRow(name,editorInfo,!0),this.__editorTable.appendChild(entry.row),this.__editors.set(name,entry))}for(const name of missingProperties){const entry=this.__editors.get(name);if(!entry)continue;updateEditor(entry,TcHmiRecipeEditComponents.ObjectEditor.getEditorInfoForProperty(resolvedInfo,name))}this.__addPropertyButton.setVisibility(!resolvedInfo.additionalProperties.editorInfo&&!resolvedInfo.patternProperties||this.__newPropertyContainer.classList.contains("show")?"Collapsed":"Visible"),this.__pauseChangeHandlers=!1,this.__onChangeManager.trigger(this)}__createEditorRow(name,editorInfo,isAdditional){const row=document.createElement("tr"),nameCell=document.createElement("td");nameCell.classList.add("name-cell"),nameCell.textContent=name,row.appendChild(nameCell);const editorCell=document.createElement("td");editorCell.classList.add("value-cell"),row.appendChild(editorCell);const editor=TcHmiRecipeEditComponents.Editor.create(editorCell,editorInfo,this.__parentControl,this.__localizations);editor.onChange.add(this.__onEditorChanged);const removeCell=document.createElement("td");removeCell.classList.add("remove-cell"),row.appendChild(removeCell);const ret={editor:editor,row:row,cell:editorCell};if(isAdditional){const removeButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.${name}RemoveButton`,{"data-tchmi-width":30,"data-tchmi-height":100,"data-tchmi-height-unit":"%","data-tchmi-tooltip":this.__removeButtonTooltip},this.__parentControl);if(!removeButton)throw new Error("Could not create controls for object editor.");this.__childControls.add(removeButton);const destroyEvent=TcHmi.EventProvider.register(removeButton.getId()+".onPressed",this.__getRemoveButtonPressedHandler(name));this.__eventDestroyers.add(destroyEvent),ret.removeButton=removeButton,ret.additionalDestroyer=()=>{this.__childControls.delete(removeButton),this.__eventDestroyers.delete(destroyEvent),destroyEvent(),this.__parentControl.__removeChild(removeButton),removeButton.destroy()};const removeButtonElement=removeButton.getElement()[0];removeButtonElement.classList.add("TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-button-icon-remove"),removeCell.appendChild(removeButtonElement)}return ret}__getRemoveButtonPressedHandler(name){return()=>{this.__parentControl.getIsEnabled()&&TcHmi.Access.checkAccess(this.__parentControl,"operate")&&this.__removeEditorRow(name)}}__removeEditorRow(name){var _a;const editorEntry=this.__editors.get(name);editorEntry&&(editorEntry.editor.destroy(),editorEntry.row.remove(),null===(_a=editorEntry.additionalDestroyer)||void 0===_a||_a.call(editorEntry),this.__editors.delete(name),this.__pauseChangeHandlers||(this.__onChangeManager.trigger(this),this.__applyDependencies()))}__cancelNewProperty(){this.__newPropertyTextbox.setText(null),this.__newPropertyContainer.classList.remove("show"),this.__addPropertyButton.setVisibility("Visible")}setIsEnabled(isEnabled){super.setIsEnabled(isEnabled),!isEnabled&&this.__newPropertyContainer.classList.contains("show")&&this.__cancelNewProperty(),this.__acceptNewPropertyButton.setIsEnabled(!1)}setLocalizations(texts){var _a,_b,_c,_d,_e;if(super.setLocalizations(texts),(null===(_a=texts.objectEditorPane)||void 0===_a?void 0:_a.addButtonTooltip)&&("string"==typeof texts.objectEditorPane.addButtonTooltip?(this.__unwatchLocalization("addButtonTooltip"),TcHmi.Binding.createEx2(texts.objectEditorPane.addButtonTooltip,"Tooltip",this.__addPropertyButton)):(TcHmi.Binding.removeEx2(null,"Tooltip",this.__addPropertyButton),this.__watchLocalization("addButtonTooltip",texts.objectEditorPane.addButtonTooltip,text=>this.__addPropertyButton.setTooltip(text)))),(null===(_b=texts.objectEditorPane)||void 0===_b?void 0:_b.acceptButtonText)&&("string"==typeof texts.objectEditorPane.acceptButtonText?(this.__unwatchLocalization("acceptButtonText"),TcHmi.Binding.createEx2(texts.objectEditorPane.acceptButtonText,"Text",this.__acceptNewPropertyButton)):(TcHmi.Binding.removeEx2(null,"Text",this.__acceptNewPropertyButton),this.__watchLocalization("acceptButtonText",texts.objectEditorPane.acceptButtonText,text=>this.__acceptNewPropertyButton.setText(text)))),(null===(_c=texts.objectEditorPane)||void 0===_c?void 0:_c.acceptButtonTooltip)&&("string"==typeof texts.objectEditorPane.acceptButtonTooltip?(this.__unwatchLocalization("acceptButtonTooltip"),TcHmi.Binding.createEx2(texts.objectEditorPane.acceptButtonTooltip,"Tooltip",this.__acceptNewPropertyButton)):(TcHmi.Binding.removeEx2(null,"Tooltip",this.__acceptNewPropertyButton),this.__watchLocalization("acceptButtonTooltip",texts.objectEditorPane.acceptButtonTooltip,text=>this.__acceptNewPropertyButton.setTooltip(text)))),(null===(_d=texts.objectEditorPane)||void 0===_d?void 0:_d.cancelButtonTooltip)&&("string"==typeof texts.objectEditorPane.cancelButtonTooltip?(this.__unwatchLocalization("cancelButtonTooltip"),TcHmi.Binding.createEx2(texts.objectEditorPane.cancelButtonTooltip,"Tooltip",this.__cancelNewPropertyButton)):(TcHmi.Binding.removeEx2(null,"Tooltip",this.__cancelNewPropertyButton),this.__watchLocalization("cancelButtonTooltip",texts.objectEditorPane.cancelButtonTooltip,text=>this.__cancelNewPropertyButton.setTooltip(text)))),null===(_e=texts.objectEditorPane)||void 0===_e?void 0:_e.removeButtonTooltip)if(this.__unwatchLocalization("removeButtonTooltip"),"string"==typeof texts.objectEditorPane.removeButtonTooltip){this.__removeButtonTooltip=texts.objectEditorPane.removeButtonTooltip;for(const editorEntry of this.__editors.values())editorEntry.removeButton&&TcHmi.Binding.createEx2(texts.objectEditorPane.removeButtonTooltip,"Tooltip",editorEntry.removeButton)}else{for(const editorEntry of this.__editors.values())editorEntry.removeButton&&TcHmi.Binding.removeEx2(null,"Tooltip",editorEntry.removeButton);this.__watchLocalization("removeButtonTooltip",texts.objectEditorPane.removeButtonTooltip,text=>{var _a;this.__removeButtonTooltip=text;for(const editorEntry of this.__editors.values())null===(_a=editorEntry.removeButton)||void 0===_a||_a.setTooltip(text)})}for(const editorEntry of this.__editors.values())editorEntry.editor.setLocalizations(texts)}}TcHmiRecipeEditComponents.ObjectEditorPane=ObjectEditorPane}(Beckhoff.TcHmiRecipeEditComponents||(Beckhoff.TcHmiRecipeEditComponents={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiRecipeEditComponents){class OptionalEditor extends TcHmiRecipeEditComponents.Editor{constructor(element,editorInfo,parentControl){super(element,editorInfo,parentControl),this.__onToggleStateChanged=()=>{const toggleStateActive="Active"===this.__checkbox.getToggleState();this.__editor.setIsEnabled(toggleStateActive),this.__checkbox.getElement()[0].classList.toggle("invalid",this.__editorInfo.temporarilyRequired&&!toggleStateActive),this.__onChangeManager.trigger(this)},this.__onEditorChanged=()=>{this.__onChangeManager.trigger(this)},this.__container=document.createElement("div"),this.__container.classList.add("compound-control-container"),this.__editor=TcHmiRecipeEditComponents.Editor.create(this.__container,editorInfo.editorInfo,parentControl,this.__localizations),this.__editor.onChange.add(this.__onEditorChanged),this.__editor.setIsEnabled(editorInfo.temporarilyRequired);const checkbox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCheckbox",this.__name+".checkbox",{"data-tchmi-width":30,"data-tchmi-height":100,"data-tchmi-height-unit":"%","data-tchmi-toggle-state":editorInfo.temporarilyRequired?"Active":"Normal"},this.__parentControl);if(!checkbox)throw new Error("Could not create controls for optional editor.");this.__checkbox=checkbox,this.__childControls.add(checkbox),this.__eventDestroyers.add(TcHmi.EventProvider.register(checkbox.getId()+".onToggleStateChanged",this.__onToggleStateChanged));const checkboxElement=checkbox.getElement()[0];checkboxElement.classList.add("with-validation"),this.__container.appendChild(checkboxElement),element.appendChild(this.__container)}destroy(force=!1){TcHmi.Binding.removeEx2(null,"Tooltip",this.__checkbox),super.destroy()}setEditorInfo(editorInfo){!this.__editorInfo.temporarilyRequired&&editorInfo.temporarilyRequired&&this.__checkbox.setToggleState("Active"),super.setEditorInfo(editorInfo)}__processEditorInfo(){if(this.__editor.getEditorInfo().type===this.__editorInfo.editorInfo.type)this.__editor.setEditorInfo(this.__editorInfo.editorInfo);else{const value=this.__editor.getRawValue();this.__container.innerHTML="",this.__editor.destroy(),this.__editor=TcHmiRecipeEditComponents.Editor.create(this.__container,this.__editorInfo.editorInfo,this.__parentControl,this.__localizations),this.__editor.setValue(value),this.__editor.onChange.add(this.__onEditorChanged),this.__container.appendChild(this.__checkbox.getElement()[0])}this.__onToggleStateChanged()}static validate(editorInfo,value){return void 0===value?!editorInfo.temporarilyRequired:TcHmiRecipeEditComponents.Editor.validate(editorInfo.editorInfo,value)}setValue(value){void 0===value?(this.__checkbox.setToggleState("Normal"),this.__editor.setValue(null)):(this.__checkbox.setToggleState("Active"),this.__editor.setValue(value))}getRawValue(){return"Normal"===this.__checkbox.getToggleState()?void 0:this.__editor.getRawValue()}setLocalizations(texts){var _a;super.setLocalizations(texts),(null===(_a=texts.optionalEditor)||void 0===_a?void 0:_a.optionalCheckboxTooltip)&&("string"==typeof texts.optionalEditor.optionalCheckboxTooltip?(this.__unwatchLocalization("optionalCheckboxTooltip"),TcHmi.Binding.createEx2(texts.optionalEditor.optionalCheckboxTooltip,"Tooltip",this.__checkbox)):(TcHmi.Binding.removeEx2(null,"Tooltip",this.__checkbox),this.__watchLocalization("optionalCheckboxTooltip",texts.optionalEditor.optionalCheckboxTooltip,text=>this.__checkbox.setTooltip(text)))),this.__editor.setLocalizations(texts)}}TcHmiRecipeEditComponents.OptionalEditor=OptionalEditor}(Beckhoff.TcHmiRecipeEditComponents||(Beckhoff.TcHmiRecipeEditComponents={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiRecipeEditComponents){class ArrayEditor extends TcHmiRecipeEditComponents.ButtonBasedEditor{constructor(element,editorInfo,parentControl){super(element,editorInfo,parentControl),this.__value=[],this.__processEditorInfo()}destroy(){var _a;super.destroy(),null===(_a=this.__popup)||void 0===_a||_a.destroy(!0)}static validate(editorInfo,value){if(!Array.isArray(value))return!1;if(null!==Object.getPrototypeOf(value)&&Object.getPrototypeOf(value)!==Object.getPrototypeOf([]))return!1;if(void 0!==editorInfo.minItems&&value.length<editorInfo.minItems)return!1;if(void 0!==editorInfo.maxItems&&value.length>editorInfo.maxItems)return!1;for(let i=0,ii=value.length;i<ii;i++)if(!TcHmiRecipeEditComponents.Editor.validate(editorInfo.items,value[i]))return!1;if(editorInfo.uniqueItems)for(let i=0,ii=value.length-1;i<ii;i++)for(let j=i+1,jj=value.length;j<jj;j++)if(tchmi_equal(value[i],value[j],{compareDates:!0}))return!1;return!0}__processEditorInfo(){var _a;null===(_a=this.__popup)||void 0===_a||_a.setEditorInfo(this.__editorInfo),this.__textSpan.textContent=this.__editorInfo.name}setValue(value){var _a;this.__value=null!=value?value:[],null===(_a=this.__popup)||void 0===_a||_a.setValue(value),this.__container.classList.toggle("invalid",!this.getState().isValid),this.__onChangeManager.trigger(this)}getRawValue(){return this.__value}async openPopup(){var _a,_b,_c,_d,_e,_f,_g,_h;this.__popup||(this.__popup=new TcHmiRecipeEditComponents.ArrayEditorPrompt(this.__editorInfo,this.__parentControl),this.__popup.setBackgroundAction({close:!0,action:"cancel"}),this.__popup.setLocalizations({buttonTextOk:null===(_b=null===(_a=this.__localizations)||void 0===_a?void 0:_a.arrayEditorPrompt)||void 0===_b?void 0:_b.buttonTextOk,buttonTooltipOk:null===(_d=null===(_c=this.__localizations)||void 0===_c?void 0:_c.arrayEditorPrompt)||void 0===_d?void 0:_d.buttonTooltipOk,buttonTextCancel:null===(_f=null===(_e=this.__localizations)||void 0===_e?void 0:_e.arrayEditorPrompt)||void 0===_f?void 0:_f.buttonTextCancel,buttonTooltipCancel:null===(_h=null===(_g=this.__localizations)||void 0===_g?void 0:_g.arrayEditorPrompt)||void 0===_h?void 0:_h.buttonTooltipCancel,editorLocalizations:this.__localizations}));try{this.__popup.setValue(this.__value);const result=await this.__popup.prompt();result.isOk&&(this.__value=result.value,this.__container.classList.toggle("invalid",!this.getState().isValid),this.__onChangeManager.trigger(this))}catch(ex){}}setLocalizations(texts){var _a,_b,_c,_d,_e,_f,_g,_h,_j;super.setLocalizations(texts),null===(_a=this.__popup)||void 0===_a||_a.setLocalizations({buttonTextOk:null===(_c=null===(_b=this.__localizations)||void 0===_b?void 0:_b.arrayEditorPrompt)||void 0===_c?void 0:_c.buttonTextOk,buttonTooltipOk:null===(_e=null===(_d=this.__localizations)||void 0===_d?void 0:_d.arrayEditorPrompt)||void 0===_e?void 0:_e.buttonTooltipOk,buttonTextCancel:null===(_g=null===(_f=this.__localizations)||void 0===_f?void 0:_f.arrayEditorPrompt)||void 0===_g?void 0:_g.buttonTextCancel,buttonTooltipCancel:null===(_j=null===(_h=this.__localizations)||void 0===_h?void 0:_h.arrayEditorPrompt)||void 0===_j?void 0:_j.buttonTooltipCancel,editorLocalizations:this.__localizations})}}TcHmiRecipeEditComponents.ArrayEditor=ArrayEditor}(Beckhoff.TcHmiRecipeEditComponents||(Beckhoff.TcHmiRecipeEditComponents={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiRecipeEditComponents){class ArrayBasedEditorPane extends TcHmiRecipeEditComponents.Editor{constructor(element,editorInfo,parentControl){super(element,editorInfo,parentControl),this.__removeButtonTooltip="",this.__editors=[],this.__selectedEditorEntry=null,this.__pauseChangeHandlers=!1,this.__onEditorChanged=editor=>{this.__handleOnEditorChanged(editor)},this.__onClick=e=>{if(!this.__parentControl.getIsEnabled())return;if(!TcHmi.Access.checkAccess(this.__parentControl,"operate"))return;if(!(e.target instanceof Element)||e.target.closest('div[data-tchmi-type="TcHmi.Controls.Beckhoff.TcHmiButton"]'))return;const row=e.target.closest("tr"),editorEntry=this.__editors.find(entry=>entry.row===row);this.__selectItem(null!=editorEntry?editorEntry:null)},this.__onAddItemPressed=()=>{this.__parentControl.getIsEnabled()&&TcHmi.Access.checkAccess(this.__parentControl,"operate")&&this.__addItem()},this.__onUpPressed=()=>{if(!this.__parentControl.getIsEnabled())return;if(!TcHmi.Access.checkAccess(this.__parentControl,"operate"))return;if(!this.__selectedEditorEntry||!this.__selectedEditorEntry.row.previousElementSibling)return;const currentIndex=this.__editors.indexOf(this.__selectedEditorEntry);-1!==currentIndex&&0!==currentIndex&&(this.__selectedEditorEntry.row.previousElementSibling.insertAdjacentElement("beforebegin",this.__selectedEditorEntry.row),this.__editors.splice(currentIndex-1,0,...this.__editors.splice(currentIndex,1)),this.__onChangeManager.trigger(this),this.__selectItem(this.__selectedEditorEntry))},this.__onDownPressed=()=>{if(!this.__parentControl.getIsEnabled())return;if(!TcHmi.Access.checkAccess(this.__parentControl,"operate"))return;if(!this.__selectedEditorEntry||!this.__selectedEditorEntry.row.nextElementSibling)return;const currentIndex=this.__editors.indexOf(this.__selectedEditorEntry);-1!==currentIndex&&currentIndex!==this.__editors.length-1&&(this.__selectedEditorEntry.row.nextElementSibling.insertAdjacentElement("afterend",this.__selectedEditorEntry.row),this.__editors.splice(currentIndex+1,0,...this.__editors.splice(currentIndex,1)),this.__onChangeManager.trigger(this),this.__selectItem(this.__selectedEditorEntry))};const controlClass=this.__parentControl.getType().replace(/\./g,"_");this.__editorTable=document.createElement("table"),this.__editorTable.classList.add(controlClass+"_editor-table"),this.__element.appendChild(this.__editorTable);const addItemButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__name+".AddItemButton",{"data-tchmi-width":30,"data-tchmi-height":30},this.__parentControl),upButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__name+".UpButton",{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-is-enabled":!1},this.__parentControl),downButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__name+".DownButton",{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-is-enabled":!1},this.__parentControl);if(!addItemButton||!upButton||!downButton)throw new Error("Could not create controls for array editor.");const buttonContainer=document.createElement("div");buttonContainer.classList.add(controlClass+"_editor-table-buttons"),this.__addItemButton=addItemButton,this.__childControls.add(addItemButton),this.__eventDestroyers.add(TcHmi.EventProvider.register(addItemButton.getId()+".onPressed",this.__onAddItemPressed));addItemButton.getElement()[0].classList.add("TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-button-icon-add"),buttonContainer.appendChild(addItemButton.getElement()[0]),this.__upButton=upButton,this.__childControls.add(upButton),this.__eventDestroyers.add(TcHmi.EventProvider.register(upButton.getId()+".onPressed",this.__onUpPressed));upButton.getElement()[0].classList.add("TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-button-icon-up"),buttonContainer.appendChild(upButton.getElement()[0]),this.__downButton=downButton,this.__childControls.add(downButton),this.__eventDestroyers.add(TcHmi.EventProvider.register(downButton.getId()+".onPressed",this.__onDownPressed));downButton.getElement()[0].classList.add("TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-button-icon-down"),buttonContainer.appendChild(downButton.getElement()[0]),this.__element.appendChild(buttonContainer),this.__element.addEventListener("click",this.__onClick,{passive:!0}),this.__processEditorInfo()}destroy(){TcHmi.Binding.removeEx2(null,"Tooltip",this.__addItemButton),TcHmi.Binding.removeEx2(null,"Tooltip",this.__upButton),TcHmi.Binding.removeEx2(null,"Tooltip",this.__downButton);for(const editorEntry of this.__editors)editorEntry.editor.destroy(),editorEntry.removeButton&&TcHmi.Binding.removeEx2(null,"Tooltip",editorEntry.removeButton);this.__editors=[],this.__element.removeEventListener("click",this.__onClick),super.destroy()}getRawValue(){const value=[];for(const entry of this.__editors){const rawValue=entry.editor.getRawValue();void 0!==rawValue&&value.push(rawValue)}return value}__createEditorRow(editorInfo,removable=!0){const row=document.createElement("tr"),indexCell=document.createElement("td");indexCell.classList.add("name-cell","auto-increment-index"),row.appendChild(indexCell);const editorCell=document.createElement("td");editorCell.classList.add("value-cell"),row.appendChild(editorCell);const editor=TcHmiRecipeEditComponents.Editor.create(editorCell,editorInfo,this.__parentControl,this.__localizations);editor.onChange.add(this.__onEditorChanged);const removeCell=document.createElement("td");removeCell.classList.add("remove-cell"),row.appendChild(removeCell);const ret={editor:editor,row:row,cell:editorCell};if(removable){const removeButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__name}.${tchmi_create_guid()}_RemoveButton`,{"data-tchmi-width":30,"data-tchmi-height":100,"data-tchmi-height-unit":"%","data-tchmi-tooltip":this.__removeButtonTooltip},this.__parentControl);if(!removeButton)throw new Error("Could not create controls for array editor.");this.__childControls.add(removeButton);const destroyEvent=TcHmi.EventProvider.register(removeButton.getId()+".onPressed",this.__getRemoveButtonPressedHandler(ret));this.__eventDestroyers.add(destroyEvent),ret.removeButton=removeButton,ret.removeDestroyer=()=>{this.__childControls.delete(removeButton),this.__eventDestroyers.delete(destroyEvent),destroyEvent(),this.__parentControl.__removeChild(removeButton),removeButton.destroy()};const removeButtonElement=removeButton.getElement()[0];removeButtonElement.classList.add("TcHmi_Controls_Beckhoff_TcHmiRecipeEdit-button-icon-remove"),removeCell.appendChild(removeButtonElement)}return ret}__handleOnEditorChanged(editor){this.__pauseChangeHandlers||this.__onChangeManager.trigger(this)}__getRemoveButtonPressedHandler(entry){return()=>{this.__parentControl.getIsEnabled()&&TcHmi.Access.checkAccess(this.__parentControl,"operate")&&this.__removeEditorRow(entry)}}__removeEditorRow(editorEntry){var _a;this.__selectedEditorEntry===editorEntry&&this.__selectItem(null);const index=this.__editors.indexOf(editorEntry);-1!==index&&(editorEntry.editor.destroy(),editorEntry.row.remove(),null===(_a=editorEntry.removeDestroyer)||void 0===_a||_a.call(editorEntry),this.__editors.splice(index,1),this.__pauseChangeHandlers||this.__onChangeManager.trigger(this))}__selectItem(editorEntry){var _a,_b;this.__selectedEditorEntry!==editorEntry&&(null===(_a=this.__selectedEditorEntry)||void 0===_a||_a.row.classList.remove("selected"),this.__selectedEditorEntry=editorEntry,null===(_b=this.__selectedEditorEntry)||void 0===_b||_b.row.classList.add("selected")),this.__updateMoveButtons(editorEntry?this.__editors.indexOf(editorEntry):-1)}__updateMoveButtons(selectedIndex){this.__upButton.setIsEnabled(-1!==selectedIndex&&selectedIndex>0),this.__downButton.setIsEnabled(-1!==selectedIndex&&selectedIndex<this.__editors.length-1)}setIsEnabled(isEnabled){super.setIsEnabled(isEnabled),this.__selectItem(this.__selectedEditorEntry)}setLocalizations(texts){var _a,_b,_c,_d;if(super.setLocalizations(texts),(null===(_a=texts.arrayBasedEditorPane)||void 0===_a?void 0:_a.addButtonTooltip)&&("string"==typeof texts.arrayBasedEditorPane.addButtonTooltip?(this.__unwatchLocalization("addButtonTooltip"),TcHmi.Binding.createEx2(texts.arrayBasedEditorPane.addButtonTooltip,"Tooltip",this.__addItemButton)):(TcHmi.Binding.removeEx2(null,"Tooltip",this.__addItemButton),this.__watchLocalization("addButtonTooltip",texts.arrayBasedEditorPane.addButtonTooltip,text=>this.__addItemButton.setTooltip(text)))),(null===(_b=texts.arrayBasedEditorPane)||void 0===_b?void 0:_b.upButtonTooltip)&&("string"==typeof texts.arrayBasedEditorPane.upButtonTooltip?(this.__unwatchLocalization("upButtonTooltip"),TcHmi.Binding.createEx2(texts.arrayBasedEditorPane.upButtonTooltip,"Tooltip",this.__upButton)):(TcHmi.Binding.removeEx2(null,"Tooltip",this.__upButton),this.__watchLocalization("upButtonTooltip",texts.arrayBasedEditorPane.upButtonTooltip,text=>this.__upButton.setTooltip(text)))),(null===(_c=texts.arrayBasedEditorPane)||void 0===_c?void 0:_c.downButtonTooltip)&&("string"==typeof texts.arrayBasedEditorPane.downButtonTooltip?(this.__unwatchLocalization("downButtonTooltip"),TcHmi.Binding.createEx2(texts.arrayBasedEditorPane.downButtonTooltip,"Tooltip",this.__downButton)):(TcHmi.Binding.removeEx2(null,"Tooltip",this.__downButton),this.__watchLocalization("downButtonTooltip",texts.arrayBasedEditorPane.downButtonTooltip,text=>this.__downButton.setTooltip(text)))),null===(_d=texts.arrayBasedEditorPane)||void 0===_d?void 0:_d.removeButtonTooltip)if("string"==typeof texts.arrayBasedEditorPane.removeButtonTooltip){this.__unwatchLocalization("removeButtonTooltip"),this.__removeButtonTooltip=texts.arrayBasedEditorPane.removeButtonTooltip;for(const editorEntry of this.__editors)editorEntry.removeButton&&TcHmi.Binding.createEx2(texts.arrayBasedEditorPane.removeButtonTooltip,"Tooltip",editorEntry.removeButton)}else{for(const editorEntry of this.__editors)editorEntry.removeButton&&TcHmi.Binding.removeEx2(null,"Tooltip",editorEntry.removeButton);this.__watchLocalization("removeButtonTooltip",texts.arrayBasedEditorPane.removeButtonTooltip,text=>{var _a;this.__removeButtonTooltip=text;for(const editorEntry of this.__editors)null===(_a=editorEntry.removeButton)||void 0===_a||_a.setTooltip(text)})}for(const editorEntry of this.__editors)editorEntry.editor.setLocalizations(texts)}}TcHmiRecipeEditComponents.ArrayBasedEditorPane=ArrayBasedEditorPane}(Beckhoff.TcHmiRecipeEditComponents||(Beckhoff.TcHmiRecipeEditComponents={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiRecipeEditComponents){class ArrayEditorPane extends TcHmiRecipeEditComponents.ArrayBasedEditorPane{constructor(element,editorInfo,parentControl){super(element,editorInfo,parentControl)}__processEditorInfo(){const value=this.getRawValue();this.__editorTable.innerHTML="";for(const entry of this.__editors)this.__removeEditorRow(entry);this.setValue(value)}setValue(value){this.__pauseChangeHandlers=!0,null===value&&(value=[]);let index=0;for(let length=value.length;index<length;index++){let editorEntry=this.__editors[index];editorEntry||(editorEntry=this.__createEditorRow(this.__editorInfo.items),this.__editorTable.appendChild(editorEntry.row),this.__editors.push(editorEntry)),editorEntry.editor.setValue(value[index])}if(index<this.__editors.length){const deletedEditors=this.__editors.splice(index);for(const entry of deletedEditors)this.__removeEditorRow(entry)}this.__pauseChangeHandlers=!1,this.__onChangeManager.trigger(this)}__addItem(){const editorEntry=this.__createEditorRow(this.__editorInfo.items);this.__editorTable.appendChild(editorEntry.row),this.__editors.push(editorEntry),this.__pauseChangeHandlers||this.__onChangeManager.trigger(this),this.__selectItem(editorEntry)}}TcHmiRecipeEditComponents.ArrayEditorPane=ArrayEditorPane}(Beckhoff.TcHmiRecipeEditComponents||(Beckhoff.TcHmiRecipeEditComponents={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiRecipeEditComponents){class TupleEditor extends TcHmiRecipeEditComponents.ButtonBasedEditor{constructor(element,editorInfo,parentControl){super(element,editorInfo,parentControl),this.__value=[],this.__processEditorInfo()}destroy(){var _a;super.destroy(),null===(_a=this.__popup)||void 0===_a||_a.destroy(!0)}static validate(editorInfo,value){const arrayEditorInfo={type:"array",schema:editorInfo.schema,name:editorInfo.name,items:TcHmiRecipeEditComponents.ChoiceEditor.createAnyEditorInfo(),uniqueItems:editorInfo.uniqueItems};if(void 0!==editorInfo.minItems&&(arrayEditorInfo.minItems=editorInfo.minItems),void 0!==editorInfo.maxItems&&(arrayEditorInfo.maxItems=editorInfo.maxItems),!TcHmiRecipeEditComponents.ArrayEditor.validate(arrayEditorInfo,value))return!1;for(let i=0,ii=value.length;i<ii;i++)if(i<editorInfo.items.length){if(!TcHmiRecipeEditComponents.Editor.validate(editorInfo.items[i],value[i]))return!1}else{if(!editorInfo.additionalItems.allowed)return!1;if(editorInfo.additionalItems.editorInfo&&!TcHmiRecipeEditComponents.Editor.validate(editorInfo.additionalItems.editorInfo,value[i]))return!1}return!0}__processEditorInfo(){var _a;null===(_a=this.__popup)||void 0===_a||_a.setEditorInfo(this.__editorInfo),this.__textSpan.textContent=this.__editorInfo.name}setValue(value){var _a;this.__value=null!=value?value:[],null===(_a=this.__popup)||void 0===_a||_a.setValue(value),this.__container.classList.toggle("invalid",!this.getState().isValid),this.__onChangeManager.trigger(this)}getRawValue(){return this.__value}async openPopup(){var _a,_b,_c,_d,_e,_f,_g,_h;this.__popup||(this.__popup=new TcHmiRecipeEditComponents.TupleEditorPrompt(this.__editorInfo,this.__parentControl),this.__popup.setBackgroundAction({close:!0,action:"cancel"}),this.__popup.setLocalizations({buttonTextOk:null===(_b=null===(_a=this.__localizations)||void 0===_a?void 0:_a.tupleEditorPrompt)||void 0===_b?void 0:_b.buttonTextOk,buttonTooltipOk:null===(_d=null===(_c=this.__localizations)||void 0===_c?void 0:_c.tupleEditorPrompt)||void 0===_d?void 0:_d.buttonTooltipOk,buttonTextCancel:null===(_f=null===(_e=this.__localizations)||void 0===_e?void 0:_e.tupleEditorPrompt)||void 0===_f?void 0:_f.buttonTextCancel,buttonTooltipCancel:null===(_h=null===(_g=this.__localizations)||void 0===_g?void 0:_g.tupleEditorPrompt)||void 0===_h?void 0:_h.buttonTooltipCancel,editorLocalizations:this.__localizations}));try{this.__popup.setValue(this.__value);const result=await this.__popup.prompt();result.isOk&&(this.__value=result.value,this.__container.classList.toggle("invalid",!this.getState().isValid),this.__onChangeManager.trigger(this))}catch(ex){}}setLocalizations(texts){var _a,_b,_c,_d,_e,_f,_g,_h,_j;super.setLocalizations(texts),null===(_a=this.__popup)||void 0===_a||_a.setLocalizations({buttonTextOk:null===(_c=null===(_b=this.__localizations)||void 0===_b?void 0:_b.tupleEditorPrompt)||void 0===_c?void 0:_c.buttonTextOk,buttonTooltipOk:null===(_e=null===(_d=this.__localizations)||void 0===_d?void 0:_d.tupleEditorPrompt)||void 0===_e?void 0:_e.buttonTooltipOk,buttonTextCancel:null===(_g=null===(_f=this.__localizations)||void 0===_f?void 0:_f.tupleEditorPrompt)||void 0===_g?void 0:_g.buttonTextCancel,buttonTooltipCancel:null===(_j=null===(_h=this.__localizations)||void 0===_h?void 0:_h.tupleEditorPrompt)||void 0===_j?void 0:_j.buttonTooltipCancel,editorLocalizations:this.__localizations})}}TcHmiRecipeEditComponents.TupleEditor=TupleEditor}(Beckhoff.TcHmiRecipeEditComponents||(Beckhoff.TcHmiRecipeEditComponents={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiRecipeEditComponents){class TupleEditorPane extends TcHmiRecipeEditComponents.ArrayBasedEditorPane{constructor(element,editorInfo,parentControl){super(element,editorInfo,parentControl)}__processEditorInfo(){const value=this.getRawValue();this.__editorTable.innerHTML="";for(const entry of this.__editors)this.__removeEditorRow(entry);for(const item of this.__editorInfo.items){const editorEntry=this.__createEditorRow(item,!1);this.__editorTable.appendChild(editorEntry.row),this.__editors.push(editorEntry)}this.setValue(value),this.__addItemButton.setVisibility(this.__editorInfo.additionalItems.allowed&&this.__editorInfo.additionalItems.editorInfo?"Visible":"Hidden")}setValue(value){var _a;this.__pauseChangeHandlers=!0,null===value&&(value=[]);let index=0;for(let length=value.length;index<length;index++){let editorEntry=this.__editors[index];if(!editorEntry){let info;info=this.__editorInfo.additionalItems.allowed?null!==(_a=this.__editorInfo.additionalItems.editorInfo)&&void 0!==_a?_a:TcHmiRecipeEditComponents.ChoiceEditor.createAnyEditorInfo():{type:"invalid",schema:{},name:"Invalid"},editorEntry=this.__createEditorRow(info),this.__editorTable.appendChild(editorEntry.row),this.__editors.push(editorEntry)}editorEntry.editor.setValue(value[index])}for(;index<this.__editorInfo.items.length;)this.__editors[index].editor.setValue(void 0),index++;if(index<this.__editors.length){const deletedEditors=this.__editors.splice(index);for(const entry of deletedEditors)this.__removeEditorRow(entry)}this.__pauseChangeHandlers=!1,this.__onChangeManager.trigger(this)}__markRequired(){this.__pauseChangeHandlers=!0;let triggerChangeHandlers=!1,shouldBeRequired=this.__editors.length>this.__editorInfo.items.length;for(let i=this.__editorInfo.items.length-1;i>=0;i--){const editor=this.__editors[i].editor;let editorInfo=this.__editors[i].editor.getEditorInfo();if("optional"!==editorInfo.type)break;editorInfo.temporarilyRequired!==shouldBeRequired&&(editorInfo=tchmi_clone_object(editorInfo),editorInfo.temporarilyRequired=shouldBeRequired,editor.setEditorInfo(editorInfo),triggerChangeHandlers=!0),shouldBeRequired||void 0===editor.getRawValue()||(shouldBeRequired=!0)}this.__pauseChangeHandlers=!1,triggerChangeHandlers&&this.__onChangeManager.trigger(this)}__handleOnEditorChanged(editor){super.__handleOnEditorChanged(editor),this.__markRequired()}__addItem(){var _a;if(!this.__editorInfo.additionalItems.allowed)return;const info=null!==(_a=this.__editorInfo.additionalItems.editorInfo)&&void 0!==_a?_a:TcHmiRecipeEditComponents.ChoiceEditor.createAnyEditorInfo(),editorEntry=this.__createEditorRow(info);this.__editorTable.appendChild(editorEntry.row),this.__editors.push(editorEntry),this.__pauseChangeHandlers||this.__onChangeManager.trigger(this),this.__markRequired(),this.__selectItem(editorEntry)}__removeEditorRow(editorEntry){super.__removeEditorRow(editorEntry),this.__markRequired()}__updateMoveButtons(selectedIndex){this.__upButton.setIsEnabled(-1!==selectedIndex&&selectedIndex>this.__editorInfo.items.length),this.__downButton.setIsEnabled(-1!==selectedIndex&&selectedIndex>=this.__editorInfo.items.length&&selectedIndex<this.__editors.length-1)}}TcHmiRecipeEditComponents.TupleEditorPane=TupleEditorPane}(Beckhoff.TcHmiRecipeEditComponents||(Beckhoff.TcHmiRecipeEditComponents={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiRecipeEditComponents){class NullEditor extends TcHmiRecipeEditComponents.Editor{constructor(element,editorInfo,parentControl){super(element,editorInfo,parentControl);const textSpan=document.createElement("span");textSpan.classList.add("value-description"),textSpan.textContent="null",this.__element.appendChild(textSpan)}static validate(editorInfo,value){return null===value}__processEditorInfo(){}setValue(value){}getRawValue(){return null}}TcHmiRecipeEditComponents.NullEditor=NullEditor}(Beckhoff.TcHmiRecipeEditComponents||(Beckhoff.TcHmiRecipeEditComponents={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiRecipeEditComponents){class InvalidEditor extends TcHmiRecipeEditComponents.Editor{constructor(element,editorInfo,parentControl){super(element,editorInfo,parentControl),this.__textContainer=document.createElement("div"),this.__textContainer.classList.add("with-validation","invalid")}static validate(editorInfo,value){return!1}__processEditorInfo(){}setValue(value){this.__value=value,this.__textContainer.textContent="string"==typeof value?value:JSON.stringify(value)}getRawValue(){return this.__value}}TcHmiRecipeEditComponents.InvalidEditor=InvalidEditor}(Beckhoff.TcHmiRecipeEditComponents||(Beckhoff.TcHmiRecipeEditComponents={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){!function(Controls){!function(Beckhoff){!function(TcHmiRecipeEditComponents){class ChoiceEditor extends TcHmiRecipeEditComponents.Editor{constructor(element,editorInfo,parentControl){super(element,editorInfo,parentControl),this.__editors=new Map,this.__activeEditor=null,this.__onSelectionChanged=()=>{var _a,_b,_c;const choices=null!==(_a=this.__editorInfo.choices)&&void 0!==_a?_a:ChoiceEditor.getAnyChoices(),index=this.__combobox.getSelectedIndex();if(null==index||index<0||index>=choices.length)null===(_b=this.__activeEditor)||void 0===_b||_b.container.remove(),null===(_c=this.__activeEditor)||void 0===_c||_c.editor.onChange.remove(this.__onEditorChanged),this.__activeEditor=null;else{const editorInfo=choices[index];let editorEntry=this.__editors.get(editorInfo.type);if(!editorEntry){const container=document.createElement("div");container.classList.add("choice-sub-editor"),editorEntry={editor:TcHmiRecipeEditComponents.Editor.create(container,editorInfo,this.__parentControl,this.__localizations),container:container},this.__editors.set(editorInfo.type,editorEntry)}editorEntry.editor.setEditorInfo(editorInfo),editorEntry.editor.setValue(this.__value),this.__activeEditor?(this.__activeEditor.container.replaceWith(editorEntry.container),this.__activeEditor.editor.onChange.remove(this.__onEditorChanged)):this.__container.prepend(editorEntry.container),editorEntry.editor.onChange.add(this.__onEditorChanged),this.__activeEditor=editorEntry,this.__onChangeManager.trigger(this)}},this.__onEditorChanged=editor=>{this.__value=editor.getRawValue(),this.__onChangeManager.trigger(this)},this.__container=document.createElement("div"),this.__container.classList.add("compound-control-container");const combobox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCombobox",this.__name+".combobox",{"data-tchmi-content-padding":{top:3,right:3,bottom:3,left:3}},this.__parentControl);if(!combobox)throw new Error("Could not create controls for choice editor.");this.__combobox=combobox,this.__childControls.add(combobox),this.__eventDestroyers.add(TcHmi.EventProvider.register(combobox.getId()+".onSelectionChanged",this.__onSelectionChanged));const comboboxElement=combobox.getElement()[0];comboboxElement.classList.add("type-combobox"),this.__container.appendChild(comboboxElement),this.__processEditorInfo(),element.appendChild(this.__container)}static createAnyEditorInfo(){return{type:"choice",schema:{},name:"Any"}}static getAnyChoices(){return[{type:"boolean",schema:{},name:"Boolean"},{type:"number",schema:{},name:"Number",specialValues:new Set(["NaN","Infinity","-Infinity"]),restrictions:[]},{type:"string",schema:{},name:"String",restrictions:[]},{type:"time",schema:{},name:"Time",formats:new Set(["date-time","timespan"])},{type:"object",schema:{},name:"Object",properties:new Map,additionalProperties:{allowed:!0,editorInfo:ChoiceEditor.createAnyEditorInfo()}},{type:"array",schema:{},name:"Array",items:ChoiceEditor.createAnyEditorInfo(),uniqueItems:!1},{type:"null",schema:{},name:"Null"}]}static validate(editorInfo,value){return!editorInfo.choices||editorInfo.choices.some(info=>TcHmiRecipeEditComponents.Editor.validate(info,value))}__processEditorInfo(){var _a;const choices=null!==(_a=this.__editorInfo.choices)&&void 0!==_a?_a:ChoiceEditor.getAnyChoices();if(this.__combobox.setSrcData(choices.map(choice=>({text:choice.name}))),this.__activeEditor){const currentlyChosenEditorInfo=this.__activeEditor.editor.getEditorInfo(),unboxedType="optional"===currentlyChosenEditorInfo.type?currentlyChosenEditorInfo.editorInfo.type:currentlyChosenEditorInfo.type;choices.some(choice=>"optional"!==choice.type?choice.type===unboxedType:choice.editorInfo.type===unboxedType&&"optional"===currentlyChosenEditorInfo.type)||(this.__activeEditor.container.remove(),this.__activeEditor.editor.onChange.remove(this.__onEditorChanged),this.__activeEditor=null,this.__onChangeManager.trigger(this))}for(const[type,editorEntry]of this.__editors){const editorInfo=editorEntry.editor.getEditorInfo(),unboxedType="optional"===editorInfo.type?editorInfo.editorInfo.type:editorInfo.type;choices.some(choice=>"optional"!==choice.type?choice.type===unboxedType:choice.editorInfo.type===unboxedType&&"optional"===editorInfo.type)||this.__editors.delete(type)}}setValue(value){var _a,_b,_c;if(this.__value=value,this.__activeEditor&&TcHmiRecipeEditComponents.Editor.validate(this.__activeEditor.editor.getEditorInfo(),value))return void this.__activeEditor.editor.setValue(value);const currentComboboxIndex=this.__combobox.getSelectedIndex(),availableTypes=[],choices=null!==(_a=this.__editorInfo.choices)&&void 0!==_a?_a:ChoiceEditor.getAnyChoices();for(const[index,choice]of choices.entries()){if(TcHmiRecipeEditComponents.Editor.validate(choice,value))return void this.__combobox.setSelectedIndex(index);availableTypes.push("optional"!==choice.type?choice.type:choice.editorInfo.type)}const currentlyChosenEditorInfo=null===(_b=this.__activeEditor)||void 0===_b?void 0:_b.editor.getEditorInfo(),currentType="optional"===(null==currentlyChosenEditorInfo?void 0:currentlyChosenEditorInfo.type)?currentlyChosenEditorInfo.editorInfo.type:null!==(_c=null==currentlyChosenEditorInfo?void 0:currentlyChosenEditorInfo.type)&&void 0!==_c?_c:null;let index;switch(typeof value){case"boolean":index=availableTypes.indexOf("boolean"),-1!==index&&currentType!==availableTypes[index]&&this.__combobox.setSelectedIndex(index);break;case"number":index=availableTypes.indexOf("number"),-1!==index&&currentType!==availableTypes[index]&&this.__combobox.setSelectedIndex(index);break;case"string":index=availableTypes.indexOf("string"),-1===index&&(index=availableTypes.indexOf("time")),-1!==index&&currentType!==availableTypes[index]&&this.__combobox.setSelectedIndex(index);break;case"object":null===value?index=availableTypes.indexOf("null"):Array.isArray(value)?(index=availableTypes.indexOf("array"),-1===index&&(index=availableTypes.indexOf("tuple"))):index=availableTypes.indexOf("object"),-1!==index&&currentType!==availableTypes[index]&&this.__combobox.setSelectedIndex(index)}this.__activeEditor&&this.__combobox.getSelectedIndex()===currentComboboxIndex&&this.__activeEditor.editor.setValue(value)}getState(){return this.__activeEditor?this.__activeEditor.editor.getState():{isValid:!1}}getRawValue(){return this.__activeEditor?this.__activeEditor.editor.getRawValue():this.__value}setLocalizations(texts){var _a;super.setLocalizations(texts),(null===(_a=texts.choiceEditor)||void 0===_a?void 0:_a.comboboxText)&&("string"==typeof texts.choiceEditor.comboboxText?(this.__unwatchLocalization("comboboxText"),TcHmi.Binding.createEx2(texts.choiceEditor.comboboxText,"comboboxText",this.__combobox)):(TcHmi.Binding.removeEx2(null,"comboboxText",this.__combobox),this.__watchLocalization("comboboxText",texts.choiceEditor.comboboxText,text=>this.__combobox.setComboboxText(text))));for(const editorEntry of this.__editors.values())editorEntry.editor.setLocalizations(texts)}}TcHmiRecipeEditComponents.ChoiceEditor=ChoiceEditor}(Beckhoff.TcHmiRecipeEditComponents||(Beckhoff.TcHmiRecipeEditComponents={}))}(Controls.Beckhoff||(Controls.Beckhoff={}))}(TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={}));